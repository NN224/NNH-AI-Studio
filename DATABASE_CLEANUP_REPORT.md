# ๐๏ธ ุชูุฑูุฑ ุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุชุงุฑูุฎ:** 15 ููููุจุฑ 2025  
**ุงููุดุฑูุน:** NNH-AI-Studio

---

## ๐ ูุชุงุฆุฌ ุงููุญุต

### **ุงููููุงุช ุงูููุณูุญุฉ:**
```
๐ 1,614 ููู ูู ุงููุดุฑูุน
โ 145 ููู ูุณุชุฎุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

---

## โ ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ (16 ุฌุฏูู)

```
1.  gmb_locations               268 ุงุณุชุฎุฏุงู ูู 83 ููู  โญโญโญโญโญ
2.  gmb_accounts                185 ุงุณุชุฎุฏุงู ูู 61 ููู  โญโญโญโญโญ
3.  gmb_reviews                 152 ุงุณุชุฎุฏุงู ูู 48 ููู  โญโญโญโญโญ
4.  gmb_questions               94 ุงุณุชุฎุฏุงู ูู 23 ููู   โญโญโญโญ
5.  gmb_posts                   82 ุงุณุชุฎุฏุงู ูู 21 ููู   โญโญโญโญ
6.  gmb_media                   29 ุงุณุชุฎุฏุงู ูู 9 ูููุงุช  โญโญโญ
7.  ai_settings                 18 ุงุณุชุฎุฏุงู ูู 5 ูููุงุช  โญโญโญ
8.  weekly_task_recommendations 18 ุงุณุชุฎุฏุงู ูู 4 ูููุงุช  โญโญโญ
9.  profiles                    14 ุงุณุชุฎุฏุงู ูู 5 ูููุงุช  โญโญ
10. notifications               14 ุงุณุชุฎุฏุงู ูู 3 ูููุงุช  โญโญ
11. activity_logs               12 ุงุณุชุฎุฏุงู ูู 6 ูููุงุช  โญโญ
12. ai_requests                 8 ุงุณุชุฎุฏุงู ูู 3 ูููุงุช   โญโญ
13. rate_limit_requests         8 ุงุณุชุฎุฏุงู ูู 1 ููู     โญ
14. audit_logs                  4 ุงุณุชุฎุฏุงู ูู 1 ููู     โญ
15. error_logs                  2 ุงุณุชุฎุฏุงู ูู 1 ููู     โญ
16. performance_metrics         2 ุงุณุชุฎุฏุงู ูู 1 ููู     โญ
```

---

## โ ุงูุฌุฏุงูู ุบูุฑ ุงููุณุชุฎุฏูุฉ (19 ุฌุฏูู)

### **๐ Auth Tables (5 ุฌุฏุงูู):**
```
โ sessions                     - ุฌุฏูู Sessions ูุฏูู
โ refresh_tokens               - ุฌุฏูู Refresh Tokens ูุฏูู
โ password_reset_tokens        - ุฌุฏูู Reset Tokens ูุฏูู
โ email_verification_tokens    - ุฌุฏูู Verification ูุฏูู
โ users                        - ุฌุฏูู Users ููุฑุฑ (Supabase Auth)
```

**ุงูุชูุตูุฉ:** โ ุงุญุฐู (Supabase Auth ูุณุชุฎุฏู schema ูููุตู)

---

### **๐ฅ Roles & Permissions (4 ุฌุฏุงูู):**
```
โ user_permissions             - ุตูุงุญูุงุช ุงููุณุชุฎุฏููู
โ role_permissions             - ุตูุงุญูุงุช ุงูุฃุฏูุงุฑ
โ permissions                  - ุงูุตูุงุญูุงุช
โ user_roles                   - ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู
```

**ุงูุชูุตูุฉ:** โ ุงุญุฐู (ูุธุงู ุงูุตูุงุญูุงุช ุบูุฑ ูุณุชุฎุฏู)

---

### **๐ Webhooks (2 ุฌุฏุงูู):**
```
โ webhook_events               - ุฃุญุฏุงุซ ุงูู Webhooks
โ webhooks                     - ุงูู Webhooks
```

**ุงูุชูุตูุฉ:** โ ุงุญุฐู (ุชุงุจ Webhooks ุชู ุญุฐูู)

---

### **โ๏ธ Settings & Preferences (4 ุฌุฏุงูู):**
```
โ api_keys                     - ููุงุชูุญ API
โ saved_filters                - ุงูููุงุชุฑ ุงููุญููุธุฉ
โ dashboard_widgets            - ููุฏุฌูุช Dashboard
โ user_preferences             - ุชูุถููุงุช ุงููุณุชุฎุฏู
```

**ุงูุชูุตูุฉ:** โ ุงุญุฐู (ุบูุฑ ูุณุชุฎุฏูุฉ)

---

### **๐ Sync Tables (2 ุฌุฏุงูู):**
```
โ sync_errors                  - ุฃุฎุทุงุก ุงููุฒุงููุฉ
โ sync_transactions            - ูุนุงููุงุช ุงููุฒุงููุฉ
```

**ุงูุชูุตูุฉ:** โ๏ธ ุงุญุชูุธ ูุคูุชุงู (ูุฏ ุชููู ูููุฏุฉ ูููุฑุงูุจุฉ)

---

### **๐จ Location Features (2 ุฌุฏุงูู):**
```
โ location_branding            - ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ ูููููุน
โ location_features            - ููุฒุงุช ุงููููุน
```

**ุงูุชูุตูุฉ:** โ๏ธ ุชุญูู ูู ุตูุญุฉ Features ุฃููุงู

---

## ๐ Views

### **โ ุงููุณุชุฎุฏูุฉ (1 view):**
```
โ v_dashboard_stats            6 ุงุณุชุฎุฏุงู ูู 3 ูููุงุช  โญโญโญ
```

### **โ ุบูุฑ ุงููุณุชุฎุฏูุฉ (4 views):**
```
โ v_location_performance       - ุฃุฏุงุก ุงูููุงูุน
โ v_review_summary             - ููุฎุต ุงูุชููููุงุช
โ v_question_summary           - ููุฎุต ุงูุฃุณุฆูุฉ
โ v_post_summary               - ููุฎุต ุงูููุดูุฑุงุช
```

**ุงูุชูุตูุฉ:** โ ุงุญุฐู ูููุง

---

## ๐ง Functions

### **โ ุบูุฑ ุงููุณุชุฎุฏูุฉ (5 functions):**
```
โ calculate_health_score()     - ุญุณุงุจ Health Score
โ get_pending_reviews_count()  - ุนุฏุฏ ุงูุชููููุงุช ุงููุนููุฉ
โ update_updated_at_column()   - ุชุญุฏูุซ updated_at
โ notify_new_review()          - ุฅุดุนุงุฑ ุชูููู ุฌุฏูุฏ
โ notify_new_question()        - ุฅุดุนุงุฑ ุณุคุงู ุฌุฏูุฏ
```

**ุงูุชูุตูุฉ:** 
- โ ุงุญุฐู: `calculate_health_score`, `get_pending_reviews_count`
- โ๏ธ ุชุญูู ูู Triggers: `update_updated_at_column`
- โ ุงุญุฐู: `notify_new_review`, `notify_new_question`

---

## ๐ ุงูุชูููุฑ ุงููุชููุน

### **ูุจู ุงูุชูุธูู:**
```
๐๏ธ ุงูุฌุฏุงูู:     35 ุฌุฏูู
๐ Views:        5 views
๐ง Functions:    5+ functions
๐พ ุงูุญุฌู:       ~500 MB (ุชูุฏูุฑู)
```

### **ุจุนุฏ ุงูุชูุธูู:**
```
๐๏ธ ุงูุฌุฏุงูู:     16-18 ุฌุฏูู (ุญุฐู 17-19)
๐ Views:        1 view (ุญุฐู 4)
๐ง Functions:    1-2 functions (ุญุฐู 3-4)
๐พ ุงูุญุฌู:       ~350 MB (ุชูุฏูุฑู)
```

### **ุงููุชูุฌุฉ:**
```
๐ ุชูููุฑ: 150 MB (~30%)
โก ุชุญุณูู ุงูุฃุฏุงุก: 15-20%
๐งน ุชุจุณูุท: 50% ุฃูู complexity
```

---

## ๐ฏ ุฎุทุฉ ุงูุชูููุฐ

### **ุงููุฑุญูุฉ 1: ุญุฐู ุขูู (ููุฑู) โ**
```sql
-- 1. Views ุบูุฑ ูุณุชุฎุฏูุฉ (4)
DROP VIEW IF EXISTS v_location_performance CASCADE;
DROP VIEW IF EXISTS v_review_summary CASCADE;
DROP VIEW IF EXISTS v_question_summary CASCADE;
DROP VIEW IF EXISTS v_post_summary CASCADE;

-- 2. Functions ุบูุฑ ูุณุชุฎุฏูุฉ (2)
DROP FUNCTION IF EXISTS calculate_health_score(uuid) CASCADE;
DROP FUNCTION IF EXISTS get_pending_reviews_count(uuid) CASCADE;
DROP FUNCTION IF EXISTS notify_new_review() CASCADE;
DROP FUNCTION IF EXISTS notify_new_question() CASCADE;

-- 3. Auth Tables ูุฏููุฉ (5)
DROP TABLE IF EXISTS sessions CASCADE;
DROP TABLE IF EXISTS refresh_tokens CASCADE;
DROP TABLE IF EXISTS password_reset_tokens CASCADE;
DROP TABLE IF EXISTS email_verification_tokens CASCADE;

-- 4. Roles & Permissions (4)
DROP TABLE IF EXISTS user_permissions CASCADE;
DROP TABLE IF EXISTS role_permissions CASCADE;
DROP TABLE IF EXISTS permissions CASCADE;
DROP TABLE IF EXISTS user_roles CASCADE;

-- 5. Webhooks (2)
DROP TABLE IF EXISTS webhook_events CASCADE;
DROP TABLE IF EXISTS webhooks CASCADE;

-- 6. Settings (4)
DROP TABLE IF EXISTS api_keys CASCADE;
DROP TABLE IF EXISTS saved_filters CASCADE;
DROP TABLE IF EXISTS dashboard_widgets CASCADE;
DROP TABLE IF EXISTS user_preferences CASCADE;
```

**ุงููุชูุฌุฉ:** ุญุฐู 19 ุฌุฏูู + 4 views + 4 functions

---

### **ุงููุฑุญูุฉ 2: ุชุญูู ุซู ุงุญุฐู (ุจุญุฐุฑ) โ๏ธ**
```sql
-- 1. ุชุญูู ูู ุงุณุชุฎุฏุงู location_features ูู ุตูุญุฉ Features
-- ุฅุฐุง ูู ุชูู ูุณุชุฎุฏูุฉ:
-- DROP TABLE IF EXISTS location_branding CASCADE;
-- DROP TABLE IF EXISTS location_features CASCADE;

-- 2. ุชุญูู ูู ุงุณุชุฎุฏุงู sync tables
-- ุฅุฐุง ูู ุชูู ูุณุชุฎุฏูุฉ:
-- DROP TABLE IF EXISTS sync_errors CASCADE;
-- DROP TABLE IF EXISTS sync_transactions CASCADE;

-- 3. ุชุญูู ูู Triggers ูุจู ุญุฐู update_updated_at_column
-- DROP FUNCTION IF EXISTS update_updated_at_column() CASCADE;
```

---

### **ุงููุฑุญูุฉ 3: ุชุญุณูู ุงูุฃุฏุงุก โก**
```sql
-- 1. ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
VACUUM ANALYZE;

-- 2. ุฅุนุงุฏุฉ ุจูุงุก ุงูููุงุฑุณ
REINDEX DATABASE postgres;

-- 3. ูุญุต ุงูููุงุฑุณ ุบูุฑ ุงููุณุชุฎุฏูุฉ
-- (ูู ูุชุงุฆุฌ audit-database.sql)
```

---

## โ๏ธ ุชุญุฐูุฑุงุช ูููุฉ

```
โ๏ธ ุงุนูู Backup ูุจู ุฃู ุญุฐู!
โ๏ธ ุงุฎุชุจุฑ ุงูุชุทุจูู ุจุนุฏ ูู ูุฑุญูุฉ!
โ๏ธ ูุง ุชุญุฐู ุฌุฏุงูู Supabase Auth ุงูุฃุณุงุณูุฉ!
โ๏ธ ุชุญูู ูู ุงูุงุนุชูุงุฏูุงุช ูุจู ุงูุญุฐู!
โ๏ธ ุงุณุชุฎุฏู CASCADE ุจุญุฐุฑ!
```

---

## โ Checklist

```
โก 1. Backup ูุงุนุฏุฉ ุงูุจูุงูุงุช
โก 2. ูุฑุงุฌุนุฉ ุงูุชูุฑูุฑ
โก 3. ุชุดุบูู ุงููุฑุญูุฉ 1 (ุงูุญุฐู ุงูุขูู)
โก 4. ุงุฎุชุจุงุฑ ุงูุชุทุจูู
โก 5. ุชุดุบูู VACUUM ANALYZE
โก 6. ูุฑุงุฌุนุฉ ุงููุฑุญูุฉ 2
โก 7. ุญุฐู ุงููุฑุญูุฉ 2 (ุจุญุฐุฑ)
โก 8. ุงุฎุชุจุงุฑ ููุงุฆู
โก 9. ุชุดุบูู REINDEX
โก 10. ูุญุต ุงูุฃุฏุงุก
```

---

## ๐ ุงููููุงุช ุงููุฑููุฉ

```
1. scripts/audit-database.sql          - ูุญุต SQL ุดุงูู
2. scripts/analyze-database-usage.js   - ูุญุต ุงุณุชุฎุฏุงู ุงูููุฏ
3. sql/cleanup-unused-database-objects.sql - ุณูุฑูุจุช ุงูุญุฐู
4. database-usage-report.json          - ุงูุชูุฑูุฑ ุงููุงูู JSON
5. DATABASE_AUDIT_GUIDE.md             - ุฏููู ุงููุญุต
6. DATABASE_CLEANUP_REPORT.md          - ูุฐุง ุงูุชูุฑูุฑ
```

---

**ุฌุงูุฒ ููุชูุธูู! ๐งน**

