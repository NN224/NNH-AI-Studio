[
  {
    "composite": {
      "user_defined_filter": [
        {
          "field": {
            "column_name": [
              {
                "type": "${text}"
              }
            ],
            "op": [
              {
                "type": "${enum.equality_op}"
              }
            ],
            "value": [
              {
                "type": "${text}"
              }
            ]
          },
          "schema": "${schema.realtime}"
        }
      ],
      "wal_column": [
        {
          "field": {
            "is_pkey": [
              {
                "type": "${boolean}"
              }
            ],
            "is_selectable": [
              {
                "type": "${boolean}"
              }
            ],
            "name": [
              {
                "type": "${text}"
              }
            ],
            "type_name": [
              {
                "type": "${text}"
              }
            ],
            "type_oid": [
              {
                "type": "${oid}"
              }
            ],
            "value": [
              {
                "type": "${jsonb}"
              }
            ]
          },
          "schema": "${schema.realtime}"
        }
      ],
      "wal_rls": [
        {
          "field": {
            "errors": [
              {
                "type": "${sql(\"text[]\")}"
              }
            ],
            "is_rls_enabled": [
              {
                "type": "${boolean}"
              }
            ],
            "subscription_ids": [
              {
                "type": "${sql(\"uuid[]\")}"
              }
            ],
            "wal": [
              {
                "type": "${jsonb}"
              }
            ]
          },
          "schema": "${schema.realtime}"
        }
      ]
    },
    "enum": {
      "aal_level": [
        {
          "schema": "${schema.auth}",
          "values": [
            "aal1",
            "aal2",
            "aal3"
          ]
        }
      ],
      "action": [
        {
          "schema": "${schema.realtime}",
          "values": [
            "INSERT",
            "UPDATE",
            "DELETE",
            "TRUNCATE",
            "ERROR"
          ]
        }
      ],
      "buckettype": [
        {
          "schema": "${schema.storage}",
          "values": [
            "STANDARD",
            "ANALYTICS"
          ]
        }
      ],
      "code_challenge_method": [
        {
          "schema": "${schema.auth}",
          "values": [
            "s256",
            "plain"
          ]
        }
      ],
      "equality_op": [
        {
          "schema": "${schema.realtime}",
          "values": [
            "eq",
            "neq",
            "lt",
            "lte",
            "gt",
            "gte",
            "in"
          ]
        }
      ],
      "factor_status": [
        {
          "schema": "${schema.auth}",
          "values": [
            "unverified",
            "verified"
          ]
        }
      ],
      "factor_type": [
        {
          "schema": "${schema.auth}",
          "values": [
            "totp",
            "webauthn",
            "phone"
          ]
        }
      ],
      "oauth_authorization_status": [
        {
          "schema": "${schema.auth}",
          "values": [
            "pending",
            "approved",
            "denied",
            "expired"
          ]
        }
      ],
      "oauth_client_type": [
        {
          "schema": "${schema.auth}",
          "values": [
            "public",
            "confidential"
          ]
        }
      ],
      "oauth_registration_type": [
        {
          "schema": "${schema.auth}",
          "values": [
            "dynamic",
            "manual"
          ]
        }
      ],
      "oauth_response_type": [
        {
          "schema": "${schema.auth}",
          "values": [
            "code"
          ]
        }
      ],
      "one_time_token_type": [
        {
          "schema": "${schema.auth}",
          "values": [
            "confirmation_token",
            "reauthentication_token",
            "recovery_token",
            "email_change_token_new",
            "email_change_token_current",
            "phone_change_token"
          ]
        }
      ]
    },
    "event_trigger": {
      "issue_graphql_placeholder": [
        {
          "execute": "${function.set_graphql_placeholder}",
          "on": "${sql_drop}",
          "tags": [
            "DROP EXTENSION"
          ]
        }
      ],
      "issue_pg_cron_access": [
        {
          "execute": "${function.grant_pg_cron_access}",
          "on": "${ddl_command_end}",
          "tags": [
            "CREATE EXTENSION"
          ]
        }
      ],
      "issue_pg_graphql_access": [
        {
          "execute": "${function.grant_pg_graphql_access}",
          "on": "${ddl_command_end}",
          "tags": [
            "CREATE FUNCTION"
          ]
        }
      ],
      "issue_pg_net_access": [
        {
          "execute": "${function.grant_pg_net_access}",
          "on": "${ddl_command_end}",
          "tags": [
            "CREATE EXTENSION"
          ]
        }
      ],
      "pgrst_ddl_watch": [
        {
          "execute": "${function.pgrst_ddl_watch}",
          "on": "${ddl_command_end}"
        }
      ],
      "pgrst_drop_watch": [
        {
          "execute": "${function.pgrst_drop_watch}",
          "on": "${sql_drop}"
        }
      ]
    },
    "extension": {
      "pg_cron": [
        {
          "comment": "Job scheduler for PostgreSQL",
          "version": "1.6.4"
        }
      ],
      "pg_graphql": [
        {
          "comment": "pg_graphql: GraphQL support",
          "schema": "${schema.graphql}",
          "version": "1.5.11"
        }
      ],
      "pg_net": [
        {
          "comment": "Async HTTP",
          "schema": "${schema.public}",
          "version": "0.19.5"
        }
      ],
      "pg_stat_statements": [
        {
          "comment": "track planning and execution statistics of all SQL statements executed",
          "schema": "${schema.extensions}",
          "version": "1.11"
        }
      ],
      "pgaudit": [
        {
          "comment": "provides auditing functionality",
          "schema": "${schema.public}",
          "version": "17.0"
        }
      ],
      "pgcrypto": [
        {
          "comment": "cryptographic functions",
          "schema": "${schema.extensions}",
          "version": "1.3"
        }
      ],
      "supabase_vault": [
        {
          "comment": "Supabase Vault Extension",
          "schema": "${schema.vault}",
          "version": "0.3.1"
        }
      ],
      "uuid-ossp": [
        {
          "comment": "generate universally unique identifiers (UUIDs)",
          "schema": "${schema.extensions}",
          "version": "1.1"
        }
      ]
    },
    "function": {
      "add_prefixes": [
        {
          "arg": {
            "_bucket_id": [
              {
                "type": "${text}"
              }
            ],
            "_name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "DECLARE\n    prefixes text[];\nBEGIN\n    prefixes := \"storage\".\"get_prefixes\"(\"_name\");\n\n    IF array_length(prefixes, 1) > 0 THEN\n        INSERT INTO storage.prefixes (name, bucket_id)\n        SELECT UNNEST(prefixes) as name, \"_bucket_id\" ON CONFLICT DO NOTHING;\n    END IF;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.storage}",
          "security": "${DEFINER}"
        }
      ],
      "apply_rls": [
        {
          "arg": {
            "max_record_bytes": [
              {
                "default": "${sql(\"(1024 * 1024)\")}",
                "type": "${integer}"
              }
            ],
            "wal": [
              {
                "type": "${jsonb}"
              }
            ]
          },
          "as": "declare\n-- Regclass of the table e.g. public.notes\nentity_ regclass = (quote_ident(wal ->> 'schema') || '.' || quote_ident(wal ->> 'table'))::regclass;\n\n-- I, U, D, T: insert, update ...\naction realtime.action = (\n    case wal ->> 'action'\n        when 'I' then 'INSERT'\n        when 'U' then 'UPDATE'\n        when 'D' then 'DELETE'\n        else 'ERROR'\n    end\n);\n\n-- Is row level security enabled for the table\nis_rls_enabled bool = relrowsecurity from pg_class where oid = entity_;\n\nsubscriptions realtime.subscription[] = array_agg(subs)\n    from\n        realtime.subscription subs\n    where\n        subs.entity = entity_;\n\n-- Subscription vars\nroles regrole[] = array_agg(distinct us.claims_role::text)\n    from\n        unnest(subscriptions) us;\n\nworking_role regrole;\nclaimed_role regrole;\nclaims jsonb;\n\nsubscription_id uuid;\nsubscription_has_access bool;\nvisible_to_subscription_ids uuid[] = '{}';\n\n-- structured info for wal's columns\ncolumns realtime.wal_column[];\n-- previous identity values for update/delete\nold_columns realtime.wal_column[];\n\nerror_record_exceeds_max_size boolean = octet_length(wal::text) > max_record_bytes;\n\n-- Primary jsonb output for record\noutput jsonb;\n\nbegin\nperform set_config('role', null, true);\n\ncolumns =\n    array_agg(\n        (\n            x->>'name',\n            x->>'type',\n            x->>'typeoid',\n            realtime.cast(\n                (x->'value') #>> '{}',\n                coalesce(\n                    (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4\n                    (x->>'type')::regtype\n                )\n            ),\n            (pks ->> 'name') is not null,\n            true\n        )::realtime.wal_column\n    )\n    from\n        jsonb_array_elements(wal -> 'columns') x\n        left join jsonb_array_elements(wal -> 'pk') pks\n            on (x ->> 'name') = (pks ->> 'name');\n\nold_columns =\n    array_agg(\n        (\n            x->>'name',\n            x->>'type',\n            x->>'typeoid',\n            realtime.cast(\n                (x->'value') #>> '{}',\n                coalesce(\n                    (x->>'typeoid')::regtype, -- null when wal2json version <= 2.4\n                    (x->>'type')::regtype\n                )\n            ),\n            (pks ->> 'name') is not null,\n            true\n        )::realtime.wal_column\n    )\n    from\n        jsonb_array_elements(wal -> 'identity') x\n        left join jsonb_array_elements(wal -> 'pk') pks\n            on (x ->> 'name') = (pks ->> 'name');\n\nfor working_role in select * from unnest(roles) loop\n\n    -- Update `is_selectable` for columns and old_columns\n    columns =\n        array_agg(\n            (\n                c.name,\n                c.type_name,\n                c.type_oid,\n                c.value,\n                c.is_pkey,\n                pg_catalog.has_column_privilege(working_role, entity_, c.name, 'SELECT')\n            )::realtime.wal_column\n        )\n        from\n            unnest(columns) c;\n\n    old_columns =\n            array_agg(\n                (\n                    c.name,\n                    c.type_name,\n                    c.type_oid,\n                    c.value,\n                    c.is_pkey,\n                    pg_catalog.has_column_privilege(working_role, entity_, c.name, 'SELECT')\n                )::realtime.wal_column\n            )\n            from\n                unnest(old_columns) c;\n\n    if action <> 'DELETE' and count(1) = 0 from unnest(columns) c where c.is_pkey then\n        return next (\n            jsonb_build_object(\n                'schema', wal ->> 'schema',\n                'table', wal ->> 'table',\n                'type', action\n            ),\n            is_rls_enabled,\n            -- subscriptions is already filtered by entity\n            (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),\n            array['Error 400: Bad Request, no primary key']\n        )::realtime.wal_rls;\n\n    -- The claims role does not have SELECT permission to the primary key of entity\n    elsif action <> 'DELETE' and sum(c.is_selectable::int) <> count(1) from unnest(columns) c where c.is_pkey then\n        return next (\n            jsonb_build_object(\n                'schema', wal ->> 'schema',\n                'table', wal ->> 'table',\n                'type', action\n            ),\n            is_rls_enabled,\n            (select array_agg(s.subscription_id) from unnest(subscriptions) as s where claims_role = working_role),\n            array['Error 401: Unauthorized']\n        )::realtime.wal_rls;\n\n    else\n        output = jsonb_build_object(\n            'schema', wal ->> 'schema',\n            'table', wal ->> 'table',\n            'type', action,\n            'commit_timestamp', to_char(\n                ((wal ->> 'timestamp')::timestampz at time zone 'utc'),\n                'YYYY-MM-DD\"T\"HH24:MI:SS.MS\"Z\"'\n            ),\n            'columns', (\n                select\n                    jsonb_agg(\n                        jsonb_build_object(\n                            'name', pa.attname,\n                            'type', pt.typname\n                        )\n                        order by pa.attnum asc\n                    )\n                from\n                    pg_attribute pa\n                    join pg_type pt\n                        on pa.atttypid = pt.oid\n                where\n                    attrelid = entity_\n                    and attnum > 0\n                    and pg_catalog.has_column_privilege(working_role, entity_, pa.attname, 'SELECT')\n            )\n        )\n        -- Add \"record\" key for insert and update\n        || case\n            when action in ('INSERT', 'UPDATE') then\n                jsonb_build_object(\n                    'record',\n                    (\n                        select\n                            jsonb_object_agg(\n                                -- if unchanged toast, get column name and value from old record\n                                coalesce((c).name, (oc).name),\n                                case\n                                    when (c).name is null then (oc).value\n                                    else (c).value\n                                end\n                            )\n                        from\n                            unnest(columns) c\n                            full outer join unnest(old_columns) oc\n                                on (c).name = (oc).name\n                        where\n                            coalesce((c).is_selectable, (oc).is_selectable)\n                            and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))\n                    )\n                )\n            else '{}'::jsonb\n        end\n        -- Add \"old_record\" key for update and delete\n        || case\n            when action = 'UPDATE' then\n                jsonb_build_object(\n                        'old_record',\n                        (\n                            select jsonb_object_agg((c).name, (c).value)\n                            from unnest(old_columns) c\n                            where\n                                (c).is_selectable\n                                and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))\n                        )\n                    )\n            when action = 'DELETE' then\n                jsonb_build_object(\n                    'old_record',\n                    (\n                        select jsonb_object_agg((c).name, (c).value)\n                        from unnest(old_columns) c\n                        where\n                            (c).is_selectable\n                            and ( not error_record_exceeds_max_size or (octet_length((c).value::text) <= 64))\n                            and ( not is_rls_enabled or (c).is_pkey ) -- if RLS enabled, we can't secure deletes so filter to pkey\n                    )\n                )\n            else '{}'::jsonb\n        end;\n\n        -- Create the prepared statement\n        if is_rls_enabled and action <> 'DELETE' then\n            if (select 1 from pg_prepared_statements where name = 'walrus_rls_stmt' limit 1) > 0 then\n                deallocate walrus_rls_stmt;\n            end if;\n            execute realtime.build_prepared_statement_sql('walrus_rls_stmt', entity_, columns);\n        end if;\n\n        visible_to_subscription_ids = '{}';\n\n        for subscription_id, claims in (\n                select\n                    subs.subscription_id,\n                    subs.claims\n                from\n                    unnest(subscriptions) subs\n                where\n                    subs.entity = entity_\n                    and subs.claims_role = working_role\n                    and (\n                        realtime.is_visible_through_filters(columns, subs.filters)\n                        or (\n                          action = 'DELETE'\n                          and realtime.is_visible_through_filters(old_columns, subs.filters)\n                        )\n                    )\n        ) loop\n\n            if not is_rls_enabled or action = 'DELETE' then\n                visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;\n            else\n                -- Check if RLS allows the role to see the record\n                perform\n                    -- Trim leading and trailing quotes from working_role because set_config\n                    -- doesn't recognize the role as valid if they are included\n                    set_config('role', trim(both '\"' from working_role::text), true),\n                    set_config('request.jwt.claims', claims::text, true);\n\n                execute 'execute walrus_rls_stmt' into subscription_has_access;\n\n                if subscription_has_access then\n                    visible_to_subscription_ids = visible_to_subscription_ids || subscription_id;\n                end if;\n            end if;\n        end loop;\n\n        perform set_config('role', null, true);\n\n        return next (\n            output,\n            is_rls_enabled,\n            visible_to_subscription_ids,\n            case\n                when error_record_exceeds_max_size then array['Error 413: Payload Too Large']\n                else '{}'\n            end\n        )::realtime.wal_rls;\n\n    end if;\nend loop;\n\nperform set_config('role', null, true);\nend;\n",
          "lang": "${PLpgSQL}",
          "return_set": "${composite.wal_rls}",
          "schema": "${schema.realtime}"
        }
      ],
      "broadcast_changes": [
        {
          "arg": {
            "event_name": [
              {
                "type": "${text}"
              }
            ],
            "level": [
              {
                "default": "ROW",
                "type": "${text}"
              }
            ],
            "new": [
              {
                "type": "${record}"
              }
            ],
            "old": [
              {
                "type": "${record}"
              }
            ],
            "operation": [
              {
                "type": "${text}"
              }
            ],
            "table_name": [
              {
                "type": "${text}"
              }
            ],
            "table_schema": [
              {
                "type": "${text}"
              }
            ],
            "topic_name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "DECLARE\n    -- Declare a variable to hold the JSONB representation of the row\n    row_data jsonb := '{}'::jsonb;\nBEGIN\n    IF level = 'STATEMENT' THEN\n        RAISE EXCEPTION 'function can only be triggered for each row, not for each statement';\n    END IF;\n    -- Check the operation type and handle accordingly\n    IF operation = 'INSERT' OR operation = 'UPDATE' OR operation = 'DELETE' THEN\n        row_data := jsonb_build_object('old_record', OLD, 'record', NEW, 'operation', operation, 'table', table_name, 'schema', table_schema);\n        PERFORM realtime.send (row_data, event_name, topic_name);\n    ELSE\n        RAISE EXCEPTION 'Unexpected operation type: %', operation;\n    END IF;\nEXCEPTION\n    WHEN OTHERS THEN\n        RAISE EXCEPTION 'Failed to process the row: %', SQLERRM;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.realtime}"
        }
      ],
      "build_prepared_statement_sql": [
        {
          "arg": {
            "columns": [
              {
                "type": "${sql(\"realtime.wal_column[]\")}"
              }
            ],
            "entity": [
              {
                "type": "${regclass}"
              }
            ],
            "prepared_statement_name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "/*\n      Builds a sql string that, if executed, creates a prepared statement to\n      tests retrive a row from *entity* by its primary key columns.\n      Example\n          select realtime.build_prepared_statement_sql('public.notes', '{\"id\"}'::text[], '{\"bigint\"}'::text[])\n      */\n          select\n      'prepare ' || prepared_statement_name || ' as\n          select\n              exists(\n                  select\n                      1\n                  from\n                      ' || entity || '\n                  where\n                      ' || string_agg(quote_ident(pkc.name) || '=' || quote_nullable(pkc.value #>> '{}') , ' and ') || '\n              )'\n          from\n              unnest(columns) pkc\n          where\n              pkc.is_pkey\n          group by\n              entity\n",
          "lang": "${SQL}",
          "return": "${text}",
          "schema": "${schema.realtime}"
        }
      ],
      "can_insert_object": [
        {
          "arg": {
            "bucketid": [
              {
                "type": "${text}"
              }
            ],
            "metadata": [
              {
                "type": "${jsonb}"
              }
            ],
            "name": [
              {
                "type": "${text}"
              }
            ],
            "owner": [
              {
                "type": "${uuid}"
              }
            ]
          },
          "as": "BEGIN\n  INSERT INTO \"storage\".\"objects\" (\"bucket_id\", \"name\", \"owner\", \"metadata\") VALUES (bucketid, name, owner, metadata);\n  -- hack to rollback the successful insert\n  RAISE sqlstate 'PT200' using\n  message = 'ROLLBACK',\n  detail = 'rollback successful insert';\nEND\n",
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.storage}"
        }
      ],
      "cast": [
        {
          "arg": {
            "type_": [
              {
                "type": "${regtype}"
              }
            ],
            "val": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "declare\n      res jsonb;\n    begin\n      execute format('select to_jsonb(%L::'|| type_::text || ')', val)  into res;\n      return res;\n    end\n",
          "lang": "${PLpgSQL}",
          "return": "${jsonb}",
          "schema": "${schema.realtime}",
          "volatility": "${IMMUTABLE}"
        }
      ],
      "check_equality_op": [
        {
          "arg": {
            "op": [
              {
                "type": "${enum.equality_op}"
              }
            ],
            "type_": [
              {
                "type": "${regtype}"
              }
            ],
            "val_1": [
              {
                "type": "${text}"
              }
            ],
            "val_2": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "/*\n      Casts *val_1* and *val_2* as type *type_* and check the *op* condition for truthiness\n      */\n      declare\n          op_symbol text = (\n              case\n                  when op = 'eq' then '='\n                  when op = 'neq' then '!='\n                  when op = 'lt' then '<'\n                  when op = 'lte' then '<='\n                  when op = 'gt' then '>'\n                  when op = 'gte' then '>='\n                  when op = 'in' then '= any'\n                  else 'UNKNOWN OP'\n              end\n          );\n          res boolean;\n      begin\n          execute format(\n              'select %L::'|| type_::text || ' ' || op_symbol\n              || ' ( %L::'\n              || (\n                  case\n                      when op = 'in' then type_::text || '[]'\n                      else type_::text end\n              )\n              || ')', val_1, val_2) into res;\n          return res;\n      end;\n",
          "lang": "${PLpgSQL}",
          "return": "${boolean}",
          "schema": "${schema.realtime}",
          "volatility": "${IMMUTABLE}"
        }
      ],
      "cleanup_expired_oauth_states": [
        {
          "as": "DELETE FROM public.oauth_states WHERE expires_at IS NOT NULL AND expires_at < now();",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "depends_on": [
            "${table.oauth_states}"
          ],
          "lang": "${SQL}",
          "return": "${void}",
          "schema": "${schema.public}"
        }
      ],
      "cleanup_old_activities": [
        {
          "as": "BEGIN\n  DELETE FROM activity_logs\n  WHERE created_at < NOW() - INTERVAL '90 days';\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "create_oauth_state": [
        {
          "arg": {
            "p_ttl_seconds": [
              {
                "default": 300,
                "type": "${integer}"
              }
            ],
            "p_user_id": [
              {
                "type": "${uuid}"
              }
            ]
          },
          "as": "DECLARE\n  v_state text := encode(gen_random_bytes(24), 'hex');\nBEGIN\n  INSERT INTO public.oauth_states(state, user_id, expires_at) VALUES (v_state, p_user_id, now() + (p_ttl_seconds || ' seconds')::interval);\n  RETURN v_state;\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${text}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "decrypt_token": [
        {
          "arg": {
            "encrypted": [
              {
                "type": "${bytea}"
              }
            ]
          },
          "as": "SELECT pgp_sym_decrypt(encrypted, encode((SELECT key FROM public.secret_keys WHERE id='tokens_encryption'), 'hex'))::text;",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${SQL}",
          "return": "${text}",
          "schema": "${schema.public}",
          "volatility": "${STABLE}"
        }
      ],
      "delete_all_users": [
        {
          "as": "BEGIN\n  -- حذف جميع المستخدمين من جدول profiles\n  DELETE FROM public.profiles;\n\n  -- حذف جميع المستخدمين من نظام المصادقة (auth)\n  DELETE FROM auth.users;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "delete_leaf_prefixes": [
        {
          "arg": {
            "bucket_ids": [
              {
                "type": "${sql(\"text[]\")}"
              }
            ],
            "names": [
              {
                "type": "${sql(\"text[]\")}"
              }
            ]
          },
          "as": "DECLARE\n    v_rows_deleted integer;\nBEGIN\n    LOOP\n        WITH candidates AS (\n            SELECT DISTINCT\n                t.bucket_id,\n                unnest(storage.get_prefixes(t.name)) AS name\n            FROM unnest(bucket_ids, names) AS t(bucket_id, name)\n        ),\n        uniq AS (\n             SELECT\n                 bucket_id,\n                 name,\n                 storage.get_level(name) AS level\n             FROM candidates\n             WHERE name <> ''\n             GROUP BY bucket_id, name\n        ),\n        leaf AS (\n             SELECT\n                 p.bucket_id,\n                 p.name,\n                 p.level\n             FROM storage.prefixes AS p\n                  JOIN uniq AS u\n                       ON u.bucket_id = p.bucket_id\n                           AND u.name = p.name\n                           AND u.level = p.level\n             WHERE NOT EXISTS (\n                 SELECT 1\n                 FROM storage.objects AS o\n                 WHERE o.bucket_id = p.bucket_id\n                   AND o.level = p.level + 1\n                   AND o.name COLLATE \"C\" LIKE p.name || '/%'\n             )\n             AND NOT EXISTS (\n                 SELECT 1\n                 FROM storage.prefixes AS c\n                 WHERE c.bucket_id = p.bucket_id\n                   AND c.level = p.level + 1\n                   AND c.name COLLATE \"C\" LIKE p.name || '/%'\n             )\n        )\n        DELETE\n        FROM storage.prefixes AS p\n            USING leaf AS l\n        WHERE p.bucket_id = l.bucket_id\n          AND p.name = l.name\n          AND p.level = l.level;\n\n        GET DIAGNOSTICS v_rows_deleted = ROW_COUNT;\n        EXIT WHEN v_rows_deleted = 0;\n    END LOOP;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.storage}",
          "security": "${DEFINER}"
        }
      ],
      "delete_prefix": [
        {
          "arg": {
            "_bucket_id": [
              {
                "type": "${text}"
              }
            ],
            "_name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "BEGIN\n    -- Check if we can delete the prefix\n    IF EXISTS(\n        SELECT FROM \"storage\".\"prefixes\"\n        WHERE \"prefixes\".\"bucket_id\" = \"_bucket_id\"\n          AND level = \"storage\".\"get_level\"(\"_name\") + 1\n          AND \"prefixes\".\"name\" COLLATE \"C\" LIKE \"_name\" || '/%'\n        LIMIT 1\n    )\n    OR EXISTS(\n        SELECT FROM \"storage\".\"objects\"\n        WHERE \"objects\".\"bucket_id\" = \"_bucket_id\"\n          AND \"storage\".\"get_level\"(\"objects\".\"name\") = \"storage\".\"get_level\"(\"_name\") + 1\n          AND \"objects\".\"name\" COLLATE \"C\" LIKE \"_name\" || '/%'\n        LIMIT 1\n    ) THEN\n    -- There are sub-objects, skip deletion\n    RETURN false;\n    ELSE\n        DELETE FROM \"storage\".\"prefixes\"\n        WHERE \"prefixes\".\"bucket_id\" = \"_bucket_id\"\n          AND level = \"storage\".\"get_level\"(\"_name\")\n          AND \"prefixes\".\"name\" = \"_name\";\n        RETURN true;\n    END IF;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${boolean}",
          "schema": "${schema.storage}",
          "security": "${DEFINER}"
        }
      ],
      "delete_prefix_hierarchy_trigger": [
        {
          "as": "DECLARE\n    prefix text;\nBEGIN\n    prefix := \"storage\".\"get_prefix\"(OLD.\"name\");\n\n    IF coalesce(prefix, '') != '' THEN\n        PERFORM \"storage\".\"delete_prefix\"(OLD.\"bucket_id\", prefix);\n    END IF;\n\n    RETURN OLD;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}"
        }
      ],
      "email": [
        {
          "as": "select \n  coalesce(\n    nullif(current_setting('request.jwt.claim.email', true), ''),\n    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'email')\n  )::text\n",
          "comment": "Deprecated. Use auth.jwt() -> 'email' instead.",
          "lang": "${SQL}",
          "return": "${text}",
          "schema": "${schema.auth}",
          "volatility": "${STABLE}"
        }
      ],
      "encrypt_token": [
        {
          "arg": {
            "plaintext": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "SELECT pgp_sym_encrypt(plaintext::text, encode((SELECT key FROM public.secret_keys WHERE id='tokens_encryption'), 'hex'), 'cipher-algo=aes256');",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "depends_on": [
            "${table.secret_keys}"
          ],
          "lang": "${SQL}",
          "return": "${bytea}",
          "schema": "${schema.public}",
          "volatility": "${STABLE}"
        }
      ],
      "enforce_bucket_name_length": [
        {
          "as": "begin\n    if length(new.name) > 100 then\n        raise exception 'bucket name \"%\" is too long (% characters). Max is 100.', new.name, length(new.name);\n    end if;\n    return new;\nend;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}"
        }
      ],
      "extension": [
        {
          "arg": {
            "name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "DECLARE\n    _parts text[];\n    _filename text;\nBEGIN\n    SELECT string_to_array(name, '/') INTO _parts;\n    SELECT _parts[array_length(_parts,1)] INTO _filename;\n    RETURN reverse(split_part(reverse(_filename), '.', 1));\nEND\n",
          "lang": "${PLpgSQL}",
          "return": "${text}",
          "schema": "${schema.storage}",
          "volatility": "${IMMUTABLE}"
        }
      ],
      "filename": [
        {
          "arg": {
            "name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "DECLARE\n_parts text[];\nBEGIN\n\tselect string_to_array(name, '/') into _parts;\n\treturn _parts[array_length(_parts,1)];\nEND\n",
          "lang": "${PLpgSQL}",
          "return": "${text}",
          "schema": "${schema.storage}"
        }
      ],
      "foldername": [
        {
          "arg": {
            "name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "DECLARE\n    _parts text[];\nBEGIN\n    -- Split on \"/\" to get path segments\n    SELECT string_to_array(name, '/') INTO _parts;\n    -- Return everything except the last segment\n    RETURN _parts[1 : array_length(_parts,1) - 1];\nEND\n",
          "lang": "${PLpgSQL}",
          "return": "${sql(\"text[]\")}",
          "schema": "${schema.storage}",
          "volatility": "${IMMUTABLE}"
        }
      ],
      "get_auth": [
        {
          "arg": {
            "p_usename": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "begin\n    raise debug 'PgBouncer auth request: %', p_usename;\n\n    return query\n    select \n        rolname::text, \n        case when rolvaliduntil < now() \n            then null \n            else rolpassword::text \n        end \n    from pg_authid \n    where rolname=$1 and rolcanlogin;\nend;\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "password": [
                  {
                    "type": "${text}"
                  }
                ],
                "username": [
                  {
                    "type": "${text}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.pgbouncer}",
          "security": "${DEFINER}"
        }
      ],
      "get_decrypted_tokens": [
        {
          "arg": {
            "p_id": [
              {
                "type": "${uuid}"
              }
            ]
          },
          "as": "SELECT public.decrypt_token(access_token_encrypted) AS access_token,\n         public.decrypt_token(refresh_token_encrypted) AS refresh_token,\n         expires_at\n  FROM public.oauth_tokens WHERE id = p_id;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${SQL}",
          "return_table": [
            {
              "column": {
                "access_token": [
                  {
                    "type": "${text}"
                  }
                ],
                "expires_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "refresh_token": [
                  {
                    "type": "${text}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "get_level": [
        {
          "arg": {
            "name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "SELECT array_length(string_to_array(\"name\", '/'), 1);",
          "lang": "${SQL}",
          "return": "${integer}",
          "schema": "${schema.storage}",
          "strict": true,
          "volatility": "${IMMUTABLE}"
        }
      ],
      "get_prefix": [
        {
          "arg": {
            "name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "SELECT\n    CASE WHEN strpos(\"name\", '/') > 0 THEN\n             regexp_replace(\"name\", '[\\/]{1}[^\\/]+\\/?$', '')\n         ELSE\n             ''\n        END;\n",
          "lang": "${SQL}",
          "return": "${text}",
          "schema": "${schema.storage}",
          "strict": true,
          "volatility": "${IMMUTABLE}"
        }
      ],
      "get_prefixes": [
        {
          "arg": {
            "name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "DECLARE\n    parts text[];\n    prefixes text[];\n    prefix text;\nBEGIN\n    -- Split the name into parts by '/'\n    parts := string_to_array(\"name\", '/');\n    prefixes := '{}';\n\n    -- Construct the prefixes, stopping one level below the last part\n    FOR i IN 1..array_length(parts, 1) - 1 LOOP\n            prefix := array_to_string(parts[1:i], '/');\n            prefixes := array_append(prefixes, prefix);\n    END LOOP;\n\n    RETURN prefixes;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${sql(\"text[]\")}",
          "schema": "${schema.storage}",
          "strict": true,
          "volatility": "${IMMUTABLE}"
        }
      ],
      "get_review_stats": [
        {
          "arg": {
            "p_user_id": [
              {
                "type": "${uuid}"
              }
            ]
          },
          "as": "BEGIN\n  RETURN QUERY\n  SELECT \n    COUNT(*)::BIGINT as total_reviews,\n    COUNT(*) FILTER (WHERE r.has_reply = false AND r.reply_text IS NULL)::BIGINT as pending_reviews,\n    COUNT(*) FILTER (WHERE r.has_reply = true OR r.reply_text IS NOT NULL)::BIGINT as responded_reviews,\n    CASE \n      WHEN COUNT(*) > 0 THEN \n        ROUND(\n          (COUNT(*) FILTER (WHERE r.has_reply = true OR r.reply_text IS NOT NULL)::NUMERIC / COUNT(*)::NUMERIC) * 100, \n          1\n        )\n      ELSE 0 \n    END as response_rate,\n    ROUND(AVG(r.rating), 1) as avg_rating,\n    COUNT(*) FILTER (WHERE r.rating >= 4)::BIGINT as positive_count,\n    COUNT(*) FILTER (WHERE r.rating = 3)::BIGINT as neutral_count,\n    COUNT(*) FILTER (WHERE r.rating <= 2)::BIGINT as negative_count\n  FROM gmb_reviews r\n  INNER JOIN gmb_locations l ON r.location_id = l.id\n  WHERE l.user_id = p_user_id;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "avg_rating": [
                  {
                    "type": "${numeric}"
                  }
                ],
                "negative_count": [
                  {
                    "type": "${bigint}"
                  }
                ],
                "neutral_count": [
                  {
                    "type": "${bigint}"
                  }
                ],
                "pending_reviews": [
                  {
                    "type": "${bigint}"
                  }
                ],
                "positive_count": [
                  {
                    "type": "${bigint}"
                  }
                ],
                "responded_reviews": [
                  {
                    "type": "${bigint}"
                  }
                ],
                "response_rate": [
                  {
                    "type": "${numeric}"
                  }
                ],
                "total_reviews": [
                  {
                    "type": "${bigint}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "get_size_by_bucket": [
        {
          "as": "BEGIN\n    return query\n        select sum((metadata->>'size')::bigint) as size, obj.bucket_id\n        from \"storage\".objects as obj\n        group by obj.bucket_id;\nEND\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "bucket_id": [
                  {
                    "type": "${text}"
                  }
                ],
                "size": [
                  {
                    "type": "${bigint}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.storage}",
          "volatility": "${STABLE}"
        }
      ],
      "get_unread_notifications_count": [
        {
          "arg": {
            "p_user_id": [
              {
                "type": "${uuid}"
              }
            ]
          },
          "as": "BEGIN\n  RETURN (SELECT COUNT(*)::integer FROM public.notifications WHERE user_id = p_user_id AND read = false);\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${integer}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "grant_pg_cron_access": [
        {
          "as": "BEGIN\n  IF EXISTS (\n    SELECT\n    FROM pg_event_trigger_ddl_commands() AS ev\n    JOIN pg_extension AS ext\n    ON ev.objid = ext.oid\n    WHERE ext.extname = 'pg_cron'\n  )\n  THEN\n    grant usage on schema cron to postgres with grant option;\n\n    alter default privileges in schema cron grant all on tables to postgres with grant option;\n    alter default privileges in schema cron grant all on functions to postgres with grant option;\n    alter default privileges in schema cron grant all on sequences to postgres with grant option;\n\n    alter default privileges for user supabase_admin in schema cron grant all\n        on sequences to postgres with grant option;\n    alter default privileges for user supabase_admin in schema cron grant all\n        on tables to postgres with grant option;\n    alter default privileges for user supabase_admin in schema cron grant all\n        on functions to postgres with grant option;\n\n    grant all privileges on all tables in schema cron to postgres with grant option;\n    revoke all on table cron.job from postgres;\n    grant select on table cron.job to postgres with grant option;\n  END IF;\nEND;\n",
          "comment": "Grants access to pg_cron",
          "lang": "${PLpgSQL}",
          "return": "${event_trigger}",
          "schema": "${schema.extensions}"
        }
      ],
      "grant_pg_graphql_access": [
        {
          "as": "DECLARE\n    func_is_graphql_resolve bool;\nBEGIN\n    func_is_graphql_resolve = (\n        SELECT n.proname = 'resolve'\n        FROM pg_event_trigger_ddl_commands() AS ev\n        LEFT JOIN pg_catalog.pg_proc AS n\n        ON ev.objid = n.oid\n    );\n\n    IF func_is_graphql_resolve\n    THEN\n        -- Update public wrapper to pass all arguments through to the pg_graphql resolve func\n        DROP FUNCTION IF EXISTS graphql_public.graphql;\n        create or replace function graphql_public.graphql(\n            \"operationName\" text default null,\n            query text default null,\n            variables jsonb default null,\n            extensions jsonb default null\n        )\n            returns jsonb\n            language sql\n        as $$\n            select graphql.resolve(\n                query := query,\n                variables := coalesce(variables, '{}'),\n                \"operationName\" := \"operationName\",\n                extensions := extensions\n            );\n        $$;\n\n        -- This hook executes when `graphql.resolve` is created. That is not necessarily the last\n        -- function in the extension so we need to grant permissions on existing entities AND\n        -- update default permissions to any others that are created after `graphql.resolve`\n        grant usage on schema graphql to postgres, anon, authenticated, service_role;\n        grant select on all tables in schema graphql to postgres, anon, authenticated, service_role;\n        grant execute on all functions in schema graphql to postgres, anon, authenticated, service_role;\n        grant all on all sequences in schema graphql to postgres, anon, authenticated, service_role;\n        alter default privileges in schema graphql grant all on tables to postgres, anon, authenticated, service_role;\n        alter default privileges in schema graphql grant all on functions to postgres, anon, authenticated, service_role;\n        alter default privileges in schema graphql grant all on sequences to postgres, anon, authenticated, service_role;\n\n        -- Allow postgres role to allow granting usage on graphql and graphql_public schemas to custom roles\n        grant usage on schema graphql_public to postgres with grant option;\n        grant usage on schema graphql to postgres with grant option;\n    END IF;\n\nEND;\n",
          "comment": "Grants access to pg_graphql",
          "lang": "${PLpgSQL}",
          "return": "${event_trigger}",
          "schema": "${schema.extensions}"
        }
      ],
      "grant_pg_net_access": [
        {
          "as": "BEGIN\n  IF EXISTS (\n    SELECT 1\n    FROM pg_event_trigger_ddl_commands() AS ev\n    JOIN pg_extension AS ext\n    ON ev.objid = ext.oid\n    WHERE ext.extname = 'pg_net'\n  )\n  THEN\n    IF NOT EXISTS (\n      SELECT 1\n      FROM pg_roles\n      WHERE rolname = 'supabase_functions_admin'\n    )\n    THEN\n      CREATE USER supabase_functions_admin NOINHERIT CREATEROLE LOGIN NOREPLICATION;\n    END IF;\n\n    GRANT USAGE ON SCHEMA net TO supabase_functions_admin, postgres, anon, authenticated, service_role;\n\n    IF EXISTS (\n      SELECT FROM pg_extension\n      WHERE extname = 'pg_net'\n      -- all versions in use on existing projects as of 2025-02-20\n      -- version 0.12.0 onwards don't need these applied\n      AND extversion IN ('0.2', '0.6', '0.7', '0.7.1', '0.8', '0.10.0', '0.11.0')\n    ) THEN\n      ALTER function net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) SECURITY DEFINER;\n      ALTER function net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) SECURITY DEFINER;\n\n      ALTER function net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) SET search_path = net;\n      ALTER function net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) SET search_path = net;\n\n      REVOKE ALL ON FUNCTION net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) FROM PUBLIC;\n      REVOKE ALL ON FUNCTION net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) FROM PUBLIC;\n\n      GRANT EXECUTE ON FUNCTION net.http_get(url text, params jsonb, headers jsonb, timeout_milliseconds integer) TO supabase_functions_admin, postgres, anon, authenticated, service_role;\n      GRANT EXECUTE ON FUNCTION net.http_post(url text, body jsonb, params jsonb, headers jsonb, timeout_milliseconds integer) TO supabase_functions_admin, postgres, anon, authenticated, service_role;\n    END IF;\n  END IF;\nEND;\n",
          "comment": "Grants access to pg_net",
          "lang": "${PLpgSQL}",
          "return": "${event_trigger}",
          "schema": "${schema.extensions}"
        }
      ],
      "handle_new_user": [
        {
          "as": "BEGIN\n  -- Insert profile, handling both email and phone signups\n  INSERT INTO public.profiles (id, email, full_name, phone, user_id, created_at, updated_at)\n  VALUES (\n    new.id,\n    new.email, -- Can be NULL for phone signups\n    COALESCE(\n      new.raw_user_meta_data->>'full_name',\n      new.email,\n      new.phone,\n      'User'\n    ), -- Use phone as fallback for full_name\n    new.phone, -- Can be NULL for email signups\n    new.id, -- user_id should match id\n    NOW(),\n    NOW()\n  )\n  ON CONFLICT (id) DO UPDATE\n  SET \n    email = COALESCE(EXCLUDED.email, profiles.email),\n    full_name = COALESCE(EXCLUDED.full_name, profiles.full_name),\n    phone = COALESCE(EXCLUDED.phone, profiles.phone),\n    user_id = COALESCE(EXCLUDED.user_id, profiles.user_id),\n    updated_at = NOW();\n\n  RETURN new;\nEXCEPTION\n  WHEN others THEN\n    -- Log error but don't fail user creation\n    RAISE WARNING 'Error creating profile for user %: %', new.id, SQLERRM;\n    RETURN new;\nEND;\n",
          "comment": "Automatically creates a profile when a new user signs up. Handles both email and phone authentication. Uses fixed search_path for security.",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "is_visible_through_filters": [
        {
          "arg": {
            "columns": [
              {
                "type": "${sql(\"realtime.wal_column[]\")}"
              }
            ],
            "filters": [
              {
                "type": "${sql(\"realtime.user_defined_filter[]\")}"
              }
            ]
          },
          "as": "/*\n    Should the record be visible (true) or filtered out (false) after *filters* are applied\n    */\n        select\n            -- Default to allowed when no filters present\n            $2 is null -- no filters. this should not happen because subscriptions has a default\n            or array_length($2, 1) is null -- array length of an empty array is null\n            or bool_and(\n                coalesce(\n                    realtime.check_equality_op(\n                        op:=f.op,\n                        type_:=coalesce(\n                            col.type_oid::regtype, -- null when wal2json version <= 2.4\n                            col.type_name::regtype\n                        ),\n                        -- cast jsonb to text\n                        val_1:=col.value #>> '{}',\n                        val_2:=f.value\n                    ),\n                    false -- if null, filter does not match\n                )\n            )\n        from\n            unnest(filters) f\n            join unnest(columns) col\n                on f.column_name = col.name;\n",
          "lang": "${SQL}",
          "return": "${boolean}",
          "schema": "${schema.realtime}",
          "volatility": "${IMMUTABLE}"
        }
      ],
      "join_room": [
        {
          "arg": {
            "p_room_id": [
              {
                "type": "${uuid}"
              }
            ]
          },
          "as": "DECLARE\n  v_user uuid := auth.uid();\nBEGIN\n  IF v_user IS NULL THEN\n    RAISE EXCEPTION 'Unauthorized';\n  END IF;\n  INSERT INTO public.room_members(user_id, room_id)\n  VALUES (v_user, p_room_id)\n  ON CONFLICT (user_id, room_id) DO NOTHING;\nEND;\n",
          "config_params": [
            {
              "search_path": "public"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "jwt": [
        {
          "as": "select \n    coalesce(\n        nullif(current_setting('request.jwt.claim', true), ''),\n        nullif(current_setting('request.jwt.claims', true), '')\n    )::jsonb\n",
          "lang": "${SQL}",
          "return": "${jsonb}",
          "schema": "${schema.auth}",
          "volatility": "${STABLE}"
        }
      ],
      "leave_room": [
        {
          "arg": {
            "p_room_id": [
              {
                "type": "${uuid}"
              }
            ]
          },
          "as": "DECLARE\n  v_user uuid := auth.uid();\nBEGIN\n  IF v_user IS NULL THEN\n    RAISE EXCEPTION 'Unauthorized';\n  END IF;\n  DELETE FROM public.room_members\n  WHERE user_id = v_user AND room_id = p_room_id;\nEND;\n",
          "config_params": [
            {
              "search_path": "public"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "list_changes": [
        {
          "arg": {
            "max_changes": [
              {
                "type": "${integer}"
              }
            ],
            "max_record_bytes": [
              {
                "type": "${integer}"
              }
            ],
            "publication": [
              {
                "type": "${name}"
              }
            ],
            "slot_name": [
              {
                "type": "${name}"
              }
            ]
          },
          "as": "with pub as (\n        select\n          concat_ws(\n            ',',\n            case when bool_or(pubinsert) then 'insert' else null end,\n            case when bool_or(pubupdate) then 'update' else null end,\n            case when bool_or(pubdelete) then 'delete' else null end\n          ) as w2j_actions,\n          coalesce(\n            string_agg(\n              realtime.quote_wal2json(format('%I.%I', schemaname, tablename)::regclass),\n              ','\n            ) filter (where ppt.tablename is not null and ppt.tablename not like '% %'),\n            ''\n          ) w2j_add_tables\n        from\n          pg_publication pp\n          left join pg_publication_tables ppt\n            on pp.pubname = ppt.pubname\n        where\n          pp.pubname = publication\n        group by\n          pp.pubname\n        limit 1\n      ),\n      w2j as (\n        select\n          x.*, pub.w2j_add_tables\n        from\n          pub,\n          pg_logical_slot_get_changes(\n            slot_name, null, max_changes,\n            'include-pk', 'true',\n            'include-transaction', 'false',\n            'include-timestamp', 'true',\n            'include-type-oids', 'true',\n            'format-version', '2',\n            'actions', pub.w2j_actions,\n            'add-tables', pub.w2j_add_tables\n          ) x\n      )\n      select\n        xyz.wal,\n        xyz.is_rls_enabled,\n        xyz.subscription_ids,\n        xyz.errors\n      from\n        w2j,\n        realtime.apply_rls(\n          wal := w2j.data::jsonb,\n          max_record_bytes := max_record_bytes\n        ) xyz(wal, is_rls_enabled, subscription_ids, errors)\n      where\n        w2j.w2j_add_tables <> ''\n        and xyz.subscription_ids[1] is not null\n",
          "config_params": [
            {
              "log_min_messages": "fatal"
            }
          ],
          "lang": "${SQL}",
          "return_set": "${composite.wal_rls}",
          "schema": "${schema.realtime}"
        }
      ],
      "list_multipart_uploads_with_delimiter": [
        {
          "arg": {
            "bucket_id": [
              {
                "type": "${text}"
              }
            ],
            "delimiter_param": [
              {
                "type": "${text}"
              }
            ],
            "max_keys": [
              {
                "default": 100,
                "type": "${integer}"
              }
            ],
            "next_key_token": [
              {
                "default": "",
                "type": "${text}"
              }
            ],
            "next_upload_token": [
              {
                "default": "",
                "type": "${text}"
              }
            ],
            "prefix_param": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "BEGIN\n    RETURN QUERY EXECUTE\n        'SELECT DISTINCT ON(key COLLATE \"C\") * from (\n            SELECT\n                CASE\n                    WHEN position($2 IN substring(key from length($1) + 1)) > 0 THEN\n                        substring(key from 1 for length($1) + position($2 IN substring(key from length($1) + 1)))\n                    ELSE\n                        key\n                END AS key, id, created_at\n            FROM\n                storage.s3_multipart_uploads\n            WHERE\n                bucket_id = $5 AND\n                key ILIKE $1 || ''%'' AND\n                CASE\n                    WHEN $4 != '''' AND $6 = '''' THEN\n                        CASE\n                            WHEN position($2 IN substring(key from length($1) + 1)) > 0 THEN\n                                substring(key from 1 for length($1) + position($2 IN substring(key from length($1) + 1))) COLLATE \"C\" > $4\n                            ELSE\n                                key COLLATE \"C\" > $4\n                            END\n                    ELSE\n                        true\n                END AND\n                CASE\n                    WHEN $6 != '''' THEN\n                        id COLLATE \"C\" > $6\n                    ELSE\n                        true\n                    END\n            ORDER BY\n                key COLLATE \"C\" ASC, created_at ASC) as e order by key COLLATE \"C\" LIMIT $3'\n        USING prefix_param, delimiter_param, max_keys, next_key_token, bucket_id, next_upload_token;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "created_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "id": [
                  {
                    "type": "${text}"
                  }
                ],
                "key": [
                  {
                    "type": "${text}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "list_objects_with_delimiter": [
        {
          "arg": {
            "bucket_id": [
              {
                "type": "${text}"
              }
            ],
            "delimiter_param": [
              {
                "type": "${text}"
              }
            ],
            "max_keys": [
              {
                "default": 100,
                "type": "${integer}"
              }
            ],
            "next_token": [
              {
                "default": "",
                "type": "${text}"
              }
            ],
            "prefix_param": [
              {
                "type": "${text}"
              }
            ],
            "start_after": [
              {
                "default": "",
                "type": "${text}"
              }
            ]
          },
          "as": "BEGIN\n    RETURN QUERY EXECUTE\n        'SELECT DISTINCT ON(name COLLATE \"C\") * from (\n            SELECT\n                CASE\n                    WHEN position($2 IN substring(name from length($1) + 1)) > 0 THEN\n                        substring(name from 1 for length($1) + position($2 IN substring(name from length($1) + 1)))\n                    ELSE\n                        name\n                END AS name, id, metadata, updated_at\n            FROM\n                storage.objects\n            WHERE\n                bucket_id = $5 AND\n                name ILIKE $1 || ''%'' AND\n                CASE\n                    WHEN $6 != '''' THEN\n                    name COLLATE \"C\" > $6\n                ELSE true END\n                AND CASE\n                    WHEN $4 != '''' THEN\n                        CASE\n                            WHEN position($2 IN substring(name from length($1) + 1)) > 0 THEN\n                                substring(name from 1 for length($1) + position($2 IN substring(name from length($1) + 1))) COLLATE \"C\" > $4\n                            ELSE\n                                name COLLATE \"C\" > $4\n                            END\n                    ELSE\n                        true\n                END\n            ORDER BY\n                name COLLATE \"C\" ASC) as e order by name COLLATE \"C\" LIMIT $3'\n        USING prefix_param, delimiter_param, max_keys, next_token, bucket_id, start_after;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "id": [
                  {
                    "type": "${uuid}"
                  }
                ],
                "metadata": [
                  {
                    "type": "${jsonb}"
                  }
                ],
                "name": [
                  {
                    "type": "${text}"
                  }
                ],
                "updated_at": [
                  {
                    "type": "${timestampz}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "lock_top_prefixes": [
        {
          "arg": {
            "bucket_ids": [
              {
                "type": "${sql(\"text[]\")}"
              }
            ],
            "names": [
              {
                "type": "${sql(\"text[]\")}"
              }
            ]
          },
          "as": "DECLARE\n    v_bucket text;\n    v_top text;\nBEGIN\n    FOR v_bucket, v_top IN\n        SELECT DISTINCT t.bucket_id,\n            split_part(t.name, '/', 1) AS top\n        FROM unnest(bucket_ids, names) AS t(bucket_id, name)\n        WHERE t.name <> ''\n        ORDER BY 1, 2\n        LOOP\n            PERFORM pg_advisory_xact_lock(hashtextextended(v_bucket || '/' || v_top, 0));\n        END LOOP;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.storage}",
          "security": "${DEFINER}"
        }
      ],
      "moddatetime": [
        {
          "as": "begin\n  new.updated_at = now();\n  return new;\nend;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "normalize_location_id": [
        {
          "arg": {
            "location_id_text": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "BEGIN\n  RETURN CASE \n    WHEN location_id_text LIKE 'locations/%' THEN \n      SUBSTRING(location_id_text FROM 'locations/([^/]+)$')\n    WHEN location_id_text LIKE 'accounts/%/locations/%' THEN \n      SUBSTRING(location_id_text FROM 'locations/([^/]+)$')\n    ELSE location_id_text\n  END;\nEND;\n",
          "comment": "Normalizes location ID from various formats. Uses fixed search_path for security.",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${text}",
          "schema": "${schema.public}",
          "volatility": "${IMMUTABLE}"
        }
      ],
      "notify_new_review": [
        {
          "as": "BEGIN\n  PERFORM pg_notify(\n    'new_review',\n    json_build_object(\n      'review_id', NEW.id,\n      'location_id', NEW.location_id,\n      'rating', NEW.rating\n    )::text\n  );\n  RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "oauth_states_set_expiry": [
        {
          "as": "BEGIN\nIF NEW.expires_at IS NULL THEN\nNEW.expires_at := now() + interval '15 minutes';\nEND IF;\nRETURN NEW;\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "objects_delete_cleanup": [
        {
          "as": "DECLARE\n    v_bucket_ids text[];\n    v_names      text[];\nBEGIN\n    IF current_setting('storage.gc.prefixes', true) = '1' THEN\n        RETURN NULL;\n    END IF;\n\n    PERFORM set_config('storage.gc.prefixes', '1', true);\n\n    SELECT COALESCE(array_agg(d.bucket_id), '{}'),\n           COALESCE(array_agg(d.name), '{}')\n    INTO v_bucket_ids, v_names\n    FROM deleted AS d\n    WHERE d.name <> '';\n\n    PERFORM storage.lock_top_prefixes(v_bucket_ids, v_names);\n    PERFORM storage.delete_leaf_prefixes(v_bucket_ids, v_names);\n\n    RETURN NULL;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}",
          "security": "${DEFINER}"
        }
      ],
      "objects_insert_prefix_trigger": [
        {
          "as": "BEGIN\n    PERFORM \"storage\".\"add_prefixes\"(NEW.\"bucket_id\", NEW.\"name\");\n    NEW.level := \"storage\".\"get_level\"(NEW.\"name\");\n\n    RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}"
        }
      ],
      "objects_update_cleanup": [
        {
          "as": "DECLARE\n    -- NEW - OLD (destinations to create prefixes for)\n    v_add_bucket_ids text[];\n    v_add_names      text[];\n\n    -- OLD - NEW (sources to prune)\n    v_src_bucket_ids text[];\n    v_src_names      text[];\nBEGIN\n    IF TG_OP <> 'UPDATE' THEN\n        RETURN NULL;\n    END IF;\n\n    -- 1) Compute NEW−OLD (added paths) and OLD−NEW (moved-away paths)\n    WITH added AS (\n        SELECT n.bucket_id, n.name\n        FROM new_rows n\n        WHERE n.name <> '' AND position('/' in n.name) > 0\n        EXCEPT\n        SELECT o.bucket_id, o.name FROM old_rows o WHERE o.name <> ''\n    ),\n    moved AS (\n         SELECT o.bucket_id, o.name\n         FROM old_rows o\n         WHERE o.name <> ''\n         EXCEPT\n         SELECT n.bucket_id, n.name FROM new_rows n WHERE n.name <> ''\n    )\n    SELECT\n        -- arrays for ADDED (dest) in stable order\n        COALESCE( (SELECT array_agg(a.bucket_id ORDER BY a.bucket_id, a.name) FROM added a), '{}' ),\n        COALESCE( (SELECT array_agg(a.name      ORDER BY a.bucket_id, a.name) FROM added a), '{}' ),\n        -- arrays for MOVED (src) in stable order\n        COALESCE( (SELECT array_agg(m.bucket_id ORDER BY m.bucket_id, m.name) FROM moved m), '{}' ),\n        COALESCE( (SELECT array_agg(m.name      ORDER BY m.bucket_id, m.name) FROM moved m), '{}' )\n    INTO v_add_bucket_ids, v_add_names, v_src_bucket_ids, v_src_names;\n\n    -- Nothing to do?\n    IF (array_length(v_add_bucket_ids, 1) IS NULL) AND (array_length(v_src_bucket_ids, 1) IS NULL) THEN\n        RETURN NULL;\n    END IF;\n\n    -- 2) Take per-(bucket, top) locks: ALL prefixes in consistent global order to prevent deadlocks\n    DECLARE\n        v_all_bucket_ids text[];\n        v_all_names text[];\n    BEGIN\n        -- Combine source and destination arrays for consistent lock ordering\n        v_all_bucket_ids := COALESCE(v_src_bucket_ids, '{}') || COALESCE(v_add_bucket_ids, '{}');\n        v_all_names := COALESCE(v_src_names, '{}') || COALESCE(v_add_names, '{}');\n\n        -- Single lock call ensures consistent global ordering across all transactions\n        IF array_length(v_all_bucket_ids, 1) IS NOT NULL THEN\n            PERFORM storage.lock_top_prefixes(v_all_bucket_ids, v_all_names);\n        END IF;\n    END;\n\n    -- 3) Create destination prefixes (NEW−OLD) BEFORE pruning sources\n    IF array_length(v_add_bucket_ids, 1) IS NOT NULL THEN\n        WITH candidates AS (\n            SELECT DISTINCT t.bucket_id, unnest(storage.get_prefixes(t.name)) AS name\n            FROM unnest(v_add_bucket_ids, v_add_names) AS t(bucket_id, name)\n            WHERE name <> ''\n        )\n        INSERT INTO storage.prefixes (bucket_id, name)\n        SELECT c.bucket_id, c.name\n        FROM candidates c\n        ON CONFLICT DO NOTHING;\n    END IF;\n\n    -- 4) Prune source prefixes bottom-up for OLD−NEW\n    IF array_length(v_src_bucket_ids, 1) IS NOT NULL THEN\n        -- re-entrancy guard so DELETE on prefixes won't recurse\n        IF current_setting('storage.gc.prefixes', true) <> '1' THEN\n            PERFORM set_config('storage.gc.prefixes', '1', true);\n        END IF;\n\n        PERFORM storage.delete_leaf_prefixes(v_src_bucket_ids, v_src_names);\n    END IF;\n\n    RETURN NULL;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}",
          "security": "${DEFINER}"
        }
      ],
      "objects_update_level_trigger": [
        {
          "as": "BEGIN\n    -- Ensure this is an update operation and the name has changed\n    IF TG_OP = 'UPDATE' AND (NEW.\"name\" <> OLD.\"name\" OR NEW.\"bucket_id\" <> OLD.\"bucket_id\") THEN\n        -- Set the new level\n        NEW.\"level\" := \"storage\".\"get_level\"(NEW.\"name\");\n    END IF;\n    RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}"
        }
      ],
      "objects_update_prefix_trigger": [
        {
          "as": "DECLARE\n    old_prefixes TEXT[];\nBEGIN\n    -- Ensure this is an update operation and the name has changed\n    IF TG_OP = 'UPDATE' AND (NEW.\"name\" <> OLD.\"name\" OR NEW.\"bucket_id\" <> OLD.\"bucket_id\") THEN\n        -- Retrieve old prefixes\n        old_prefixes := \"storage\".\"get_prefixes\"(OLD.\"name\");\n\n        -- Remove old prefixes that are only used by this object\n        WITH all_prefixes as (\n            SELECT unnest(old_prefixes) as prefix\n        ),\n        can_delete_prefixes as (\n             SELECT prefix\n             FROM all_prefixes\n             WHERE NOT EXISTS (\n                 SELECT 1 FROM \"storage\".\"objects\"\n                 WHERE \"bucket_id\" = OLD.\"bucket_id\"\n                   AND \"name\" <> OLD.\"name\"\n                   AND \"name\" LIKE (prefix || '%')\n             )\n         )\n        DELETE FROM \"storage\".\"prefixes\" WHERE name IN (SELECT prefix FROM can_delete_prefixes);\n\n        -- Add new prefixes\n        PERFORM \"storage\".\"add_prefixes\"(NEW.\"bucket_id\", NEW.\"name\");\n    END IF;\n    -- Set the new level\n    NEW.\"level\" := \"storage\".\"get_level\"(NEW.\"name\");\n\n    RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}"
        }
      ],
      "operation": [
        {
          "as": "BEGIN\n    RETURN current_setting('storage.operation', true);\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${text}",
          "schema": "${schema.storage}",
          "volatility": "${STABLE}"
        }
      ],
      "pgrst_ddl_watch": [
        {
          "as": "DECLARE\n  cmd record;\nBEGIN\n  FOR cmd IN SELECT * FROM pg_event_trigger_ddl_commands()\n  LOOP\n    IF cmd.command_tag IN (\n      'CREATE SCHEMA', 'ALTER SCHEMA'\n    , 'CREATE TABLE', 'CREATE TABLE AS', 'SELECT INTO', 'ALTER TABLE'\n    , 'CREATE FOREIGN TABLE', 'ALTER FOREIGN TABLE'\n    , 'CREATE VIEW', 'ALTER VIEW'\n    , 'CREATE MATERIALIZED VIEW', 'ALTER MATERIALIZED VIEW'\n    , 'CREATE FUNCTION', 'ALTER FUNCTION'\n    , 'CREATE TRIGGER'\n    , 'CREATE TYPE', 'ALTER TYPE'\n    , 'CREATE RULE'\n    , 'COMMENT'\n    )\n    -- don't notify in case of CREATE TEMP table or other objects created on pg_temp\n    AND cmd.schema_name is distinct from 'pg_temp'\n    THEN\n      NOTIFY pgrst, 'reload schema';\n    END IF;\n  END LOOP;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${event_trigger}",
          "schema": "${schema.extensions}"
        }
      ],
      "pgrst_drop_watch": [
        {
          "as": "DECLARE\n  obj record;\nBEGIN\n  FOR obj IN SELECT * FROM pg_event_trigger_dropped_objects()\n  LOOP\n    IF obj.object_type IN (\n      'schema'\n    , 'table'\n    , 'foreign table'\n    , 'view'\n    , 'materialized view'\n    , 'function'\n    , 'trigger'\n    , 'type'\n    , 'rule'\n    )\n    AND obj.is_temporary IS false -- no pg_temp objects\n    THEN\n      NOTIFY pgrst, 'reload schema';\n    END IF;\n  END LOOP;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${event_trigger}",
          "schema": "${schema.extensions}"
        }
      ],
      "prefixes_delete_cleanup": [
        {
          "as": "DECLARE\n    v_bucket_ids text[];\n    v_names      text[];\nBEGIN\n    IF current_setting('storage.gc.prefixes', true) = '1' THEN\n        RETURN NULL;\n    END IF;\n\n    PERFORM set_config('storage.gc.prefixes', '1', true);\n\n    SELECT COALESCE(array_agg(d.bucket_id), '{}'),\n           COALESCE(array_agg(d.name), '{}')\n    INTO v_bucket_ids, v_names\n    FROM deleted AS d\n    WHERE d.name <> '';\n\n    PERFORM storage.lock_top_prefixes(v_bucket_ids, v_names);\n    PERFORM storage.delete_leaf_prefixes(v_bucket_ids, v_names);\n\n    RETURN NULL;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}",
          "security": "${DEFINER}"
        }
      ],
      "prefixes_insert_trigger": [
        {
          "as": "BEGIN\n    PERFORM \"storage\".\"add_prefixes\"(NEW.\"bucket_id\", NEW.\"name\");\n    RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.storage}"
        }
      ],
      "public": {
        "update_updated_at_column": [
          {
            "as": "BEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n",
            "lang": "${PLpgSQL}",
            "return": "${trigger}",
            "schema": "${schema.public}"
          }
        ]
      },
      "quote_wal2json": [
        {
          "arg": {
            "entity": [
              {
                "type": "${regclass}"
              }
            ]
          },
          "as": "select\n        (\n          select string_agg('' || ch,'')\n          from unnest(string_to_array(nsp.nspname::text, null)) with ordinality x(ch, idx)\n          where\n            not (x.idx = 1 and x.ch = '\"')\n            and not (\n              x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)\n              and x.ch = '\"'\n            )\n        )\n        || '.'\n        || (\n          select string_agg('' || ch,'')\n          from unnest(string_to_array(pc.relname::text, null)) with ordinality x(ch, idx)\n          where\n            not (x.idx = 1 and x.ch = '\"')\n            and not (\n              x.idx = array_length(string_to_array(nsp.nspname::text, null), 1)\n              and x.ch = '\"'\n            )\n          )\n      from\n        pg_class pc\n        join pg_namespace nsp\n          on pc.relnamespace = nsp.oid\n      where\n        pc.oid = entity\n",
          "lang": "${SQL}",
          "return": "${text}",
          "schema": "${schema.realtime}",
          "strict": true,
          "volatility": "${IMMUTABLE}"
        }
      ],
      "role": [
        {
          "as": "select \n  coalesce(\n    nullif(current_setting('request.jwt.claim.role', true), ''),\n    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'role')\n  )::text\n",
          "comment": "Deprecated. Use auth.jwt() -> 'role' instead.",
          "lang": "${SQL}",
          "return": "${text}",
          "schema": "${schema.auth}",
          "volatility": "${STABLE}"
        }
      ],
      "search": [
        {
          "arg": {
            "bucketname": [
              {
                "type": "${text}"
              }
            ],
            "levels": [
              {
                "default": 1,
                "type": "${integer}"
              }
            ],
            "limits": [
              {
                "default": 100,
                "type": "${integer}"
              }
            ],
            "offsets": [
              {
                "default": 0,
                "type": "${integer}"
              }
            ],
            "prefix": [
              {
                "type": "${text}"
              }
            ],
            "search": [
              {
                "default": "",
                "type": "${text}"
              }
            ],
            "sortcolumn": [
              {
                "default": "name",
                "type": "${text}"
              }
            ],
            "sortorder": [
              {
                "default": "asc",
                "type": "${text}"
              }
            ]
          },
          "as": "declare\n    can_bypass_rls BOOLEAN;\nbegin\n    SELECT rolbypassrls\n    INTO can_bypass_rls\n    FROM pg_roles\n    WHERE rolname = coalesce(nullif(current_setting('role', true), 'none'), current_user);\n\n    IF can_bypass_rls THEN\n        RETURN QUERY SELECT * FROM storage.search_v1_optimised(prefix, bucketname, limits, levels, offsets, search, sortcolumn, sortorder);\n    ELSE\n        RETURN QUERY SELECT * FROM storage.search_legacy_v1(prefix, bucketname, limits, levels, offsets, search, sortcolumn, sortorder);\n    END IF;\nend;\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "created_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "id": [
                  {
                    "type": "${uuid}"
                  }
                ],
                "last_accessed_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "metadata": [
                  {
                    "type": "${jsonb}"
                  }
                ],
                "name": [
                  {
                    "type": "${text}"
                  }
                ],
                "updated_at": [
                  {
                    "type": "${timestampz}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "search_legacy_v1": [
        {
          "arg": {
            "bucketname": [
              {
                "type": "${text}"
              }
            ],
            "levels": [
              {
                "default": 1,
                "type": "${integer}"
              }
            ],
            "limits": [
              {
                "default": 100,
                "type": "${integer}"
              }
            ],
            "offsets": [
              {
                "default": 0,
                "type": "${integer}"
              }
            ],
            "prefix": [
              {
                "type": "${text}"
              }
            ],
            "search": [
              {
                "default": "",
                "type": "${text}"
              }
            ],
            "sortcolumn": [
              {
                "default": "name",
                "type": "${text}"
              }
            ],
            "sortorder": [
              {
                "default": "asc",
                "type": "${text}"
              }
            ]
          },
          "as": "declare\n    v_order_by text;\n    v_sort_order text;\nbegin\n    case\n        when sortcolumn = 'name' then\n            v_order_by = 'name';\n        when sortcolumn = 'updated_at' then\n            v_order_by = 'updated_at';\n        when sortcolumn = 'created_at' then\n            v_order_by = 'created_at';\n        when sortcolumn = 'last_accessed_at' then\n            v_order_by = 'last_accessed_at';\n        else\n            v_order_by = 'name';\n        end case;\n\n    case\n        when sortorder = 'asc' then\n            v_sort_order = 'asc';\n        when sortorder = 'desc' then\n            v_sort_order = 'desc';\n        else\n            v_sort_order = 'asc';\n        end case;\n\n    v_order_by = v_order_by || ' ' || v_sort_order;\n\n    return query execute\n        'with folders as (\n           select path_tokens[$1] as folder\n           from storage.objects\n             where objects.name ilike $2 || $3 || ''%''\n               and bucket_id = $4\n               and array_length(objects.path_tokens, 1) <> $1\n           group by folder\n           order by folder ' || v_sort_order || '\n     )\n     (select folder as \"name\",\n            null as id,\n            null as updated_at,\n            null as created_at,\n            null as last_accessed_at,\n            null as metadata from folders)\n     union all\n     (select path_tokens[$1] as \"name\",\n            id,\n            updated_at,\n            created_at,\n            last_accessed_at,\n            metadata\n     from storage.objects\n     where objects.name ilike $2 || $3 || ''%''\n       and bucket_id = $4\n       and array_length(objects.path_tokens, 1) = $1\n     order by ' || v_order_by || ')\n     limit $5\n     offset $6' using levels, prefix, search, bucketname, limits, offsets;\nend;\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "created_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "id": [
                  {
                    "type": "${uuid}"
                  }
                ],
                "last_accessed_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "metadata": [
                  {
                    "type": "${jsonb}"
                  }
                ],
                "name": [
                  {
                    "type": "${text}"
                  }
                ],
                "updated_at": [
                  {
                    "type": "${timestampz}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.storage}",
          "volatility": "${STABLE}"
        }
      ],
      "search_v1_optimised": [
        {
          "arg": {
            "bucketname": [
              {
                "type": "${text}"
              }
            ],
            "levels": [
              {
                "default": 1,
                "type": "${integer}"
              }
            ],
            "limits": [
              {
                "default": 100,
                "type": "${integer}"
              }
            ],
            "offsets": [
              {
                "default": 0,
                "type": "${integer}"
              }
            ],
            "prefix": [
              {
                "type": "${text}"
              }
            ],
            "search": [
              {
                "default": "",
                "type": "${text}"
              }
            ],
            "sortcolumn": [
              {
                "default": "name",
                "type": "${text}"
              }
            ],
            "sortorder": [
              {
                "default": "asc",
                "type": "${text}"
              }
            ]
          },
          "as": "declare\n    v_order_by text;\n    v_sort_order text;\nbegin\n    case\n        when sortcolumn = 'name' then\n            v_order_by = 'name';\n        when sortcolumn = 'updated_at' then\n            v_order_by = 'updated_at';\n        when sortcolumn = 'created_at' then\n            v_order_by = 'created_at';\n        when sortcolumn = 'last_accessed_at' then\n            v_order_by = 'last_accessed_at';\n        else\n            v_order_by = 'name';\n        end case;\n\n    case\n        when sortorder = 'asc' then\n            v_sort_order = 'asc';\n        when sortorder = 'desc' then\n            v_sort_order = 'desc';\n        else\n            v_sort_order = 'asc';\n        end case;\n\n    v_order_by = v_order_by || ' ' || v_sort_order;\n\n    return query execute\n        'with folders as (\n           select (string_to_array(name, ''/''))[level] as name\n           from storage.prefixes\n             where lower(prefixes.name) like lower($2 || $3) || ''%''\n               and bucket_id = $4\n               and level = $1\n           order by name ' || v_sort_order || '\n     )\n     (select name,\n            null as id,\n            null as updated_at,\n            null as created_at,\n            null as last_accessed_at,\n            null as metadata from folders)\n     union all\n     (select path_tokens[level] as \"name\",\n            id,\n            updated_at,\n            created_at,\n            last_accessed_at,\n            metadata\n     from storage.objects\n     where lower(objects.name) like lower($2 || $3) || ''%''\n       and bucket_id = $4\n       and level = $1\n     order by ' || v_order_by || ')\n     limit $5\n     offset $6' using levels, prefix, search, bucketname, limits, offsets;\nend;\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "created_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "id": [
                  {
                    "type": "${uuid}"
                  }
                ],
                "last_accessed_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "metadata": [
                  {
                    "type": "${jsonb}"
                  }
                ],
                "name": [
                  {
                    "type": "${text}"
                  }
                ],
                "updated_at": [
                  {
                    "type": "${timestampz}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.storage}",
          "volatility": "${STABLE}"
        }
      ],
      "search_v2": [
        {
          "arg": {
            "bucket_name": [
              {
                "type": "${text}"
              }
            ],
            "levels": [
              {
                "default": 1,
                "type": "${integer}"
              }
            ],
            "limits": [
              {
                "default": 100,
                "type": "${integer}"
              }
            ],
            "prefix": [
              {
                "type": "${text}"
              }
            ],
            "sort_column": [
              {
                "default": "name",
                "type": "${text}"
              }
            ],
            "sort_column_after": [
              {
                "default": "",
                "type": "${text}"
              }
            ],
            "sort_order": [
              {
                "default": "asc",
                "type": "${text}"
              }
            ],
            "start_after": [
              {
                "default": "",
                "type": "${text}"
              }
            ]
          },
          "as": "DECLARE\n    sort_col text;\n    sort_ord text;\n    cursor_op text;\n    cursor_expr text;\n    sort_expr text;\nBEGIN\n    -- Validate sort_order\n    sort_ord := lower(sort_order);\n    IF sort_ord NOT IN ('asc', 'desc') THEN\n        sort_ord := 'asc';\n    END IF;\n\n    -- Determine cursor comparison operator\n    IF sort_ord = 'asc' THEN\n        cursor_op := '>';\n    ELSE\n        cursor_op := '<';\n    END IF;\n\n    sort_col := lower(sort_column);\n    -- Validate sort column  \n    IF sort_col IN ('updated_at', 'created_at') THEN\n        cursor_expr := format(\n            '($5 = '''' OR ROW(date_trunc(''milliseconds'', %I), name COLLATE \"C\") %s ROW(COALESCE(NULLIF($6, '''')::timestampz, ''epoch''::timestampz), $5))',\n            sort_col, cursor_op\n        );\n        sort_expr := format(\n            'COALESCE(date_trunc(''milliseconds'', %I), ''epoch''::timestampz) %s, name COLLATE \"C\" %s',\n            sort_col, sort_ord, sort_ord\n        );\n    ELSE\n        cursor_expr := format('($5 = '''' OR name COLLATE \"C\" %s $5)', cursor_op);\n        sort_expr := format('name COLLATE \"C\" %s', sort_ord);\n    END IF;\n\n    RETURN QUERY EXECUTE format(\n        $sql$\n        SELECT * FROM (\n            (\n                SELECT\n                    split_part(name, '/', $4) AS key,\n                    name,\n                    NULL::uuid AS id,\n                    updated_at,\n                    created_at,\n                    NULL::timestampz AS last_accessed_at,\n                    NULL::jsonb AS metadata\n                FROM storage.prefixes\n                WHERE name COLLATE \"C\" LIKE $1 || '%%'\n                    AND bucket_id = $2\n                    AND level = $4\n                    AND %s\n                ORDER BY %s\n                LIMIT $3\n            )\n            UNION ALL\n            (\n                SELECT\n                    split_part(name, '/', $4) AS key,\n                    name,\n                    id,\n                    updated_at,\n                    created_at,\n                    last_accessed_at,\n                    metadata\n                FROM storage.objects\n                WHERE name COLLATE \"C\" LIKE $1 || '%%'\n                    AND bucket_id = $2\n                    AND level = $4\n                    AND %s\n                ORDER BY %s\n                LIMIT $3\n            )\n        ) obj\n        ORDER BY %s\n        LIMIT $3\n        $sql$,\n        cursor_expr,    -- prefixes WHERE\n        sort_expr,      -- prefixes ORDER BY\n        cursor_expr,    -- objects WHERE\n        sort_expr,      -- objects ORDER BY\n        sort_expr       -- final ORDER BY\n    )\n    USING prefix, bucket_name, limits, levels, start_after, sort_column_after;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return_table": [
            {
              "column": {
                "created_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "id": [
                  {
                    "type": "${uuid}"
                  }
                ],
                "key": [
                  {
                    "type": "${text}"
                  }
                ],
                "last_accessed_at": [
                  {
                    "type": "${timestampz}"
                  }
                ],
                "metadata": [
                  {
                    "type": "${jsonb}"
                  }
                ],
                "name": [
                  {
                    "type": "${text}"
                  }
                ],
                "updated_at": [
                  {
                    "type": "${timestampz}"
                  }
                ]
              }
            }
          ],
          "schema": "${schema.storage}",
          "volatility": "${STABLE}"
        }
      ],
      "send": [
        {
          "arg": {
            "event": [
              {
                "type": "${text}"
              }
            ],
            "payload": [
              {
                "type": "${jsonb}"
              }
            ],
            "private": [
              {
                "default": true,
                "type": "${boolean}"
              }
            ],
            "topic": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "DECLARE\n  generated_id uuid;\n  final_payload jsonb;\nBEGIN\n  BEGIN\n    -- Generate a new UUID for the id\n    generated_id := gen_random_uuid();\n\n    -- Check if payload has an 'id' key, if not, add the generated UUID\n    IF payload ? 'id' THEN\n      final_payload := payload;\n    ELSE\n      final_payload := jsonb_set(payload, '{id}', to_jsonb(generated_id));\n    END IF;\n\n    -- Set the topic configuration\n    EXECUTE format('SET LOCAL realtime.topic TO %L', topic);\n\n    -- Attempt to insert the message\n    INSERT INTO realtime.messages (id, payload, event, topic, private, extension)\n    VALUES (generated_id, final_payload, event, topic, private, 'broadcast');\n  EXCEPTION\n    WHEN OTHERS THEN\n      -- Capture and notify the error\n      RAISE WARNING 'ErrorSendingBroadcastMessage: %', SQLERRM;\n  END;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.realtime}"
        }
      ],
      "set_current_timestamp_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "set_graphql_placeholder": [
        {
          "as": "DECLARE\n    graphql_is_dropped bool;\n    BEGIN\n    graphql_is_dropped = (\n        SELECT ev.schema_name = 'graphql_public'\n        FROM pg_event_trigger_dropped_objects() AS ev\n        WHERE ev.schema_name = 'graphql_public'\n    );\n\n    IF graphql_is_dropped\n    THEN\n        create or replace function graphql_public.graphql(\n            \"operationName\" text default null,\n            query text default null,\n            variables jsonb default null,\n            extensions jsonb default null\n        )\n            returns jsonb\n            language plpgsql\n        as $$\n            DECLARE\n                server_version float;\n            BEGIN\n                server_version = (SELECT (SPLIT_PART((select version()), ' ', 2))::float);\n\n                IF server_version >= 14 THEN\n                    RETURN jsonb_build_object(\n                        'errors', jsonb_build_array(\n                            jsonb_build_object(\n                                'message', 'pg_graphql extension is not enabled.'\n                            )\n                        )\n                    );\n                ELSE\n                    RETURN jsonb_build_object(\n                        'errors', jsonb_build_array(\n                            jsonb_build_object(\n                                'message', 'pg_graphql is only available on projects running Postgres 14 onwards.'\n                            )\n                        )\n                    );\n                END IF;\n            END;\n        $$;\n    END IF;\n\n    END;\n",
          "comment": "Reintroduces placeholder function for graphql_public.graphql",
          "lang": "${PLpgSQL}",
          "return": "${event_trigger}",
          "schema": "${schema.extensions}"
        }
      ],
      "set_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at = now();\n  RETURN NEW;\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "set_weekly_task_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "storage": {
        "update_updated_at_column": [
          {
            "as": "BEGIN\n    NEW.updated_at = now();\n    RETURN NEW; \nEND;\n",
            "lang": "${PLpgSQL}",
            "return": "${trigger}",
            "schema": "${schema.storage}"
          }
        ]
      },
      "subscription_check_filters": [
        {
          "as": "/*\n    Validates that the user defined filters for a subscription:\n    - refer to valid columns that the claimed role may access\n    - values are coercable to the correct column type\n    */\n    declare\n        col_names text[] = coalesce(\n                array_agg(c.column_name order by c.ordinal_position),\n                '{}'::text[]\n            )\n            from\n                information_schema.columns c\n            where\n                format('%I.%I', c.table_schema, c.table_name)::regclass = new.entity\n                and pg_catalog.has_column_privilege(\n                    (new.claims ->> 'role'),\n                    format('%I.%I', c.table_schema, c.table_name)::regclass,\n                    c.column_name,\n                    'SELECT'\n                );\n        filter realtime.user_defined_filter;\n        col_type regtype;\n\n        in_val jsonb;\n    begin\n        for filter in select * from unnest(new.filters) loop\n            -- Filtered column is valid\n            if not filter.column_name = any(col_names) then\n                raise exception 'invalid column for filter %', filter.column_name;\n            end if;\n\n            -- Type is sanitized and safe for string interpolation\n            col_type = (\n                select atttypid::regtype\n                from pg_catalog.pg_attribute\n                where attrelid = new.entity\n                      and attname = filter.column_name\n            );\n            if col_type is null then\n                raise exception 'failed to lookup type for column %', filter.column_name;\n            end if;\n\n            -- Set maximum number of entries for in filter\n            if filter.op = 'in'::realtime.equality_op then\n                in_val = realtime.cast(filter.value, (col_type::text || '[]')::regtype);\n                if coalesce(jsonb_array_length(in_val), 0) > 100 then\n                    raise exception 'too many values for `in` filter. Maximum 100';\n                end if;\n            else\n                -- raises an exception if value is not coercable to type\n                perform realtime.cast(filter.value, col_type);\n            end if;\n\n        end loop;\n\n        -- Apply consistent order to filters so the unique constraint on\n        -- (subscription_id, entity, filters) can't be tricked by a different filter order\n        new.filters = coalesce(\n            array_agg(f order by f.column_name, f.op, f.value),\n            '{}'\n        ) from unnest(new.filters) f;\n\n        return new;\n    end;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.realtime}"
        }
      ],
      "to_regrole": [
        {
          "arg": {
            "role_name": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "select role_name::regrole",
          "lang": "${SQL}",
          "return": "${regrole}",
          "schema": "${schema.realtime}",
          "volatility": "${IMMUTABLE}"
        }
      ],
      "topic": [
        {
          "as": "select nullif(current_setting('realtime.topic', true), '')::text;",
          "lang": "${SQL}",
          "return": "${text}",
          "schema": "${schema.realtime}",
          "volatility": "${STABLE}"
        }
      ],
      "trigger_gmb_sync": [
        {
          "as": "DECLARE\n  project_ref TEXT := 'rrarhekwhgpgkakqrlyn'; -- غيّرها حسب ID مشروعك في Supabase\n  trigger_secret TEXT;\n  edge_function_url TEXT;\nBEGIN\n  -- استرجاع السر من الجدول\n  SELECT value INTO trigger_secret FROM system_settings WHERE key = 'trigger_secret';\n\n  IF trigger_secret IS NULL THEN\n    RAISE EXCEPTION 'trigger_secret is missing from system_settings';\n  END IF;\n\n  edge_function_url := 'https://' || project_ref || '.supabase.co/functions/v1/gmb-sync-trigger';\n\n  -- تنفيذ طلب POST للـ Edge Function\n  PERFORM net.http_post(\n    url := edge_function_url,\n    headers := jsonb_build_object(\n      'X-Trigger-Secret', trigger_secret,\n      'Content-Type', 'application/json'\n    ),\n    body := jsonb_build_object('manual', true)\n  );\n\n  RAISE NOTICE '✅ GMB sync triggered successfully via gmb-sync-trigger Edge Function';\nEND;\n",
          "comment": "Triggers GMB sync via Edge Function. Uses fixed search_path for security.",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "uid": [
        {
          "as": "select \n  coalesce(\n    nullif(current_setting('request.jwt.claim.sub', true), ''),\n    (nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'sub')\n  )::uuid\n",
          "comment": "Deprecated. Use auth.jwt() -> 'sub' instead.",
          "lang": "${SQL}",
          "return": "${uuid}",
          "schema": "${schema.auth}",
          "volatility": "${STABLE}"
        }
      ],
      "update_auto_reply_settings_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "update_gmb_attributes_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at := NOW();\n  RETURN NEW;\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "update_gmb_questions_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at := NOW();\n  RETURN NEW;\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "update_gmb_reviews_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "update_last_login": [
        {
          "as": "begin\n  update profiles\n  set updated_at = now()\n  where id = new.user_id;\n  return new;\nend;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "update_location_review_stats": [
        {
          "as": "BEGIN\n  -- تحديث عدد التقييمات\n  UPDATE gmb_locations\n  SET review_count = (\n    SELECT COUNT(*)\n    FROM gmb_reviews\n    WHERE location_id = COALESCE(NEW.location_id, OLD.location_id)\n  ),\n  response_rate = (\n    SELECT \n      CASE \n        WHEN COUNT(*) = 0 THEN 0\n        ELSE ROUND((COUNT(*) FILTER (WHERE has_reply = true)::DECIMAL / COUNT(*)) * 100, 2)\n      END\n    FROM gmb_reviews\n    WHERE location_id = COALESCE(NEW.location_id, OLD.location_id)\n  )\n  WHERE id = COALESCE(NEW.location_id, OLD.location_id);\n\n  RETURN COALESCE(NEW, OLD);\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "update_normalized_location_id": [
        {
          "as": "BEGIN\n  NEW.normalized_location_id := public.normalize_location_id(NEW.location_id);\n  RETURN NEW;\nEND;\n",
          "comment": "Trigger function to update normalized_location_id. Uses fixed search_path for security.",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "update_oauth_tokens_by_id": [
        {
          "arg": {
            "p_access_token": [
              {
                "type": "${text}"
              }
            ],
            "p_expires_at": [
              {
                "type": "${timestampz}"
              }
            ],
            "p_id": [
              {
                "type": "${uuid}"
              }
            ],
            "p_refresh_token": [
              {
                "type": "${text}"
              }
            ]
          },
          "as": "BEGIN\n  UPDATE public.oauth_tokens SET\n    access_token_encrypted = public.encrypt_token(p_access_token),\n    refresh_token_encrypted = public.encrypt_token(p_refresh_token),\n    expires_at = p_expires_at,\n    updated_at = now()\n  WHERE id = p_id;\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ],
      "update_question_templates_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "update_weekly_tasks_updated_at": [
        {
          "as": "BEGIN\n  NEW.updated_at = NOW();\n  RETURN NEW;\nEND;\n",
          "lang": "${PLpgSQL}",
          "return": "${trigger}",
          "schema": "${schema.public}"
        }
      ],
      "upsert_oauth_tokens": [
        {
          "arg": {
            "p_access_token": [
              {
                "type": "${text}"
              }
            ],
            "p_account_id": [
              {
                "type": "${uuid}"
              }
            ],
            "p_expires_at": [
              {
                "type": "${timestampz}"
              }
            ],
            "p_provider": [
              {
                "type": "${text}"
              }
            ],
            "p_refresh_token": [
              {
                "type": "${text}"
              }
            ],
            "p_scope": [
              {
                "type": "${text}"
              }
            ],
            "p_user_id": [
              {
                "type": "${uuid}"
              }
            ]
          },
          "as": "BEGIN\n  INSERT INTO public.oauth_tokens (provider, user_id, account_id, access_token, refresh_token, expires_at, scope, access_token_encrypted, refresh_token_encrypted)\n  VALUES (p_provider, p_user_id, p_account_id, NULL, NULL, p_expires_at, p_scope, public.encrypt_token(p_access_token), public.encrypt_token(p_refresh_token))\n  ON CONFLICT (id) DO UPDATE SET\n    access_token_encrypted = public.encrypt_token(p_access_token),\n    refresh_token_encrypted = public.encrypt_token(p_refresh_token),\n    expires_at = EXCLUDED.expires_at,\n    scope = EXCLUDED.scope,\n    updated_at = now();\nEND;\n",
          "config_params": [
            {
              "search_path": "public, pg_temp"
            }
          ],
          "lang": "${PLpgSQL}",
          "return": "${void}",
          "schema": "${schema.public}",
          "security": "${DEFINER}"
        }
      ]
    },
    "partition": {
      "messages_2025_11_11": [
        {
          "of": "${table.messages}",
          "range": [
            {
              "from": [
                "'2025-11-11 00:00:00'"
              ],
              "to": [
                "'2025-11-12 00:00:00'"
              ]
            }
          ],
          "schema": "${schema.realtime}"
        }
      ],
      "messages_2025_11_12": [
        {
          "of": "${table.messages}",
          "range": [
            {
              "from": [
                "'2025-11-12 00:00:00'"
              ],
              "to": [
                "'2025-11-13 00:00:00'"
              ]
            }
          ],
          "schema": "${schema.realtime}"
        }
      ],
      "messages_2025_11_13": [
        {
          "of": "${table.messages}",
          "range": [
            {
              "from": [
                "'2025-11-13 00:00:00'"
              ],
              "to": [
                "'2025-11-14 00:00:00'"
              ]
            }
          ],
          "schema": "${schema.realtime}"
        }
      ],
      "messages_2025_11_14": [
        {
          "of": "${table.messages}",
          "range": [
            {
              "from": [
                "'2025-11-14 00:00:00'"
              ],
              "to": [
                "'2025-11-15 00:00:00'"
              ]
            }
          ],
          "schema": "${schema.realtime}"
        }
      ],
      "messages_2025_11_15": [
        {
          "of": "${table.messages}",
          "range": [
            {
              "from": [
                "'2025-11-15 00:00:00'"
              ],
              "to": [
                "'2025-11-16 00:00:00'"
              ]
            }
          ],
          "schema": "${schema.realtime}"
        }
      ],
      "messages_2025_11_16": [
        {
          "of": "${table.messages}",
          "range": [
            {
              "from": [
                "'2025-11-16 00:00:00'"
              ],
              "to": [
                "'2025-11-17 00:00:00'"
              ]
            }
          ],
          "schema": "${schema.realtime}"
        }
      ],
      "messages_2025_11_17": [
        {
          "of": "${table.messages}",
          "range": [
            {
              "from": [
                "'2025-11-17 00:00:00'"
              ],
              "to": [
                "'2025-11-18 00:00:00'"
              ]
            }
          ],
          "schema": "${schema.realtime}"
        }
      ]
    },
    "policy": {
      "Allow individual user to create their own profile": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.client_profiles}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Allow individual user to read their own profile": [
        {
          "for": "${SELECT}",
          "on": "${table.client_profiles}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Allow individual user to update their own profile": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.client_profiles}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Allow insert for service role": [
        {
          "check": "true",
          "for": "${INSERT}",
          "on": "${table.gmb_reviews}",
          "to": [
            "service_role"
          ]
        }
      ],
      "Allow public read access to branding assets": [
        {
          "for": "${SELECT}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(bucket_id = 'branding_assets'::text)"
        }
      ],
      "Allow select for service role": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_reviews}",
          "to": [
            "service_role"
          ],
          "using": "true"
        }
      ],
      "Allow update for service role": [
        {
          "check": "true",
          "for": "${UPDATE}",
          "on": "${table.gmb_reviews}",
          "to": [
            "service_role"
          ],
          "using": "true"
        }
      ],
      "Allow users to delete their own assets": [
        {
          "for": "${DELETE}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ],
          "using": "((bucket_id = 'branding_assets'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Allow users to update their own assets": [
        {
          "for": "${UPDATE}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ],
          "using": "((bucket_id = 'branding_assets'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Allow users to upload to their own folder": [
        {
          "check": "((bucket_id = 'branding_assets'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))",
          "for": "${INSERT}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Anyone can view avatars": [
        {
          "for": "${SELECT}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(bucket_id = 'avatars'::text)"
        }
      ],
      "Anyone can view citation sources": [
        {
          "for": "${SELECT}",
          "on": "${table.citation_sources}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "true"
        }
      ],
      "Anyone can view gmb media": [
        {
          "for": "${SELECT}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(bucket_id = 'gmb-media'::text)"
        }
      ],
      "Anyone can view post images": [
        {
          "for": "${SELECT}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(bucket_id = 'post-images'::text)"
        }
      ],
      "Authenticated users can manage citation sources": [
        {
          "for": "${ALL}",
          "on": "${table.citation_sources}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.role() = 'authenticated'::text)"
        }
      ],
      "Citation sources are readable by all authenticated users": [
        {
          "for": "${SELECT}",
          "on": "${table.citation_sources}",
          "to": [
            "authenticated"
          ],
          "using": "true"
        }
      ],
      "Own rows read": [
        {
          "for": "${SELECT}",
          "on": "${table.oauth_events}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "Own rows write": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${INSERT}",
          "on": "${table.oauth_events}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Owners can delete team members": [
        {
          "for": "${DELETE}",
          "on": "${table.team_members}",
          "to": [
            "authenticated"
          ],
          "using": "(auth.uid() = owner_id)"
        }
      ],
      "Owners can insert team members": [
        {
          "check": "(auth.uid() = owner_id)",
          "for": "${INSERT}",
          "on": "${table.team_members}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Owners can update team members": [
        {
          "check": "(auth.uid() = owner_id)",
          "for": "${UPDATE}",
          "on": "${table.team_members}",
          "to": [
            "authenticated"
          ],
          "using": "(auth.uid() = owner_id)"
        }
      ],
      "Service role can manage dashboard reports": [
        {
          "for": "${ALL}",
          "on": "${table.gmb_dashboard_reports}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.role() = 'service_role'::text)"
        }
      ],
      "System can insert performance metrics": [
        {
          "check": "true",
          "for": "${INSERT}",
          "on": "${table.performance_metrics}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "System can insert security logs": [
        {
          "check": "true",
          "for": "${INSERT}",
          "on": "${table.security_logs}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "User can insert own profile": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${INSERT}",
          "on": "${table.profiles}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "User can update own profile": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${UPDATE}",
          "on": "${table.profiles}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "User can view own profile": [
        {
          "for": "${SELECT}",
          "on": "${table.profiles}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "Users can delete autopilot logs for their locations": [
        {
          "for": "${DELETE}",
          "on": "${table.autopilot_logs}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = autopilot_logs.location_id) AND (gmb_locations.user_id = auth.uid()))))\n"
        }
      ],
      "Users can delete citation listings for their locations": [
        {
          "for": "${DELETE}",
          "on": "${table.citation_listings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = citation_listings.location_id) AND (gmb_locations.user_id = auth.uid()))))\n"
        }
      ],
      "Users can delete citations for own locations": [
        {
          "for": "${DELETE}",
          "on": "${table.citation_listings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = citation_listings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        },
        {
          "for": "${DELETE}",
          "on": "${table.gmb_citations}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_citations.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can delete competitor tracking for their locations": [
        {
          "for": "${DELETE}",
          "on": "${table.competitor_tracking}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = competitor_tracking.location_id) AND (gmb_locations.user_id = auth.uid()))))\n"
        }
      ],
      "Users can delete competitors for own locations": [
        {
          "for": "${DELETE}",
          "on": "${table.competitor_tracking}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = competitor_tracking.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can delete own auto_reply_queue": [
        {
          "for": "${DELETE}",
          "on": "${table.auto_reply_queue}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete own auto_reply_settings": [
        {
          "for": "${DELETE}",
          "on": "${table.auto_reply_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete own avatar": [
        {
          "for": "${DELETE}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ],
          "using": "((bucket_id = 'avatars'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can delete own gmb media": [
        {
          "for": "${DELETE}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ],
          "using": "((bucket_id = 'gmb-media'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can delete own notifications": [
        {
          "for": "${DELETE}",
          "on": "${table.notifications}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete own post images": [
        {
          "for": "${DELETE}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ],
          "using": "((bucket_id = 'post-images'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can delete rankings for own locations": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_rankings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can delete their own AI analysis": [
        {
          "for": "${DELETE}",
          "on": "${table.review_ai_analysis}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(review_id IN ( SELECT r.id\n   FROM (public.gmb_reviews r\n     JOIN public.gmb_locations l ON ((r.location_id = l.id)))\n  WHERE (l.user_id = auth.uid())))\n"
        }
      ],
      "Users can delete their own AI requests": [
        {
          "for": "${DELETE}",
          "on": "${table.ai_requests}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own AI settings": [
        {
          "for": "${DELETE}",
          "on": "${table.ai_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own GMB media": [
        {
          "for": "${DELETE}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "((bucket_id = 'gmb-media'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can delete their own YouTube videos": [
        {
          "for": "${DELETE}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "((bucket_id = 'youtube-videos'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can delete their own attributes": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_attributes}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own autopilot settings": [
        {
          "for": "${DELETE}",
          "on": "${table.autopilot_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own drafts": [
        {
          "for": "${DELETE}",
          "on": "${table.youtube_drafts}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own locations": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_locations}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own media": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_media}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own notifications": [
        {
          "for": "${DELETE}",
          "on": "${table.notifications}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own oauth states": [
        {
          "for": "${DELETE}",
          "on": "${table.oauth_states}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own performance metrics": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_performance_metrics}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own questions": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_questions}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own reviews": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_reviews}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own search keywords": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_search_keywords}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own tasks": [
        {
          "for": "${DELETE}",
          "on": "${table.weekly_tasks}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can delete their own videos": [
        {
          "for": "${DELETE}",
          "on": "${table.youtube_videos}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can insert autopilot logs for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = ai_autopilot_logs.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.ai_autopilot_logs}",
          "to": [
            "authenticated"
          ]
        },
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = autopilot_logs.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.autopilot_logs}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can insert autopilot logs for their locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = autopilot_logs.location_id) AND (gmb_locations.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.autopilot_logs}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert autopilot settings for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = ai_autopilot_settings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.ai_autopilot_settings}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can insert citation listings for their locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = citation_listings.location_id) AND (gmb_locations.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.citation_listings}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert citations for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = citation_listings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.citation_listings}",
          "to": [
            "authenticated"
          ]
        },
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_citations.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.gmb_citations}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can insert competitor tracking for their locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = competitor_tracking.location_id) AND (gmb_locations.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.competitor_tracking}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert competitors for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = competitor_tracking.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.competitor_tracking}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can insert insights for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_insights.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.gmb_insights}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can insert own AI requests": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.ai_requests}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can insert own activity": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${INSERT}",
          "on": "${table.activity_logs}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can insert own auto_reply_queue": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.auto_reply_queue}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert own auto_reply_settings": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.auto_reply_settings}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert own review_activity_log": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.review_activity_log}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert rankings for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.gmb_rankings}",
          "to": [
            "authenticated"
          ]
        },
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = keyword_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${INSERT}",
          "on": "${table.keyword_rankings}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can insert their own AI analysis": [
        {
          "check": "(review_id IN ( SELECT r.id\n   FROM (public.gmb_reviews r\n     JOIN public.gmb_locations l ON ((r.location_id = l.id)))\n  WHERE (l.user_id = auth.uid())))\n",
          "for": "${INSERT}",
          "on": "${table.review_ai_analysis}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own AI requests": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.ai_requests}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own AI settings": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.ai_settings}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own attributes": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.gmb_attributes}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own autopilot settings": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.autopilot_settings}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own drafts": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.youtube_drafts}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own locations": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.gmb_locations}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own media": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.gmb_media}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own notifications": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.notifications}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own oauth states": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.oauth_states}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own performance metrics": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.gmb_performance_metrics}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own profile": [
        {
          "check": "true",
          "for": "${INSERT}",
          "on": "${table.profiles}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own questions": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.gmb_questions}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own reviews": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.gmb_reviews}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own search keywords": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.gmb_search_keywords}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own tasks": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.weekly_tasks}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can insert their own videos": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.youtube_videos}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can manage their own oauth states": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${ALL}",
          "on": "${table.oauth_states}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can manage their own rate limit records": [
        {
          "for": "${ALL}",
          "on": "${table.rate_limit_requests}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can manage their own tasks": [
        {
          "for": "${ALL}",
          "on": "${table.weekly_tasks}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can manage their own templates": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${ALL}",
          "on": "${table.question_templates}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can manage their own weekly_tasks": [
        {
          "for": "${ALL}",
          "on": "${table.weekly_tasks}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can read autopilot logs for own locations": [
        {
          "for": "${SELECT}",
          "on": "${table.ai_autopilot_logs}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = ai_autopilot_logs.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        },
        {
          "for": "${SELECT}",
          "on": "${table.autopilot_logs}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = autopilot_logs.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can read autopilot settings for own locations": [
        {
          "for": "${SELECT}",
          "on": "${table.ai_autopilot_settings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = ai_autopilot_settings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can read citations for own locations": [
        {
          "for": "${SELECT}",
          "on": "${table.citation_listings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = citation_listings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        },
        {
          "for": "${SELECT}",
          "on": "${table.gmb_citations}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_citations.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can read competitors for own locations": [
        {
          "for": "${SELECT}",
          "on": "${table.competitor_tracking}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = competitor_tracking.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can read insights for own locations": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_insights}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_insights.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can read own AI requests": [
        {
          "for": "${SELECT}",
          "on": "${table.ai_requests}",
          "to": [
            "authenticated"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can read rankings for own locations": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_rankings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        },
        {
          "for": "${SELECT}",
          "on": "${table.keyword_rankings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = keyword_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can read team members where they are owner": [
        {
          "for": "${SELECT}",
          "on": "${table.team_members}",
          "to": [
            "authenticated"
          ],
          "using": "((auth.uid() = owner_id) OR (auth.uid() = user_id))"
        }
      ],
      "Users can update autopilot logs for their locations": [
        {
          "for": "${UPDATE}",
          "on": "${table.autopilot_logs}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = autopilot_logs.location_id) AND (gmb_locations.user_id = auth.uid()))))\n"
        }
      ],
      "Users can update autopilot settings for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = ai_autopilot_settings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${UPDATE}",
          "on": "${table.ai_autopilot_settings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = ai_autopilot_settings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can update citation listings for their locations": [
        {
          "for": "${UPDATE}",
          "on": "${table.citation_listings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = citation_listings.location_id) AND (gmb_locations.user_id = auth.uid()))))\n"
        }
      ],
      "Users can update citations for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = citation_listings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${UPDATE}",
          "on": "${table.citation_listings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = citation_listings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        },
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_citations.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${UPDATE}",
          "on": "${table.gmb_citations}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_citations.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can update competitor tracking for their locations": [
        {
          "for": "${UPDATE}",
          "on": "${table.competitor_tracking}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM public.gmb_locations\n  WHERE ((gmb_locations.id = competitor_tracking.location_id) AND (gmb_locations.user_id = auth.uid()))))\n"
        }
      ],
      "Users can update competitors for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = competitor_tracking.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${UPDATE}",
          "on": "${table.competitor_tracking}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = competitor_tracking.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can update insights for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_insights.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${UPDATE}",
          "on": "${table.gmb_insights}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_insights.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can update own auto_reply_queue": [
        {
          "for": "${UPDATE}",
          "on": "${table.auto_reply_queue}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update own auto_reply_settings": [
        {
          "for": "${UPDATE}",
          "on": "${table.auto_reply_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update own avatar": [
        {
          "for": "${UPDATE}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ],
          "using": "((bucket_id = 'avatars'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can update own data": [
        {
          "for": "${UPDATE}",
          "on": "${table.gmb_accounts}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(user_id = auth.uid())"
        }
      ],
      "Users can update own gmb media": [
        {
          "for": "${UPDATE}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ],
          "using": "((bucket_id = 'gmb-media'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can update own notifications": [
        {
          "for": "${UPDATE}",
          "on": "${table.notifications}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update own post images": [
        {
          "for": "${UPDATE}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ],
          "using": "((bucket_id = 'post-images'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can update rankings for own locations": [
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${UPDATE}",
          "on": "${table.gmb_rankings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = gmb_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        },
        {
          "check": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = keyword_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n",
          "for": "${UPDATE}",
          "on": "${table.keyword_rankings}",
          "to": [
            "authenticated"
          ],
          "using": "(EXISTS ( SELECT 1\n   FROM (public.gmb_locations\n     JOIN public.gmb_accounts ON ((gmb_locations.gmb_account_id = gmb_accounts.id)))\n  WHERE ((gmb_locations.id = keyword_rankings.location_id) AND (gmb_accounts.user_id = auth.uid()))))\n"
        }
      ],
      "Users can update their own AI analysis": [
        {
          "for": "${UPDATE}",
          "on": "${table.review_ai_analysis}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(review_id IN ( SELECT r.id\n   FROM (public.gmb_reviews r\n     JOIN public.gmb_locations l ON ((r.location_id = l.id)))\n  WHERE (l.user_id = auth.uid())))\n"
        }
      ],
      "Users can update their own AI requests": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.ai_requests}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own AI settings": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.ai_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own attributes": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.gmb_attributes}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own autopilot settings": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.autopilot_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own drafts": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.youtube_drafts}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own locations": [
        {
          "for": "${UPDATE}",
          "on": "${table.gmb_locations}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own media": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.gmb_media}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own notifications": [
        {
          "for": "${UPDATE}",
          "on": "${table.notifications}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own oauth states": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.oauth_states}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own performance metrics": [
        {
          "for": "${UPDATE}",
          "on": "${table.gmb_performance_metrics}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own questions": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.gmb_questions}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own reviews": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.gmb_reviews}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own search keywords": [
        {
          "for": "${UPDATE}",
          "on": "${table.gmb_search_keywords}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own tasks": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.weekly_tasks}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can update their own videos": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${UPDATE}",
          "on": "${table.youtube_videos}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can upload avatar to own folder": [
        {
          "check": "((bucket_id = 'avatars'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))",
          "for": "${INSERT}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can upload gmb media to own folder": [
        {
          "check": "((bucket_id = 'gmb-media'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))",
          "for": "${INSERT}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can upload post images to own folder": [
        {
          "check": "((bucket_id = 'post-images'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))",
          "for": "${INSERT}",
          "on": "${table.objects}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "Users can upload their own GMB media": [
        {
          "check": "((bucket_id = 'gmb-media'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))",
          "for": "${INSERT}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can upload their own YouTube videos": [
        {
          "check": "((bucket_id = 'youtube-videos'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))",
          "for": "${INSERT}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "Users can view dashboard reports": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_dashboard_reports}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "true"
        }
      ],
      "Users can view own activity": [
        {
          "for": "${SELECT}",
          "on": "${table.activity_logs}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "Users can view own auto_reply_queue": [
        {
          "for": "${SELECT}",
          "on": "${table.auto_reply_queue}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view own auto_reply_settings": [
        {
          "for": "${SELECT}",
          "on": "${table.auto_reply_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view own data": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_accounts}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(user_id = auth.uid())"
        }
      ],
      "Users can view own notifications": [
        {
          "for": "${SELECT}",
          "on": "${table.notifications}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view own review_activity_log": [
        {
          "for": "${SELECT}",
          "on": "${table.review_activity_log}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own AI analysis": [
        {
          "for": "${SELECT}",
          "on": "${table.review_ai_analysis}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(review_id IN ( SELECT r.id\n   FROM (public.gmb_reviews r\n     JOIN public.gmb_locations l ON ((r.location_id = l.id)))\n  WHERE (l.user_id = auth.uid())))\n"
        }
      ],
      "Users can view their own AI requests": [
        {
          "for": "${SELECT}",
          "on": "${table.ai_requests}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own AI settings": [
        {
          "for": "${SELECT}",
          "on": "${table.ai_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own GMB media": [
        {
          "for": "${SELECT}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "((bucket_id = 'gmb-media'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can view their own YouTube videos": [
        {
          "for": "${SELECT}",
          "on": "${table.objects}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "((bucket_id = 'youtube-videos'::text) AND ((storage.foldername(name))[1] = (auth.uid())::text))"
        }
      ],
      "Users can view their own attributes": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_attributes}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own autopilot logs": [
        {
          "for": "${SELECT}",
          "on": "${table.autopilot_logs}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own autopilot settings": [
        {
          "for": "${SELECT}",
          "on": "${table.autopilot_settings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own citation listings": [
        {
          "for": "${SELECT}",
          "on": "${table.citation_listings}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own competitor tracking": [
        {
          "for": "${SELECT}",
          "on": "${table.competitor_tracking}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own drafts": [
        {
          "for": "${SELECT}",
          "on": "${table.youtube_drafts}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own locations": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_locations}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own media": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_media}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own notifications": [
        {
          "for": "${SELECT}",
          "on": "${table.notifications}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own oauth states": [
        {
          "for": "${SELECT}",
          "on": "${table.oauth_states}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own performance metrics": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_performance_metrics}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        },
        {
          "for": "${SELECT}",
          "on": "${table.performance_metrics}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "((auth.uid() = user_id) OR (user_id IS NULL))"
        }
      ],
      "Users can view their own questions": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_questions}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own reviews": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_reviews}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own search keywords": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_search_keywords}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own security logs": [
        {
          "for": "${SELECT}",
          "on": "${table.security_logs}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own tasks": [
        {
          "for": "${SELECT}",
          "on": "${table.weekly_tasks}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users can view their own videos": [
        {
          "for": "${SELECT}",
          "on": "${table.youtube_videos}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "Users manage their weekly tasks": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${ALL}",
          "on": "${table.weekly_task_recommendations}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "ai_settings_delete_owner": [
        {
          "for": "${DELETE}",
          "on": "${table.ai_settings}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "ai_settings_insert_owner": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${INSERT}",
          "on": "${table.ai_settings}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "ai_settings_select_owner": [
        {
          "for": "${SELECT}",
          "on": "${table.ai_settings}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "ai_settings_update_owner": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${UPDATE}",
          "on": "${table.ai_settings}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "autopilot_settings_delete_owner": [
        {
          "for": "${DELETE}",
          "on": "${table.autopilot_settings}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "autopilot_settings_insert_owner": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${INSERT}",
          "on": "${table.autopilot_settings}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "autopilot_settings_select_owner": [
        {
          "for": "${SELECT}",
          "on": "${table.autopilot_settings}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "autopilot_settings_update_owner": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${UPDATE}",
          "on": "${table.autopilot_settings}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "gmb_accounts_delete_own": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_accounts}",
          "to": [
            "authenticated"
          ],
          "using": "(user_id = auth.uid())"
        }
      ],
      "gmb_accounts_insert_own": [
        {
          "check": "(user_id = auth.uid())",
          "for": "${INSERT}",
          "on": "${table.gmb_accounts}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "gmb_accounts_select_own": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_accounts}",
          "to": [
            "authenticated"
          ],
          "using": "(user_id = auth.uid())"
        }
      ],
      "gmb_accounts_update_own": [
        {
          "check": "(user_id = auth.uid())",
          "for": "${UPDATE}",
          "on": "${table.gmb_accounts}",
          "to": [
            "authenticated"
          ],
          "using": "(user_id = auth.uid())"
        }
      ],
      "gmb_locations_delete": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_locations}",
          "to": [
            "authenticated"
          ],
          "using": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (gmb_accounts.user_id = ( SELECT auth.uid() AS uid))))\n"
        }
      ],
      "gmb_locations_delete_owner": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_locations}",
          "to": [
            "authenticated"
          ],
          "using": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (( SELECT auth.uid() AS uid) = gmb_accounts.user_id)))\n"
        }
      ],
      "gmb_locations_insert": [
        {
          "check": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (gmb_accounts.user_id = ( SELECT auth.uid() AS uid))))\n",
          "for": "${INSERT}",
          "on": "${table.gmb_locations}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "gmb_locations_insert_owner": [
        {
          "check": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (( SELECT auth.uid() AS uid) = gmb_accounts.user_id)))\n",
          "for": "${INSERT}",
          "on": "${table.gmb_locations}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "gmb_locations_select": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_locations}",
          "to": [
            "authenticated"
          ],
          "using": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (gmb_accounts.user_id = ( SELECT auth.uid() AS uid))))\n"
        }
      ],
      "gmb_locations_select_owner": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_locations}",
          "to": [
            "authenticated"
          ],
          "using": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (( SELECT auth.uid() AS uid) = gmb_accounts.user_id)))\n"
        }
      ],
      "gmb_locations_update": [
        {
          "check": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (gmb_accounts.user_id = ( SELECT auth.uid() AS uid))))\n",
          "for": "${UPDATE}",
          "on": "${table.gmb_locations}",
          "to": [
            "authenticated"
          ],
          "using": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (gmb_accounts.user_id = ( SELECT auth.uid() AS uid))))\n"
        }
      ],
      "gmb_locations_update_owner": [
        {
          "check": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (( SELECT auth.uid() AS uid) = gmb_accounts.user_id)))\n",
          "for": "${UPDATE}",
          "on": "${table.gmb_locations}",
          "to": [
            "authenticated"
          ],
          "using": "(gmb_account_id IN ( SELECT gmb_accounts.id\n   FROM public.gmb_accounts\n  WHERE (( SELECT auth.uid() AS uid) = gmb_accounts.user_id)))\n"
        }
      ],
      "gmb_posts_delete_own": [
        {
          "for": "${DELETE}",
          "on": "${table.gmb_posts}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "gmb_posts_insert_own": [
        {
          "check": "(auth.uid() = user_id)",
          "for": "${INSERT}",
          "on": "${table.gmb_posts}",
          "to": [
            "${PUBLIC}"
          ]
        }
      ],
      "gmb_posts_select_own": [
        {
          "for": "${SELECT}",
          "on": "${table.gmb_posts}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "gmb_posts_update_own": [
        {
          "for": "${UPDATE}",
          "on": "${table.gmb_posts}",
          "to": [
            "${PUBLIC}"
          ],
          "using": "(auth.uid() = user_id)"
        }
      ],
      "logs_read_only": [
        {
          "for": "${SELECT}",
          "on": "${table.jobs_log}",
          "to": [
            "authenticated"
          ],
          "using": "true"
        }
      ],
      "profiles_delete_owner": [
        {
          "for": "${DELETE}",
          "on": "${table.profiles}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = id)"
        }
      ],
      "profiles_insert_owner": [
        {
          "check": "(( SELECT auth.uid() AS uid) = id)",
          "for": "${INSERT}",
          "on": "${table.profiles}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "profiles_select_owner": [
        {
          "for": "${SELECT}",
          "on": "${table.profiles}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = id)"
        }
      ],
      "profiles_update_owner": [
        {
          "check": "(( SELECT auth.uid() AS uid) = id)",
          "for": "${UPDATE}",
          "on": "${table.profiles}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = id)"
        }
      ],
      "results_read_only": [
        {
          "for": "${SELECT}",
          "on": "${table.sync_results}",
          "to": [
            "authenticated"
          ],
          "using": "true"
        }
      ],
      "room_members_can_read": [
        {
          "for": "${SELECT}",
          "on": "${table.messages}",
          "to": [
            "authenticated"
          ],
          "using": "((topic ~~ 'room:%'::text) AND (EXISTS ( SELECT 1\n   FROM public.room_members rm\n  WHERE ((rm.user_id = auth.uid()) AND (rm.room_id = (split_part(messages.topic, ':'::text, 2))::uuid)))))\n"
        }
      ],
      "room_members_can_write": [
        {
          "check": "((topic ~~ 'room:%'::text) AND (EXISTS ( SELECT 1\n   FROM public.room_members rm\n  WHERE ((rm.user_id = auth.uid()) AND (rm.room_id = (split_part(messages.topic, ':'::text, 2))::uuid)))))\n",
          "for": "${INSERT}",
          "on": "${table.messages}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "room_members_delete_own": [
        {
          "for": "${DELETE}",
          "on": "${table.room_members}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "room_members_insert_own": [
        {
          "check": "(( SELECT auth.uid() AS uid) = user_id)",
          "for": "${INSERT}",
          "on": "${table.room_members}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "room_members_read_own": [
        {
          "for": "${SELECT}",
          "on": "${table.room_members}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = user_id)"
        }
      ],
      "runs_read_only": [
        {
          "for": "${SELECT}",
          "on": "${table.sync_runs}",
          "to": [
            "authenticated"
          ],
          "using": "true"
        }
      ],
      "secret_keys_deny_all_delete": [
        {
          "for": "${DELETE}",
          "on": "${table.secret_keys}",
          "to": [
            "anon",
            "authenticated"
          ],
          "using": "false"
        }
      ],
      "secret_keys_deny_all_insert": [
        {
          "check": "false",
          "for": "${INSERT}",
          "on": "${table.secret_keys}",
          "to": [
            "anon",
            "authenticated"
          ]
        }
      ],
      "secret_keys_deny_all_select": [
        {
          "for": "${SELECT}",
          "on": "${table.secret_keys}",
          "to": [
            "anon",
            "authenticated"
          ],
          "using": "false"
        }
      ],
      "secret_keys_deny_all_update": [
        {
          "check": "false",
          "for": "${UPDATE}",
          "on": "${table.secret_keys}",
          "to": [
            "anon",
            "authenticated"
          ],
          "using": "false"
        }
      ],
      "users_delete_own": [
        {
          "for": "${DELETE}",
          "on": "${table.public.users}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = id)"
        }
      ],
      "users_insert_own": [
        {
          "check": "(( SELECT auth.uid() AS uid) = id)",
          "for": "${INSERT}",
          "on": "${table.public.users}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "users_select_own": [
        {
          "for": "${SELECT}",
          "on": "${table.public.users}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = id)"
        }
      ],
      "users_update_own": [
        {
          "check": "(( SELECT auth.uid() AS uid) = id)",
          "for": "${UPDATE}",
          "on": "${table.public.users}",
          "to": [
            "authenticated"
          ],
          "using": "(( SELECT auth.uid() AS uid) = id)"
        }
      ],
      "youtube_drafts_delete_own": [
        {
          "for": "${DELETE}",
          "on": "${table.youtube_drafts}",
          "to": [
            "authenticated"
          ],
          "using": "(user_id = auth.uid())"
        }
      ],
      "youtube_drafts_insert_own": [
        {
          "check": "(user_id = auth.uid())",
          "for": "${INSERT}",
          "on": "${table.youtube_drafts}",
          "to": [
            "authenticated"
          ]
        }
      ],
      "youtube_drafts_select_own": [
        {
          "for": "${SELECT}",
          "on": "${table.youtube_drafts}",
          "to": [
            "authenticated"
          ],
          "using": "(user_id = auth.uid())"
        }
      ],
      "youtube_drafts_update_own": [
        {
          "check": "(user_id = auth.uid())",
          "for": "${UPDATE}",
          "on": "${table.youtube_drafts}",
          "to": [
            "authenticated"
          ],
          "using": "(user_id = auth.uid())"
        }
      ]
    },
    "schema": {
      "auth": [
        {}
      ],
      "extensions": [
        {}
      ],
      "graphql": [
        {}
      ],
      "graphql_public": [
        {}
      ],
      "pgbouncer": [
        {}
      ],
      "public": [
        {
          "comment": "standard public schema"
        }
      ],
      "realtime": [
        {}
      ],
      "storage": [
        {}
      ],
      "supabase_migrations": [
        {}
      ],
      "vault": [
        {}
      ]
    },
    "table": {
      "activity_logs": [
        {
          "column": {
            "actionable": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "activity_message": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "activity_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "activity_logs_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_activity_logs_created_at_desc": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_activity_logs_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "ai_autopilot_logs": [
        {
          "check": {
            "ai_autopilot_logs_action_type_check": [
              {
                "expr": "(action_type = ANY (ARRAY['auto_reply'::text, 'auto_post'::text, 'content_generation'::text, 'optimization'::text]))"
              }
            ],
            "ai_autopilot_logs_status_check": [
              {
                "expr": "(status = ANY (ARRAY['success'::text, 'failed'::text, 'pending'::text]))"
              }
            ]
          },
          "column": {
            "action_description": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "action_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "status": [
              {
                "default": "success",
                "null": false,
                "type": "${text}"
              }
            ]
          },
          "foreign_key": {
            "ai_autopilot_logs_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_ai_autopilot_logs_action_type": [
              {
                "columns": [
                  "${column.action_type}"
                ]
              }
            ],
            "idx_ai_autopilot_logs_created_at": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_ai_autopilot_logs_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "ai_autopilot_settings": [
        {
          "check": {
            "ai_autopilot_settings_auto_reply_min_rating_check": [
              {
                "expr": "((auto_reply_min_rating >= 1) AND (auto_reply_min_rating <= 5))"
              }
            ],
            "ai_autopilot_settings_auto_reply_tone_check": [
              {
                "expr": "(auto_reply_tone = ANY (ARRAY['professional'::text, 'friendly'::text, 'casual'::text]))"
              }
            ],
            "ai_autopilot_settings_posting_frequency_check": [
              {
                "expr": "((posting_frequency >= 1) AND (posting_frequency <= 7))"
              }
            ]
          },
          "column": {
            "auto_reply_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "auto_reply_min_rating": [
              {
                "default": 1,
                "null": true,
                "type": "${integer}"
              }
            ],
            "auto_reply_tone": [
              {
                "default": "professional",
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "is_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "posting_days": [
              {
                "default": "${sql(\"ARRAY['monday'::text, 'wednesday'::text, 'friday'::text]\")}",
                "null": true,
                "type": "${sql(\"text[]\")}"
              }
            ],
            "posting_frequency": [
              {
                "default": 3,
                "null": true,
                "type": "${integer}"
              }
            ],
            "smart_posting_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "foreign_key": {
            "ai_autopilot_settings_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_ai_autopilot_settings_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "ai_autopilot_settings_location_id_key": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ]
          }
        }
      ],
      "ai_requests": [
        {
          "column": {
            "completion_tokens": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "cost_usd": [
              {
                "default": 0,
                "null": true,
                "type": "${numeric(10,6)}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "feature": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "latency_ms": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "location_id": [
              {
                "comment": "Foreign key to gmb_locations(id), nullable",
                "null": true,
                "type": "${uuid}"
              }
            ],
            "model": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "prompt_tokens": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "provider": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "success": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "total_tokens": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "user_id": [
              {
                "comment": "Foreign key to auth.users(id)",
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Tracks AI API requests for analytics and billing",
          "foreign_key": {
            "ai_requests_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${SET_NULL}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "ai_requests_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_ai_requests_created_at": [
              {
                "columns": [
                  "${column.created_at}"
                ]
              }
            ],
            "idx_ai_requests_feature": [
              {
                "columns": [
                  "${column.feature}"
                ]
              }
            ],
            "idx_ai_requests_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_ai_requests_provider": [
              {
                "columns": [
                  "${column.provider}"
                ]
              }
            ],
            "idx_ai_requests_user_created": [
              {
                "on": [
                  {
                    "column": "${column.user_id}"
                  },
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_ai_requests_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "ai_settings": [
        {
          "column": {
            "api_key": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "is_active": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "priority": [
              {
                "comment": "Lower number = higher priority when multiple providers are active",
                "default": 999,
                "null": true,
                "type": "${integer}"
              }
            ],
            "provider": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "comment": "Foreign key to auth.users(id)",
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "AI provider settings for users",
          "foreign_key": {
            "ai_settings_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_ai_settings_active": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.is_active}"
                ],
                "where": "(is_active = true)"
              }
            ],
            "idx_ai_settings_priority": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.priority}",
                  "${column.is_active}"
                ],
                "where": "(is_active = true)"
              }
            ],
            "idx_ai_settings_provider": [
              {
                "columns": [
                  "${column.provider}"
                ]
              }
            ],
            "idx_ai_settings_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "ai_settings_user_id_provider_key": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.provider}"
                ]
              }
            ]
          }
        }
      ],
      "audit_log_entries": [
        {
          "column": {
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "instance_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "ip_address": [
              {
                "default": "",
                "null": false,
                "type": "${character_varying(64)}"
              }
            ],
            "payload": [
              {
                "null": true,
                "type": "${json}"
              }
            ]
          },
          "comment": "Auth: Audit trail for user actions.",
          "index": {
            "audit_logs_instance_id_idx": [
              {
                "columns": [
                  "${column.instance_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "auth": {
        "schema_migrations": [
          {
            "column": {
              "version": [
                {
                  "null": false,
                  "type": "${character_varying(255)}"
                }
              ]
            },
            "comment": "Auth: Manages updates to the auth system.",
            "primary_key": [
              {
                "columns": [
                  "${column.version}"
                ]
              }
            ],
            "row_security": [
              {
                "enabled": true
              }
            ],
            "schema": "${schema.auth}"
          }
        ],
        "users": [
          {
            "check": {
              "users_email_change_confirm_status_check": [
                {
                  "expr": "((email_change_confirm_status >= 0) AND (email_change_confirm_status <= 2))"
                }
              ]
            },
            "column": {
              "aud": [
                {
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "banned_until": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "confirmation_sent_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "confirmation_token": [
                {
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "confirmed_at": [
                {
                  "as": [
                    {
                      "expr": "LEAST(email_confirmed_at, phone_confirmed_at)",
                      "type": "${STORED}"
                    }
                  ],
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "created_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "deleted_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "email": [
                {
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "email_change": [
                {
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "email_change_confirm_status": [
                {
                  "default": 0,
                  "null": true,
                  "type": "${smallint}"
                }
              ],
              "email_change_sent_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "email_change_token_current": [
                {
                  "default": "",
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "email_change_token_new": [
                {
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "email_confirmed_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "encrypted_password": [
                {
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "id": [
                {
                  "null": false,
                  "type": "${uuid}"
                }
              ],
              "instance_id": [
                {
                  "null": true,
                  "type": "${uuid}"
                }
              ],
              "invited_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "is_anonymous": [
                {
                  "default": false,
                  "null": false,
                  "type": "${boolean}"
                }
              ],
              "is_sso_user": [
                {
                  "comment": "Auth: Set this column to true when the account comes from SSO. These accounts can have duplicate emails.",
                  "default": false,
                  "null": false,
                  "type": "${boolean}"
                }
              ],
              "is_super_admin": [
                {
                  "null": true,
                  "type": "${boolean}"
                }
              ],
              "last_sign_in_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "phone": [
                {
                  "default": "${sql(\"NULL::character varying\")}",
                  "null": true,
                  "type": "${text}"
                }
              ],
              "phone_change": [
                {
                  "default": "",
                  "null": true,
                  "type": "${text}"
                }
              ],
              "phone_change_sent_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "phone_change_token": [
                {
                  "default": "",
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "phone_confirmed_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "raw_app_meta_data": [
                {
                  "null": true,
                  "type": "${jsonb}"
                }
              ],
              "raw_user_meta_data": [
                {
                  "null": true,
                  "type": "${jsonb}"
                }
              ],
              "reauthentication_sent_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "reauthentication_token": [
                {
                  "default": "",
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "recovery_sent_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "recovery_token": [
                {
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "role": [
                {
                  "null": true,
                  "type": "${character_varying(255)}"
                }
              ],
              "updated_at": [
                {
                  "null": true,
                  "type": "${timestampz}"
                }
              ]
            },
            "comment": "Auth: Stores user login data within a secure schema.",
            "index": {
              "confirmation_token_idx": [
                {
                  "columns": [
                    "${column.confirmation_token}"
                  ],
                  "unique": true,
                  "where": "((confirmation_token)::text !~ '^[0-9 ]*$'::text)"
                }
              ],
              "email_change_token_current_idx": [
                {
                  "columns": [
                    "${column.email_change_token_current}"
                  ],
                  "unique": true,
                  "where": "((email_change_token_current)::text !~ '^[0-9 ]*$'::text)"
                }
              ],
              "email_change_token_new_idx": [
                {
                  "columns": [
                    "${column.email_change_token_new}"
                  ],
                  "unique": true,
                  "where": "((email_change_token_new)::text !~ '^[0-9 ]*$'::text)"
                }
              ],
              "reauthentication_token_idx": [
                {
                  "columns": [
                    "${column.reauthentication_token}"
                  ],
                  "unique": true,
                  "where": "((reauthentication_token)::text !~ '^[0-9 ]*$'::text)"
                }
              ],
              "recovery_token_idx": [
                {
                  "columns": [
                    "${column.recovery_token}"
                  ],
                  "unique": true,
                  "where": "((recovery_token)::text !~ '^[0-9 ]*$'::text)"
                }
              ],
              "users_email_partial_key": [
                {
                  "columns": [
                    "${column.email}"
                  ],
                  "comment": "Auth: A partial unique index that applies only when is_sso_user is false",
                  "unique": true,
                  "where": "(is_sso_user = false)"
                }
              ],
              "users_instance_id_email_idx": [
                {
                  "on": [
                    {
                      "column": "${column.instance_id}"
                    },
                    {
                      "expr": "lower((email)::text)"
                    }
                  ]
                }
              ],
              "users_instance_id_idx": [
                {
                  "columns": [
                    "${column.instance_id}"
                  ]
                }
              ],
              "users_is_anonymous_idx": [
                {
                  "columns": [
                    "${column.is_anonymous}"
                  ]
                }
              ]
            },
            "primary_key": [
              {
                "columns": [
                  "${column.id}"
                ]
              }
            ],
            "row_security": [
              {
                "enabled": true
              }
            ],
            "schema": "${schema.auth}",
            "unique": {
              "users_phone_key": [
                {
                  "columns": [
                    "${column.phone}"
                  ]
                }
              ]
            }
          }
        ]
      },
      "auto_reply_queue": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "error_message": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "generated_response": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"extensions.uuid_generate_v4()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "response_style": [
              {
                "null": true,
                "type": "${character_varying(50)}"
              }
            ],
            "retry_count": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "review_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "scheduled_send_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "status": [
              {
                "default": "pending",
                "null": true,
                "type": "${character_varying(50)}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "auto_reply_queue_review_id_fkey": [
              {
                "columns": [
                  "${column.review_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_reviews.column.id}"
                ]
              }
            ],
            "auto_reply_queue_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_auto_reply_queue_review_id": [
              {
                "columns": [
                  "${column.review_id}"
                ]
              }
            ],
            "idx_auto_reply_queue_scheduled_send_at": [
              {
                "columns": [
                  "${column.scheduled_send_at}"
                ]
              }
            ],
            "idx_auto_reply_queue_status": [
              {
                "columns": [
                  "${column.status}"
                ]
              }
            ],
            "idx_auto_reply_queue_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "auto_reply_settings": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"extensions.uuid_generate_v4()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "language": [
              {
                "default": "en",
                "null": true,
                "type": "${character_varying(10)}"
              }
            ],
            "location_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "reply_to_negative": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "reply_to_neutral": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "reply_to_positive": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "require_approval": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "response_delay_minutes": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "response_style": [
              {
                "default": "professional",
                "null": true,
                "type": "${character_varying(50)}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "auto_reply_settings_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "auto_reply_settings_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_auto_reply_settings_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_auto_reply_settings_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "autopilot_logs": [
        {
          "check": {
            "autopilot_logs_action_type_check": [
              {
                "expr": "(action_type = ANY (ARRAY['auto_reply'::text, 'auto_post'::text, 'report_generated'::text, 'competitor_alert'::text]))"
              }
            ],
            "autopilot_logs_status_check": [
              {
                "expr": "(status = ANY (ARRAY['success'::text, 'failed'::text, 'pending'::text]))"
              }
            ]
          },
          "column": {
            "action_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "details": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "error_message": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "location_id": [
              {
                "comment": "Foreign key to gmb_locations(id)",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "status": [
              {
                "default": "pending",
                "null": false,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Logs for autopilot actions on GMB locations",
          "foreign_key": {
            "autopilot_logs_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "autopilot_logs_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_autopilot_logs_action_type": [
              {
                "columns": [
                  "${column.action_type}"
                ]
              }
            ],
            "idx_autopilot_logs_created_at": [
              {
                "columns": [
                  "${column.created_at}"
                ]
              }
            ],
            "idx_autopilot_logs_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_autopilot_logs_status": [
              {
                "columns": [
                  "${column.status}"
                ]
              }
            ],
            "idx_autopilot_logs_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "autopilot_settings": [
        {
          "check": {
            "autopilot_settings_auto_reply_min_rating_check": [
              {
                "expr": "((auto_reply_min_rating >= 1) AND (auto_reply_min_rating <= 5))"
              }
            ],
            "autopilot_settings_post_frequency_check": [
              {
                "expr": "((post_frequency >= 0) AND (post_frequency <= 7))"
              }
            ],
            "autopilot_settings_reply_tone_check": [
              {
                "expr": "(reply_tone = ANY (ARRAY['professional'::text, 'friendly'::text, 'casual'::text]))"
              }
            ],
            "autopilot_settings_report_frequency_check": [
              {
                "expr": "(report_frequency = ANY (ARRAY['daily'::text, 'weekly'::text, 'monthly'::text]))"
              }
            ]
          },
          "column": {
            "auto_reply_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "auto_reply_min_rating": [
              {
                "default": 1,
                "null": true,
                "type": "${integer}"
              }
            ],
            "competitor_monitoring_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "content_preferences": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "insights_reports_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "is_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "location_id": [
              {
                "comment": "Foreign key to gmb_locations(id)",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "post_days": [
              {
                "default": "[]",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "post_frequency": [
              {
                "default": 3,
                "null": true,
                "type": "${integer}"
              }
            ],
            "post_times": [
              {
                "default": "[]",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "reply_tone": [
              {
                "default": "professional",
                "null": true,
                "type": "${text}"
              }
            ],
            "report_frequency": [
              {
                "default": "weekly",
                "null": true,
                "type": "${text}"
              }
            ],
            "smart_posting_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "comment": "Foreign key to auth.users(id)",
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Autopilot settings for GMB locations",
          "foreign_key": {
            "autopilot_settings_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "autopilot_settings_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_autopilot_settings_enabled": [
              {
                "columns": [
                  "${column.is_enabled}"
                ],
                "where": "(is_enabled = true)"
              }
            ],
            "idx_autopilot_settings_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_autopilot_settings_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "autopilot_settings_location_id_key": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ]
          }
        }
      ],
      "buckets": [
        {
          "column": {
            "allowed_mime_types": [
              {
                "null": true,
                "type": "${sql(\"text[]\")}"
              }
            ],
            "avif_autodetection": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "file_size_limit": [
              {
                "null": true,
                "type": "${bigint}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "name": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "owner": [
              {
                "comment": "Field is deprecated, use owner_id instead",
                "null": true,
                "type": "${uuid}"
              }
            ],
            "owner_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "public": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "type": [
              {
                "default": "STANDARD",
                "null": false,
                "type": "${enum.buckettype}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "index": {
            "bname": [
              {
                "columns": [
                  "${column.name}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "buckets_analytics": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "format": [
              {
                "default": "ICEBERG",
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "type": [
              {
                "default": "ANALYTICS",
                "null": false,
                "type": "${enum.buckettype}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "citation_listings": [
        {
          "check": {
            "citation_listings_consistency_score_check": [
              {
                "expr": "((consistency_score >= 0) AND (consistency_score <= 100))"
              }
            ],
            "citation_listings_status_check": [
              {
                "expr": "(status = ANY (ARRAY['verified'::text, 'pending'::text, 'inconsistent'::text, 'missing'::text]))"
              }
            ]
          },
          "column": {
            "address": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "business_name": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "consistency_score": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "last_checked": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "listing_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "location_id": [
              {
                "comment": "Foreign key to gmb_locations(id)",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "notes": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "phone": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "source_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "status": [
              {
                "default": "pending",
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Citation listings for GMB locations",
          "foreign_key": {
            "citation_listings_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "citation_listings_source_id_fkey": [
              {
                "columns": [
                  "${column.source_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.citation_sources.column.id}"
                ]
              }
            ],
            "citation_listings_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_citation_listings_consistency_score": [
              {
                "columns": [
                  "${column.consistency_score}"
                ]
              }
            ],
            "idx_citation_listings_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_citation_listings_source_id": [
              {
                "columns": [
                  "${column.source_id}"
                ]
              }
            ],
            "idx_citation_listings_status": [
              {
                "columns": [
                  "${column.status}"
                ]
              }
            ],
            "idx_citation_listings_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "citation_sources": [
        {
          "check": {
            "citation_sources_category_check": [
              {
                "expr": "(category = ANY (ARRAY['general'::text, 'industry_specific'::text, 'local'::text]))"
              }
            ]
          },
          "column": {
            "category": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "domain_authority": [
              {
                "comment": "Domain authority score (0-100)",
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "is_active": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "logo_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "name": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "url_pattern": [
              {
                "null": true,
                "type": "${text}"
              }
            ]
          },
          "comment": "Citation sources for business listings",
          "index": {
            "idx_citation_sources_active": [
              {
                "columns": [
                  "${column.is_active}"
                ],
                "where": "(is_active = true)"
              }
            ],
            "idx_citation_sources_category": [
              {
                "columns": [
                  "${column.category}"
                ]
              }
            ],
            "idx_citation_sources_name": [
              {
                "columns": [
                  "${column.name}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "client_profiles": [
        {
          "column": {
            "brand_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "cover_image_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "logo_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "primary_color": [
              {
                "default": "#FFA500",
                "null": true,
                "type": "${character_varying(7)}"
              }
            ],
            "secondary_color": [
              {
                "default": "#1A1A1A",
                "null": true,
                "type": "${character_varying(7)}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "comment": "Links the profile to a specific authenticated user.",
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Stores client-specific branding information like logos and colors.",
          "foreign_key": {
            "client_profiles_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "client_profiles_user_id_key": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          }
        }
      ],
      "competitor_tracking": [
        {
          "check": {
            "competitor_tracking_rating_check": [
              {
                "expr": "((average_rating IS NULL) OR ((average_rating >= (0)::numeric) AND (average_rating <= (5)::numeric)))"
              }
            ]
          },
          "column": {
            "average_rating": [
              {
                "null": true,
                "type": "${numeric(2,1)}"
              }
            ],
            "competitor_gmb_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "competitor_name": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "distance_miles": [
              {
                "null": true,
                "type": "${numeric(5,2)}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "is_active": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "location_id": [
              {
                "comment": "Foreign key to gmb_locations(id)",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "post_frequency": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "review_count": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Tracks competitor businesses for GMB locations",
          "foreign_key": {
            "competitor_tracking_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "competitor_tracking_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_competitor_tracking_competitor_gmb_id": [
              {
                "columns": [
                  "${column.competitor_gmb_id}"
                ]
              }
            ],
            "idx_competitor_tracking_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_competitor_tracking_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "content_generation": [
        {
          "check": {
            "content_generation_content_type_check": [
              {
                "expr": "(content_type = ANY (ARRAY['posts'::text, 'responses'::text, 'descriptions'::text, 'faqs'::text]))"
              }
            ]
          },
          "column": {
            "content_type": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "generated_content": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "prompt": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "provider": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "tone": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "content_generation_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_content_generation_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "content_generations": [
        {
          "column": {
            "ai_model": [
              {
                "default": "claude-3",
                "null": true,
                "type": "${text}"
              }
            ],
            "content_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "cost": [
              {
                "null": true,
                "type": "${numeric(10,4)}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "generated_content": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "prompt": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "tokens_used": [
              {
                "null": true,
                "type": "${integer}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "content_generations_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "flow_state": [
        {
          "column": {
            "auth_code": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "auth_code_issued_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "authentication_method": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "code_challenge": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "code_challenge_method": [
              {
                "null": false,
                "type": "${enum.code_challenge_method}"
              }
            ],
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "provider_access_token": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "provider_refresh_token": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "provider_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "stores metadata for pkce logins",
          "index": {
            "flow_state_created_at_idx": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_auth_code": [
              {
                "columns": [
                  "${column.auth_code}"
                ]
              }
            ],
            "idx_user_id_auth_method": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.authentication_method}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "gmb_accounts": [
        {
          "column": {
            "access_token": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "account_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "account_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "data_retention_days": [
              {
                "comment": "Number of days to retain archived data before permanent deletion",
                "default": 30,
                "null": true,
                "type": "${integer}"
              }
            ],
            "delete_on_disconnect": [
              {
                "comment": "If true, delete all data immediately on disconnect",
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "disconnected_at": [
              {
                "comment": "Timestamp when account was disconnected",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "email": [
              {
                "comment": "Email address of the Google account",
                "null": true,
                "type": "${text}"
              }
            ],
            "google_account_id": [
              {
                "comment": "Google user ID from OAuth",
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "is_active": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "last_sync": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "refresh_token": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "settings": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "token_expires_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "fk_user": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ],
            "fk_user_profile": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ],
            "gmb_accounts_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_gmb_accounts_active": [
              {
                "columns": [
                  "${column.is_active}"
                ]
              }
            ],
            "idx_gmb_accounts_disconnected": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.disconnected_at}"
                ],
                "where": "(disconnected_at IS NOT NULL)"
              }
            ],
            "idx_gmb_accounts_google_account_id": [
              {
                "columns": [
                  "${column.google_account_id}"
                ]
              }
            ],
            "idx_gmb_accounts_google_id": [
              {
                "columns": [
                  "${column.google_account_id}"
                ]
              }
            ],
            "idx_gmb_accounts_id": [
              {
                "columns": [
                  "${column.id}"
                ]
              }
            ],
            "idx_gmb_accounts_last_sync": [
              {
                "comment": "Optimizes stale data detection",
                "on": [
                  {
                    "column": "${column.last_sync}",
                    "desc": true
                  }
                ],
                "where": "(is_active = true)"
              }
            ],
            "idx_gmb_accounts_tokens": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.token_expires_at}"
                ]
              }
            ],
            "idx_gmb_accounts_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_accounts_user_active": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.is_active}"
                ],
                "where": "(is_active = true)"
              }
            ],
            "idx_gmb_accounts_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_accounts_user_account_unique": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.account_id}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_attributes": [
        {
          "column": {
            "attribute_name": [
              {
                "comment": "Full attribute name from GMB API (e.g., attributes/has_wheelchair_accessible_entrance)",
                "null": false,
                "type": "${text}"
              }
            ],
            "attribute_value": [
              {
                "comment": "JSON array of attribute values",
                "null": false,
                "type": "${jsonb}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "display_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "gmb_account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "group_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "is_active": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "is_deprecated": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "synced_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "value_type": [
              {
                "comment": "Type of attribute value (BOOL, ENUM, URL, REPEATED_ENUM)",
                "null": true,
                "type": "${text}"
              }
            ]
          },
          "comment": "Stores Google My Business location attributes and their values",
          "foreign_key": {
            "gmb_attributes_gmb_account_id_fkey": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_accounts.column.id}"
                ]
              }
            ],
            "gmb_attributes_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "gmb_attributes_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_gmb_attributes_account": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_attributes_active": [
              {
                "columns": [
                  "${column.is_active}"
                ],
                "where": "(is_active = true)"
              }
            ],
            "idx_gmb_attributes_gmb_account_id": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_attributes_location": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_attributes_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_attributes_name": [
              {
                "columns": [
                  "${column.attribute_name}"
                ]
              }
            ],
            "idx_gmb_attributes_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_attributes_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_attributes_location_id_attribute_name_key": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.attribute_name}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_citations": [
        {
          "check": {
            "gmb_citations_status_check": [
              {
                "expr": "(status = ANY (ARRAY['verified'::text, 'inconsistent'::text, 'pending'::text, 'missing'::text]))"
              }
            ]
          },
          "column": {
            "address": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "business_name": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "last_checked": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "phone": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "platform_name": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "platform_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "status": [
              {
                "default": "pending",
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "foreign_key": {
            "gmb_citations_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_gmb_citations_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_citations_status": [
              {
                "columns": [
                  "${column.status}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "gmb_dashboard_reports": [
        {
          "column": {
            "category": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestamp}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${bigserial}"
              }
            ],
            "report_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "stats": [
              {
                "null": false,
                "type": "${jsonb}"
              }
            ]
          },
          "index": {
            "idx_gmb_dashboard_reports_category": [
              {
                "columns": [
                  "${column.category}"
                ]
              }
            ],
            "idx_gmb_dashboard_reports_type": [
              {
                "columns": [
                  "${column.report_type}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "gmb_insights": [
        {
          "check": {
            "gmb_insights_metric_type_check": [
              {
                "expr": "(metric_type = ANY (ARRAY['views'::text, 'searches'::text, 'calls'::text, 'messages'::text, 'directions'::text, 'website_clicks'::text]))"
              }
            ],
            "gmb_insights_source_check": [
              {
                "expr": "(source = ANY (ARRAY['direct'::text, 'discovery'::text, 'branded'::text, 'total'::text]))"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "date": [
              {
                "null": false,
                "type": "${date}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metric_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "metric_value": [
              {
                "default": 0,
                "null": false,
                "type": "${integer}"
              }
            ],
            "source": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "foreign_key": {
            "gmb_insights_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_gmb_insights_date": [
              {
                "columns": [
                  "${column.date}"
                ]
              }
            ],
            "idx_gmb_insights_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_insights_metric_type": [
              {
                "columns": [
                  "${column.metric_type}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_insights_location_id_date_metric_type_source_key": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.date}",
                  "${column.metric_type}",
                  "${column.source}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_locations": [
        {
          "check": {
            "gmb_locations_health_score_check": [
              {
                "expr": "((health_score >= 0) AND (health_score <= 100))"
              }
            ],
            "gmb_locations_status_check": [
              {
                "expr": "(status = ANY (ARRAY['verified'::text, 'pending'::text, 'suspended'::text]))"
              }
            ]
          },
          "column": {
            "account_id": [
              {
                "comment": "Google My Business account ID",
                "null": true,
                "type": "${text}"
              }
            ],
            "additional_categories": [
              {
                "default": "${sql(\"COALESCE(ARRAY[]::text[], ARRAY[]::text[])\")}",
                "null": true,
                "type": "${sql(\"text[]\")}"
              }
            ],
            "address": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "ai_insights": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "appointment_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "archived_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "booking_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "business_hours": [
              {
                "default": "{\"friday\": {\"open\": \"09:00\", \"close\": \"17:00\", \"closed\": false}, \"monday\": {\"open\": \"09:00\", \"close\": \"17:00\", \"closed\": false}, \"sunday\": {\"open\": \"00:00\", \"close\": \"00:00\", \"closed\": true}, \"tuesday\": {\"open\": \"09:00\", \"close\": \"17:00\", \"closed\": false}, \"saturday\": {\"open\": \"10:00\", \"close\": \"16:00\", \"closed\": false}, \"thursday\": {\"open\": \"09:00\", \"close\": \"17:00\", \"closed\": false}, \"wednesday\": {\"open\": \"09:00\", \"close\": \"17:00\", \"closed\": false}}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "category": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "cover_photo_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "description": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "from_the_business": [
              {
                "default": "${sql(\"COALESCE(ARRAY[]::text[], ARRAY[]::text[])\")}",
                "null": true,
                "type": "${sql(\"text[]\")}"
              }
            ],
            "gmb_account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "health_score": [
              {
                "comment": "Calculated health score (0-100)",
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "is_active": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "is_archived": [
              {
                "comment": "Location is archived (disconnected but data retained)",
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "is_syncing": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "last_synced_at": [
              {
                "comment": "Last time data was synced from Google API",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "latitude": [
              {
                "comment": "Latitude coordinate of the location (from Google API latlng)",
                "null": true,
                "type": "${double_precision}"
              }
            ],
            "latlng": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "location_id_external": [
              {
                "comment": "Google My Business location ID from API",
                "null": true,
                "type": "${text}"
              }
            ],
            "location_name": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "longitude": [
              {
                "comment": "Longitude coordinate of the location (from Google API latlng)",
                "null": true,
                "type": "${double_precision}"
              }
            ],
            "menu_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "normalized_location_id": [
              {
                "comment": "Normalized location ID extracted from full resource name. Used to prevent duplicates.",
                "null": true,
                "type": "${text}"
              }
            ],
            "opening_date": [
              {
                "null": true,
                "type": "${date}"
              }
            ],
            "order_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "phone": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "profile_completeness": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "rating": [
              {
                "comment": "Average rating for the location (0.0 to 5.0)",
                "null": true,
                "type": "${numeric(2,1)}"
              }
            ],
            "regularhours": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "response_rate": [
              {
                "comment": "Response rate percentage (0.0-100.0)",
                "default": 0,
                "null": true,
                "type": "${numeric(5,2)}"
              }
            ],
            "review_count": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "service_area_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "short_description": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "status": [
              {
                "comment": "حالة الموقع - Location verification status",
                "default": "pending",
                "null": true,
                "type": "${text}"
              }
            ],
            "type": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "comment": "Foreign key to auth.users table - owner of this location",
                "null": true,
                "type": "${uuid}"
              }
            ],
            "website": [
              {
                "null": true,
                "type": "${text}"
              }
            ]
          },
          "comment": "Real-time enabled: Updates broadcast to subscribed clients",
          "foreign_key": {
            "gmb_locations_gmb_account_id_fkey": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_accounts.column.id}"
                ]
              }
            ],
            "gmb_locations_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "gmb_locations_account_idx": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "gmb_locations_normalized_idx": [
              {
                "columns": [
                  "${column.normalized_location_id}"
                ]
              }
            ],
            "idx_gmb_locations_account_active": [
              {
                "columns": [
                  "${column.gmb_account_id}",
                  "${column.is_active}"
                ],
                "where": "(is_active = true)"
              }
            ],
            "idx_gmb_locations_account_id": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_locations_account_location": [
              {
                "columns": [
                  "${column.gmb_account_id}",
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_locations_account_normalized": [
              {
                "columns": [
                  "${column.gmb_account_id}",
                  "${column.normalized_location_id}"
                ]
              }
            ],
            "idx_gmb_locations_archived": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.is_archived}"
                ],
                "where": "(is_archived = true)"
              }
            ],
            "idx_gmb_locations_coordinates": [
              {
                "columns": [
                  "${column.latitude}",
                  "${column.longitude}"
                ],
                "where": "((latitude IS NOT NULL) AND (longitude IS NOT NULL))"
              }
            ],
            "idx_gmb_locations_created": [
              {
                "on": [
                  {
                    "column": "${column.user_id}"
                  },
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_locations_gmb_account_id": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_locations_health_score": [
              {
                "columns": [
                  "${column.health_score}"
                ]
              }
            ],
            "idx_gmb_locations_id": [
              {
                "columns": [
                  "${column.id}"
                ]
              }
            ],
            "idx_gmb_locations_is_syncing": [
              {
                "columns": [
                  "${column.is_syncing}"
                ],
                "where": "(is_syncing = true)"
              }
            ],
            "idx_gmb_locations_last_synced_at": [
              {
                "columns": [
                  "${column.last_synced_at}"
                ]
              }
            ],
            "idx_gmb_locations_latitude": [
              {
                "columns": [
                  "${column.latitude}"
                ],
                "where": "(latitude IS NOT NULL)"
              }
            ],
            "idx_gmb_locations_location_id_external": [
              {
                "columns": [
                  "${column.location_id_external}"
                ]
              }
            ],
            "idx_gmb_locations_longitude": [
              {
                "columns": [
                  "${column.longitude}"
                ],
                "where": "(longitude IS NOT NULL)"
              }
            ],
            "idx_gmb_locations_metadata": [
              {
                "columns": [
                  "${column.metadata}"
                ],
                "type": "${GIN}"
              }
            ],
            "idx_gmb_locations_normalized_id": [
              {
                "columns": [
                  "${column.normalized_location_id}"
                ]
              }
            ],
            "idx_gmb_locations_rating": [
              {
                "columns": [
                  "${column.rating}"
                ]
              }
            ],
            "idx_gmb_locations_response_rate": [
              {
                "on": [
                  {
                    "column": "${column.response_rate}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_locations_review_count": [
              {
                "on": [
                  {
                    "column": "${column.review_count}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_locations_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_locations_user_account": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_locations_user_active": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.is_active}"
                ],
                "where": "(is_active = true)"
              }
            ],
            "idx_gmb_locations_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_locations_location_user_unique": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.user_id}"
                ]
              }
            ],
            "gmb_locations_unique_account_location": [
              {
                "columns": [
                  "${column.gmb_account_id}",
                  "${column.location_id}"
                ]
              }
            ],
            "unique_location_per_account_normalized": [
              {
                "columns": [
                  "${column.gmb_account_id}",
                  "${column.normalized_location_id}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_media": [
        {
          "column": {
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "external_media_id": [
              {
                "comment": "Unique identifier from Google My Business API",
                "null": false,
                "type": "${text}"
              }
            ],
            "gmb_account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "comment": "Full media object from Google API for reference",
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "synced_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "thumbnail_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "type": [
              {
                "comment": "Type of media: PHOTO, VIDEO, etc.",
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Stores media items (photos/videos) from Google My Business locations",
          "foreign_key": {
            "gmb_media_gmb_account_id_fkey": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_accounts.column.id}"
                ]
              }
            ],
            "gmb_media_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "gmb_media_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "gmb_media_external_uidx": [
              {
                "columns": [
                  "${column.external_media_id}"
                ],
                "unique": true
              }
            ],
            "gmb_media_location_idx": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_media_account": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_media_external_id": [
              {
                "columns": [
                  "${column.external_media_id}"
                ]
              }
            ],
            "idx_gmb_media_gmb_account_id": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_media_location": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_media_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_media_unique": [
              {
                "columns": [
                  "${column.external_media_id}",
                  "${column.location_id}"
                ],
                "unique": true
              }
            ],
            "idx_gmb_media_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_media_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "uidx_gmb_media_external": [
              {
                "columns": [
                  "${column.external_media_id}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_media_external_media_id_key": [
              {
                "columns": [
                  "${column.external_media_id}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_metrics": [
        {
          "check": {
            "gmb_metrics_phase_check": [
              {
                "expr": "(phase = ANY (ARRAY['locations'::text, 'reviews'::text, 'media'::text, 'questions'::text, 'performance'::text, 'keywords'::text]))"
              }
            ]
          },
          "column": {
            "avg_duration_ms": [
              {
                "as": [
                  {
                    "expr": "\nCASE\n    WHEN (runs_count > 0) THEN ((total_duration_ms)::numeric / (runs_count)::numeric)\n    ELSE (0)::numeric\nEND",
                    "type": "${STORED}"
                  }
                ],
                "null": true,
                "type": "${numeric}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "gmb_account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "phase": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "runs_count": [
              {
                "default": 0,
                "null": false,
                "type": "${integer}"
              }
            ],
            "total_duration_ms": [
              {
                "default": 0,
                "null": false,
                "type": "${bigint}"
              }
            ],
            "total_items_count": [
              {
                "default": 0,
                "null": false,
                "type": "${bigint}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "index": {
            "gmb_metrics_account_phase_idx": [
              {
                "columns": [
                  "${column.gmb_account_id}",
                  "${column.phase}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_metrics_unique": [
              {
                "columns": [
                  "${column.gmb_account_id}",
                  "${column.phase}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_performance_metrics": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "gmb_account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "metric_date": [
              {
                "null": false,
                "type": "${date}"
              }
            ],
            "metric_type": [
              {
                "comment": "Type of metric (e.g., BUSINESS_IMPRESSIONS_DESKTOP_MAPS, CALL_CLICKS, WEBSITE_CLICKS)",
                "null": false,
                "type": "${text}"
              }
            ],
            "metric_value": [
              {
                "comment": "The actual metric value for the given date",
                "default": 0,
                "null": false,
                "type": "${bigint}"
              }
            ],
            "sub_entity_type": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "synced_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Stores daily performance metrics from Business Profile Performance API",
          "foreign_key": {
            "gmb_performance_metrics_gmb_account_id_fkey": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_accounts.column.id}"
                ]
              }
            ],
            "gmb_performance_metrics_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "gmb_performance_metrics_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "gmb_perf_loc_date_idx": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.metric_date}"
                ]
              }
            ],
            "gmb_perf_location_date_idx": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.metric_date}"
                ]
              }
            ],
            "idx_gmb_performance_metrics_account": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_performance_metrics_date": [
              {
                "on": [
                  {
                    "column": "${column.metric_date}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_performance_metrics_gmb_account_id": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_performance_metrics_location": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_performance_metrics_location_date": [
              {
                "on": [
                  {
                    "column": "${column.location_id}"
                  },
                  {
                    "column": "${column.metric_date}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_performance_metrics_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_performance_metrics_type": [
              {
                "columns": [
                  "${column.metric_type}"
                ]
              }
            ],
            "idx_gmb_performance_metrics_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_performance_metrics_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "uidx_gmb_perf_loc_date_type": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.metric_date}",
                  "${column.metric_type}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_performance_metrics_location_id_metric_date_metric_type_key": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.metric_date}",
                  "${column.metric_type}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_posts": [
        {
          "check": {
            "gmb_posts_post_type_check": [
              {
                "expr": "(post_type = ANY (ARRAY['whats_new'::text, 'event'::text, 'offer'::text]))"
              }
            ],
            "gmb_posts_status_check": [
              {
                "expr": "(status = ANY (ARRAY['draft'::text, 'queued'::text, 'published'::text, 'failed'::text]))"
              }
            ]
          },
          "column": {
            "archived_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "call_to_action": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "call_to_action_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "content": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "cta_type": [
              {
                "comment": "Call-to-action button type (BOOK, ORDER, etc.)",
                "null": true,
                "type": "${text}"
              }
            ],
            "cta_url": [
              {
                "comment": "URL for call-to-action button",
                "null": true,
                "type": "${text}"
              }
            ],
            "end_date": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "error_message": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "is_archived": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "media_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "post_id": [
              {
                "comment": "Google My Business post ID from API",
                "null": true,
                "type": "${text}"
              }
            ],
            "post_type": [
              {
                "default": "whats_new",
                "null": true,
                "type": "${text}"
              }
            ],
            "provider_post_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "published_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "scheduled_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "start_date": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "status": [
              {
                "default": "draft",
                "null": false,
                "type": "${text}"
              }
            ],
            "title": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Stores GMB posts for composing and scheduling Business Profile posts",
          "foreign_key": {
            "gmb_posts_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "gmb_posts_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "gmb_posts_post_type_idx": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.post_type}"
                ]
              }
            ],
            "gmb_posts_user_loc_idx": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.location_id}",
                  "${column.status}"
                ]
              }
            ],
            "idx_gmb_posts_archived": [
              {
                "columns": [
                  "${column.is_archived}"
                ],
                "where": "(is_archived = true)"
              }
            ],
            "idx_gmb_posts_loc": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_posts_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_posts_location_status": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.status}"
                ]
              }
            ],
            "idx_gmb_posts_post_id": [
              {
                "columns": [
                  "${column.post_id}"
                ]
              }
            ],
            "idx_gmb_posts_post_type": [
              {
                "columns": [
                  "${column.post_type}"
                ]
              }
            ],
            "idx_gmb_posts_scheduled": [
              {
                "columns": [
                  "${column.scheduled_at}"
                ],
                "where": "((scheduled_at IS NOT NULL) AND (status = 'queued'::text))"
              }
            ],
            "idx_gmb_posts_stat": [
              {
                "columns": [
                  "${column.status}"
                ]
              }
            ],
            "idx_gmb_posts_status": [
              {
                "columns": [
                  "${column.status}"
                ]
              }
            ],
            "idx_gmb_posts_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_posts_post_id_key": [
              {
                "columns": [
                  "${column.post_id}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_questions": [
        {
          "check": {
            "gmb_questions_ai_confidence_score_check": [
              {
                "expr": "((ai_confidence_score >= (0)::numeric) AND (ai_confidence_score <= (1)::numeric))"
              }
            ],
            "gmb_questions_answer_status_check": [
              {
                "expr": "(answer_status = ANY (ARRAY['unanswered'::text, 'answered'::text, 'deleted'::text, 'pending'::text, 'draft'::text]))"
              }
            ],
            "gmb_questions_author_type_check": [
              {
                "expr": "(author_type = ANY (ARRAY['MERCHANT'::text, 'CUSTOMER'::text, 'GOOGLE_USER'::text]))"
              }
            ],
            "gmb_questions_priority_check": [
              {
                "expr": "(priority = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text, 'urgent'::text]))"
              }
            ],
            "gmb_questions_status_check": [
              {
                "expr": "(status = ANY (ARRAY['pending'::text, 'answered'::text, 'flagged'::text, 'archived'::text]))"
              }
            ]
          },
          "column": {
            "ai_answer_generated": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "ai_category": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "ai_confidence_score": [
              {
                "comment": "Confidence score (0-1) for AI-generated answer",
                "null": true,
                "type": "${numeric(3,2)}"
              }
            ],
            "ai_suggested_answer": [
              {
                "comment": "AI-generated suggested answer for the question",
                "null": true,
                "type": "${text}"
              }
            ],
            "answer_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "answer_status": [
              {
                "default": "pending",
                "null": true,
                "type": "${text}"
              }
            ],
            "answer_text": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "answered_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "answered_by": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "archived_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "asked_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "author_display_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "author_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "author_profile_photo_url": [
              {
                "comment": "URL to question author profile photo",
                "null": true,
                "type": "${text}"
              }
            ],
            "author_type": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "external_question_id": [
              {
                "comment": "External question ID from Google if available",
                "null": true,
                "type": "${text}"
              }
            ],
            "gmb_account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "google_resource_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "internal_notes": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "is_archived": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "is_featured": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "is_hidden": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "language_code": [
              {
                "default": "en",
                "null": true,
                "type": "${text}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "priority": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "question_id": [
              {
                "comment": "Google My Business question ID for API calls",
                "null": true,
                "type": "${text}"
              }
            ],
            "question_text": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "question_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "status": [
              {
                "default": "pending",
                "null": true,
                "type": "${text}"
              }
            ],
            "synced_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "total_answer_count": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "upvote_count": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Real-time enabled: Changes broadcast to subscribed clients",
          "foreign_key": {
            "gmb_questions_gmb_account_id_fkey": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_accounts.column.id}"
                ]
              }
            ],
            "gmb_questions_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "gmb_questions_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "gmb_questions_external_uidx": [
              {
                "columns": [
                  "${column.external_question_id}"
                ],
                "unique": true
              }
            ],
            "gmb_questions_location_idx": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_questions_account": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_questions_answer_status": [
              {
                "columns": [
                  "${column.answer_status}"
                ]
              }
            ],
            "idx_gmb_questions_archived": [
              {
                "columns": [
                  "${column.is_archived}"
                ],
                "where": "(is_archived = true)"
              }
            ],
            "idx_gmb_questions_created": [
              {
                "comment": "Optimizes questions date filtering",
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_questions_created_at": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_questions_external_id": [
              {
                "columns": [
                  "${column.external_question_id}"
                ]
              }
            ],
            "idx_gmb_questions_gmb_account_id": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_questions_loc": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_questions_location": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_questions_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_questions_question_id": [
              {
                "columns": [
                  "${column.question_id}"
                ]
              }
            ],
            "idx_gmb_questions_status": [
              {
                "columns": [
                  "${column.answer_status}"
                ]
              }
            ],
            "idx_gmb_questions_unanswered": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.location_id}"
                ],
                "where": "(answer_text IS NULL)"
              }
            ],
            "idx_gmb_questions_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_questions_user_date": [
              {
                "on": [
                  {
                    "column": "${column.user_id}"
                  },
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  },
                  {
                    "column": "${column.location_id}"
                  }
                ]
              }
            ],
            "idx_gmb_questions_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_questions_user_location_answer": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.location_id}",
                  "${column.answer_text}"
                ]
              }
            ],
            "idx_questions_asked_at": [
              {
                "on": [
                  {
                    "column": "${column.asked_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_questions_priority": [
              {
                "columns": [
                  "${column.priority}"
                ]
              }
            ],
            "idx_questions_question_id": [
              {
                "columns": [
                  "${column.question_id}"
                ]
              }
            ],
            "idx_questions_status": [
              {
                "columns": [
                  "${column.status}"
                ]
              }
            ],
            "idx_questions_upvotes": [
              {
                "on": [
                  {
                    "column": "${column.upvote_count}",
                    "desc": true
                  }
                ]
              }
            ],
            "uidx_gmb_questions_external": [
              {
                "columns": [
                  "${column.external_question_id}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_questions_external_question_id_key": [
              {
                "columns": [
                  "${column.external_question_id}"
                ]
              }
            ],
            "gmb_questions_question_id_key": [
              {
                "columns": [
                  "${column.question_id}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_rankings": [
        {
          "column": {
            "best_position": [
              {
                "null": true,
                "type": "${integer}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "current_position": [
              {
                "null": true,
                "type": "${integer}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "keyword": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "last_checked": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "previous_position": [
              {
                "null": true,
                "type": "${integer}"
              }
            ],
            "search_volume": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "foreign_key": {
            "gmb_rankings_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_gmb_rankings_keyword": [
              {
                "columns": [
                  "${column.keyword}"
                ]
              }
            ],
            "idx_gmb_rankings_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_rankings_location_id_keyword_key": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.keyword}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_reviews": [
        {
          "check": {
            "gmb_reviews_ai_sentiment_check": [
              {
                "expr": "(ai_sentiment = ANY (ARRAY['positive'::text, 'neutral'::text, 'negative'::text]))"
              }
            ],
            "gmb_reviews_rating_check": [
              {
                "expr": "((rating >= 1) AND (rating <= 5))"
              }
            ],
            "gmb_reviews_status_check": [
              {
                "expr": "(status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'responded'::text, 'flagged'::text, 'archived'::text, 'new'::text]))"
              }
            ]
          },
          "column": {
            "account_id": [
              {
                "comment": "Google My Business account ID for API calls",
                "null": true,
                "type": "${text}"
              }
            ],
            "ai_confidence_score": [
              {
                "null": true,
                "type": "${numeric(3,2)}"
              }
            ],
            "ai_generated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "ai_generated_response": [
              {
                "comment": "AI-suggested reply text for this review",
                "null": true,
                "type": "${text}"
              }
            ],
            "ai_reply_generated": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "ai_sent_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "ai_sentiment": [
              {
                "comment": "AI-analyzed sentiment: positive, neutral, or negative",
                "null": true,
                "type": "${text}"
              }
            ],
            "ai_sentiment_score": [
              {
                "null": true,
                "type": "${numeric(3,2)}"
              }
            ],
            "ai_suggested_reply": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "archived_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "auto_reply_enabled": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "auto_reply_status": [
              {
                "null": true,
                "type": "${character_varying(50)}"
              }
            ],
            "comment": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "external_review_id": [
              {
                "comment": "Unique review ID from Google My Business API",
                "null": true,
                "type": "${text}"
              }
            ],
            "flagged_reason": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "gmb_account_id": [
              {
                "comment": "Foreign key to gmb_accounts table",
                "null": true,
                "type": "${uuid}"
              }
            ],
            "google_my_business_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "has_reply": [
              {
                "comment": "Whether the review has a reply",
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "has_response": [
              {
                "comment": "Whether the review has a response",
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "internal_notes": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "is_anonymized": [
              {
                "comment": "Personal data has been anonymized",
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "is_archived": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "is_verified_purchase": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "rating": [
              {
                "null": false,
                "type": "${integer}"
              }
            ],
            "replied_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "reply_date": [
              {
                "comment": "Date the reply was created",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "reply_text": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "reply_timestamp": [
              {
                "comment": "When the reply was posted to Google",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "responded_at": [
              {
                "comment": "When the response was created",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "response": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "response_priority": [
              {
                "comment": "Priority level for responding to this review",
                "null": true,
                "type": "${text}"
              }
            ],
            "response_text": [
              {
                "comment": "The response text for the review",
                "null": true,
                "type": "${text}"
              }
            ],
            "review_date": [
              {
                "comment": "Date the review was created",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "review_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "review_reply": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "review_text": [
              {
                "comment": "Review comment text",
                "null": true,
                "type": "${text}"
              }
            ],
            "review_timestamp": [
              {
                "comment": "When the review was posted on Google",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "review_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "reviewer_display_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "reviewer_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "reviewer_profile_photo_url": [
              {
                "comment": "URL to reviewer profile photo from Google",
                "null": true,
                "type": "${text}"
              }
            ],
            "status": [
              {
                "default": "pending",
                "null": true,
                "type": "${text}"
              }
            ],
            "synced_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "tags": [
              {
                "null": true,
                "type": "${sql(\"text[]\")}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "comment": "Foreign key to auth.users table - owner of this review",
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Stores Google My Business reviews with AI analysis and reply management",
          "foreign_key": {
            "gmb_reviews_gmb_account_id_fkey": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_accounts.column.id}"
                ]
              }
            ],
            "gmb_reviews_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "gmb_reviews_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "gmb_reviews_external_uidx": [
              {
                "columns": [
                  "${column.external_review_id}"
                ],
                "unique": true
              }
            ],
            "gmb_reviews_location_idx": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_reviews_account_id": [
              {
                "columns": [
                  "${column.account_id}"
                ]
              }
            ],
            "idx_gmb_reviews_ai_generated_at": [
              {
                "columns": [
                  "${column.ai_generated_at}"
                ]
              }
            ],
            "idx_gmb_reviews_ai_sentiment": [
              {
                "columns": [
                  "${column.ai_sentiment}"
                ]
              }
            ],
            "idx_gmb_reviews_archived": [
              {
                "columns": [
                  "${column.is_archived}",
                  "${column.archived_at}"
                ],
                "where": "(is_archived = true)"
              }
            ],
            "idx_gmb_reviews_auto_reply_status": [
              {
                "columns": [
                  "${column.auto_reply_status}"
                ]
              }
            ],
            "idx_gmb_reviews_created_at": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_reviews_external_id": [
              {
                "columns": [
                  "${column.external_review_id}"
                ]
              }
            ],
            "idx_gmb_reviews_gmb_account": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_reviews_gmb_account_id": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_reviews_has_reply": [
              {
                "columns": [
                  "${column.has_reply}"
                ]
              }
            ],
            "idx_gmb_reviews_loc": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_reviews_location": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_reviews_location_date": [
              {
                "comment": "Optimizes location-specific date queries",
                "on": [
                  {
                    "column": "${column.location_id}"
                  },
                  {
                    "column": "${column.review_date}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_reviews_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_reviews_location_status": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.status}"
                ],
                "where": "(status = ANY (ARRAY['new'::text, 'in_progress'::text]))"
              }
            ],
            "idx_gmb_reviews_pending": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.location_id}"
                ],
                "where": "((review_reply IS NULL) OR (review_reply = ''::text))"
              }
            ],
            "idx_gmb_reviews_pending_auto_reply": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.has_reply}",
                  "${column.auto_reply_status}"
                ],
                "where": "(has_reply = false)"
              }
            ],
            "idx_gmb_reviews_rate": [
              {
                "columns": [
                  "${column.rating}"
                ]
              }
            ],
            "idx_gmb_reviews_rating": [
              {
                "columns": [
                  "${column.rating}"
                ]
              }
            ],
            "idx_gmb_reviews_reply_pending": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.user_id}"
                ],
                "comment": "Optimizes pending reviews count query",
                "where": "((review_reply IS NULL) OR (review_reply = ''::text))"
              }
            ],
            "idx_gmb_reviews_reply_timestamp": [
              {
                "columns": [
                  "${column.reply_timestamp}"
                ]
              }
            ],
            "idx_gmb_reviews_review_date": [
              {
                "comment": "Optimizes date range filtering for dashboard stats",
                "on": [
                  {
                    "column": "${column.review_date}",
                    "desc": true
                  }
                ],
                "where": "(review_date IS NOT NULL)"
              }
            ],
            "idx_gmb_reviews_review_timestamp": [
              {
                "on": [
                  {
                    "column": "${column.review_timestamp}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_reviews_reviewer_name": [
              {
                "columns": [
                  "${column.reviewer_name}"
                ]
              }
            ],
            "idx_gmb_reviews_sentiment": [
              {
                "columns": [
                  "${column.ai_sentiment}"
                ]
              }
            ],
            "idx_gmb_reviews_status": [
              {
                "columns": [
                  "${column.status}"
                ]
              }
            ],
            "idx_gmb_reviews_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_reviews_user_date": [
              {
                "on": [
                  {
                    "column": "${column.user_id}"
                  },
                  {
                    "column": "${column.review_date}",
                    "desc": true
                  },
                  {
                    "column": "${column.location_id}"
                  }
                ]
              }
            ],
            "idx_gmb_reviews_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_reviews_user_location_date": [
              {
                "on": [
                  {
                    "column": "${column.user_id}"
                  },
                  {
                    "column": "${column.location_id}"
                  },
                  {
                    "column": "${column.review_date}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_reviews_user_status": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.status}"
                ],
                "comment": "Optimizes user status filtering"
              }
            ],
            "uidx_gmb_reviews_external": [
              {
                "columns": [
                  "${column.external_review_id}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_reviews_external_review_id_key": [
              {
                "columns": [
                  "${column.external_review_id}"
                ]
              }
            ],
            "gmb_reviews_review_id_key": [
              {
                "columns": [
                  "${column.review_id}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_search_keywords": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "gmb_account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "impressions_count": [
              {
                "comment": "Number of unique users who searched for this keyword in the month",
                "default": 0,
                "null": false,
                "type": "${bigint}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "month_year": [
              {
                "null": false,
                "type": "${date}"
              }
            ],
            "search_keyword": [
              {
                "comment": "The lower-cased search keyword that users used to find the business",
                "null": false,
                "type": "${text}"
              }
            ],
            "synced_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "threshold_value": [
              {
                "null": true,
                "type": "${bigint}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Stores search keyword impressions from Business Profile Performance API",
          "foreign_key": {
            "gmb_search_keywords_gmb_account_id_fkey": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_accounts.column.id}"
                ]
              }
            ],
            "gmb_search_keywords_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "gmb_search_keywords_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "gmb_keywords_loc_month_idx": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.month_year}"
                ]
              }
            ],
            "gmb_keywords_location_month_idx": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.month_year}"
                ]
              }
            ],
            "idx_gmb_search_keywords_account": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_search_keywords_gmb_account_id": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ]
              }
            ],
            "idx_gmb_search_keywords_keyword": [
              {
                "columns": [
                  "${column.search_keyword}"
                ]
              }
            ],
            "idx_gmb_search_keywords_location": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_search_keywords_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_gmb_search_keywords_month": [
              {
                "on": [
                  {
                    "column": "${column.month_year}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_gmb_search_keywords_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_gmb_search_keywords_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "uidx_gmb_keywords_loc_term_month": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.search_keyword}",
                  "${column.month_year}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "gmb_search_keywords_location_id_search_keyword_month_year_key": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.search_keyword}",
                  "${column.month_year}"
                ]
              }
            ]
          }
        }
      ],
      "gmb_sync_logs": [
        {
          "column": {
            "counts": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "duration_ms": [
              {
                "null": true,
                "type": "${integer}"
              }
            ],
            "ended_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "error": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "gmb_account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "phase": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "started_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "status": [
              {
                "default": "started",
                "null": false,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "gmb_sync_logs_gmb_account_id_fkey": [
              {
                "columns": [
                  "${column.gmb_account_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_accounts.column.id}"
                ]
              }
            ],
            "gmb_sync_logs_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_gmb_sync_logs_account_phase": [
              {
                "columns": [
                  "${column.gmb_account_id}",
                  "${column.phase}"
                ]
              }
            ],
            "idx_gmb_sync_logs_account_time": [
              {
                "on": [
                  {
                    "column": "${column.gmb_account_id}"
                  },
                  {
                    "column": "${column.started_at}",
                    "desc": true
                  }
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "identities": [
        {
          "column": {
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "email": [
              {
                "as": [
                  {
                    "expr": "lower((identity_data ->> 'email'::text))",
                    "type": "${STORED}"
                  }
                ],
                "comment": "Auth: Email is a generated column that references the optional email property in the identity_data",
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "identity_data": [
              {
                "null": false,
                "type": "${jsonb}"
              }
            ],
            "last_sign_in_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "provider": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "provider_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Auth: Stores identities associated to a user.",
          "foreign_key": {
            "identities_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "identities_email_idx": [
              {
                "comment": "Auth: Ensures indexed queries on the email column",
                "on": [
                  {
                    "column": "${column.email}",
                    "ops": "${text_pattern_ops}"
                  }
                ]
              }
            ],
            "identities_user_id_idx": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}",
          "unique": {
            "identities_provider_id_provider_unique": [
              {
                "columns": [
                  "${column.provider_id}",
                  "${column.provider}"
                ]
              }
            ]
          }
        }
      ],
      "instances": [
        {
          "column": {
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "raw_base_config": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "uuid": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Auth: Manages users across multiple sites.",
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "jobs_log": [
        {
          "column": {
            "error": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "finished_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${bigserial}"
              }
            ],
            "meta": [
              {
                "default": "{}",
                "null": false,
                "type": "${jsonb}"
              }
            ],
            "source": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "started_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "status": [
              {
                "default": "running",
                "null": false,
                "type": "${text}"
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "keyword_rankings": [
        {
          "check": {
            "keyword_rankings_competition_check": [
              {
                "expr": "(competition = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text]))"
              }
            ],
            "keyword_rankings_search_type_check": [
              {
                "expr": "(search_type = ANY (ARRAY['organic'::text, 'local_pack'::text, 'maps'::text]))"
              }
            ]
          },
          "column": {
            "competition": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "date": [
              {
                "default": "${sql(\"CURRENT_DATE\")}",
                "null": false,
                "type": "${date}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "keyword": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "location_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "position": [
              {
                "default": 0,
                "null": false,
                "type": "${integer}"
              }
            ],
            "previous_position": [
              {
                "null": true,
                "type": "${integer}"
              }
            ],
            "search_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "search_volume": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "url": [
              {
                "null": true,
                "type": "${text}"
              }
            ]
          },
          "foreign_key": {
            "keyword_rankings_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_keyword_rankings_date": [
              {
                "columns": [
                  "${column.date}"
                ]
              }
            ],
            "idx_keyword_rankings_keyword": [
              {
                "columns": [
                  "${column.keyword}"
                ]
              }
            ],
            "idx_keyword_rankings_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "keyword_rankings_location_id_keyword_search_type_date_key": [
              {
                "columns": [
                  "${column.location_id}",
                  "${column.keyword}",
                  "${column.search_type}",
                  "${column.date}"
                ]
              }
            ]
          }
        }
      ],
      "messages": [
        {
          "column": {
            "event": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "extension": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "inserted_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestamp}"
              }
            ],
            "payload": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "private": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "topic": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestamp}"
              }
            ]
          },
          "index": {
            "messages_inserted_at_topic_index": [
              {
                "on": [
                  {
                    "column": "${column.inserted_at}",
                    "desc": true
                  },
                  {
                    "column": "${column.topic}"
                  }
                ],
                "where": "((extension = 'broadcast'::text) AND (private IS TRUE))"
              }
            ]
          },
          "partition": [
            {
              "columns": [
                "${column.inserted_at}"
              ],
              "type": "${RANGE}"
            }
          ],
          "primary_key": [
            {
              "columns": [
                "${column.id}",
                "${column.inserted_at}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.realtime}"
        }
      ],
      "mfa_amr_claims": [
        {
          "column": {
            "authentication_method": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "session_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "updated_at": [
              {
                "null": false,
                "type": "${timestampz}"
              }
            ]
          },
          "comment": "auth: stores authenticator method reference claims for multi factor authentication",
          "foreign_key": {
            "mfa_amr_claims_session_id_fkey": [
              {
                "columns": [
                  "${column.session_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.sessions.column.id}"
                ]
              }
            ]
          },
          "primary_key": {
            "amr_id_pk": [
              {
                "columns": [
                  "${column.id}"
                ]
              }
            ]
          },
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}",
          "unique": {
            "mfa_amr_claims_session_id_authentication_method_pkey": [
              {
                "columns": [
                  "${column.session_id}",
                  "${column.authentication_method}"
                ]
              }
            ]
          }
        }
      ],
      "mfa_challenges": [
        {
          "column": {
            "created_at": [
              {
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "factor_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "ip_address": [
              {
                "null": false,
                "type": "${inet}"
              }
            ],
            "otp_code": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "verified_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "web_authn_session_data": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ]
          },
          "comment": "auth: stores metadata about challenge requests made",
          "foreign_key": {
            "mfa_challenges_auth_factor_id_fkey": [
              {
                "columns": [
                  "${column.factor_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.mfa_factors.column.id}"
                ]
              }
            ]
          },
          "index": {
            "mfa_challenge_created_at_idx": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "mfa_factors": [
        {
          "column": {
            "created_at": [
              {
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "factor_type": [
              {
                "null": false,
                "type": "${enum.factor_type}"
              }
            ],
            "friendly_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "last_challenged_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "last_webauthn_challenge_data": [
              {
                "comment": "Stores the latest WebAuthn challenge data including attestation/assertion for customer verification",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "phone": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "secret": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "status": [
              {
                "null": false,
                "type": "${enum.factor_status}"
              }
            ],
            "updated_at": [
              {
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "web_authn_aaguid": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "web_authn_credential": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ]
          },
          "comment": "auth: stores metadata about factors",
          "foreign_key": {
            "mfa_factors_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "factor_id_created_at_idx": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.created_at}"
                ]
              }
            ],
            "mfa_factors_user_friendly_name_unique": [
              {
                "columns": [
                  "${column.friendly_name}",
                  "${column.user_id}"
                ],
                "unique": true,
                "where": "(TRIM(BOTH FROM friendly_name) <> ''::text)"
              }
            ],
            "mfa_factors_user_id_idx": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "unique_phone_factor_per_user": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.phone}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}",
          "unique": {
            "mfa_factors_last_challenged_at_key": [
              {
                "columns": [
                  "${column.last_challenged_at}"
                ]
              }
            ]
          }
        }
      ],
      "migrations": [
        {
          "column": {
            "executed_at": [
              {
                "default": "${sql(\"CURRENT_TIMESTAMP\")}",
                "null": true,
                "type": "${timestamp}"
              }
            ],
            "hash": [
              {
                "null": false,
                "type": "${character_varying(40)}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${integer}"
              }
            ],
            "name": [
              {
                "null": false,
                "type": "${character_varying(100)}"
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.storage}",
          "unique": {
            "migrations_name_key": [
              {
                "columns": [
                  "${column.name}"
                ]
              }
            ]
          }
        }
      ],
      "notifications": [
        {
          "check": {
            "notifications_type_check": [
              {
                "expr": "(type = ANY (ARRAY['review'::text, 'sync'::text, 'error'::text, 'info'::text, 'success'::text, 'warning'::text]))"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "link": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "message": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "read": [
              {
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "title": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "notifications_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_notifications_created_at": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_notifications_read": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.read}"
                ]
              }
            ],
            "idx_notifications_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "oauth_authorizations": [
        {
          "check": {
            "oauth_authorizations_authorization_code_length": [
              {
                "expr": "(char_length(authorization_code) <= 255)"
              }
            ],
            "oauth_authorizations_code_challenge_length": [
              {
                "expr": "(char_length(code_challenge) <= 128)"
              }
            ],
            "oauth_authorizations_expires_at_future": [
              {
                "expr": "(expires_at > created_at)"
              }
            ],
            "oauth_authorizations_redirect_uri_length": [
              {
                "expr": "(char_length(redirect_uri) <= 2048)"
              }
            ],
            "oauth_authorizations_resource_length": [
              {
                "expr": "(char_length(resource) <= 2048)"
              }
            ],
            "oauth_authorizations_scope_length": [
              {
                "expr": "(char_length(scope) <= 4096)"
              }
            ],
            "oauth_authorizations_state_length": [
              {
                "expr": "(char_length(state) <= 4096)"
              }
            ]
          },
          "column": {
            "approved_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "authorization_code": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "authorization_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "client_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "code_challenge": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "code_challenge_method": [
              {
                "null": true,
                "type": "${enum.code_challenge_method}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "expires_at": [
              {
                "default": "${sql(\"(now() + '00:03:00'::interval)\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "redirect_uri": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "resource": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "response_type": [
              {
                "default": "code",
                "null": false,
                "type": "${enum.oauth_response_type}"
              }
            ],
            "scope": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "state": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "status": [
              {
                "default": "pending",
                "null": false,
                "type": "${enum.oauth_authorization_status}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "oauth_authorizations_client_id_fkey": [
              {
                "columns": [
                  "${column.client_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.oauth_clients.column.id}"
                ]
              }
            ],
            "oauth_authorizations_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "oauth_auth_pending_exp_idx": [
              {
                "columns": [
                  "${column.expires_at}"
                ],
                "where": "(status = 'pending'::auth.oauth_authorization_status)"
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "schema": "${schema.auth}",
          "unique": {
            "oauth_authorizations_authorization_code_key": [
              {
                "columns": [
                  "${column.authorization_code}"
                ]
              }
            ],
            "oauth_authorizations_authorization_id_key": [
              {
                "columns": [
                  "${column.authorization_id}"
                ]
              }
            ]
          }
        }
      ],
      "oauth_clients": [
        {
          "check": {
            "oauth_clients_client_name_length": [
              {
                "expr": "(char_length(client_name) <= 1024)"
              }
            ],
            "oauth_clients_client_uri_length": [
              {
                "expr": "(char_length(client_uri) <= 2048)"
              }
            ],
            "oauth_clients_logo_uri_length": [
              {
                "expr": "(char_length(logo_uri) <= 2048)"
              }
            ]
          },
          "column": {
            "client_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "client_secret_hash": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "client_type": [
              {
                "default": "confidential",
                "null": false,
                "type": "${enum.oauth_client_type}"
              }
            ],
            "client_uri": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "deleted_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "grant_types": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "logo_uri": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "redirect_uris": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "registration_type": [
              {
                "null": false,
                "type": "${enum.oauth_registration_type}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ]
          },
          "index": {
            "oauth_clients_deleted_at_idx": [
              {
                "columns": [
                  "${column.deleted_at}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "oauth_consents": [
        {
          "check": {
            "oauth_consents_revoked_after_granted": [
              {
                "expr": "((revoked_at IS NULL) OR (revoked_at >= granted_at))"
              }
            ],
            "oauth_consents_scopes_length": [
              {
                "expr": "(char_length(scopes) <= 2048)"
              }
            ],
            "oauth_consents_scopes_not_empty": [
              {
                "expr": "(char_length(TRIM(BOTH FROM scopes)) > 0)"
              }
            ]
          },
          "column": {
            "client_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "granted_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "revoked_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "scopes": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "oauth_consents_client_id_fkey": [
              {
                "columns": [
                  "${column.client_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.oauth_clients.column.id}"
                ]
              }
            ],
            "oauth_consents_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "oauth_consents_active_client_idx": [
              {
                "columns": [
                  "${column.client_id}"
                ],
                "where": "(revoked_at IS NULL)"
              }
            ],
            "oauth_consents_active_user_client_idx": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.client_id}"
                ],
                "where": "(revoked_at IS NULL)"
              }
            ],
            "oauth_consents_user_order_idx": [
              {
                "on": [
                  {
                    "column": "${column.user_id}"
                  },
                  {
                    "column": "${column.granted_at}",
                    "desc": true
                  }
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "schema": "${schema.auth}",
          "unique": {
            "oauth_consents_user_client_unique": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.client_id}"
                ]
              }
            ]
          }
        }
      ],
      "oauth_events": [
        {
          "check": {
            "oauth_events_event_type_check": [
              {
                "expr": "(event_type = ANY (ARRAY['login'::text, 'link'::text, 'error'::text]))"
              }
            ],
            "oauth_events_status_check": [
              {
                "expr": "(status = ANY (ARRAY['success'::text, 'failure'::text]))"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "event_type": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "provider": [
              {
                "default": "google",
                "null": false,
                "type": "${text}"
              }
            ],
            "reason": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "status": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "fk_oauth_events_user": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_oauth_events_user_created": [
              {
                "on": [
                  {
                    "column": "${column.user_id}"
                  },
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_oauth_events_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "oauth_states": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "expires_at": [
              {
                "comment": "When this state expires (typically 30 minutes)",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "state": [
              {
                "comment": "Unique random state parameter for OAuth security",
                "null": false,
                "type": "${text}"
              }
            ],
            "used": [
              {
                "comment": "Whether this state has been used in the callback",
                "default": false,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "user_id": [
              {
                "comment": "Reference to the user initiating the OAuth flow",
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Stores temporary OAuth state parameters for secure OAuth flow",
          "foreign_key": {
            "oauth_states_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_oauth_states_expires_at": [
              {
                "columns": [
                  "${column.expires_at}"
                ]
              }
            ],
            "idx_oauth_states_state": [
              {
                "columns": [
                  "${column.state}"
                ]
              }
            ],
            "idx_oauth_states_used": [
              {
                "columns": [
                  "${column.used}"
                ]
              }
            ],
            "idx_oauth_states_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "oauth_states_state_key": [
              {
                "columns": [
                  "${column.state}"
                ]
              }
            ]
          }
        }
      ],
      "objects": [
        {
          "column": {
            "bucket_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "last_accessed_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "level": [
              {
                "null": true,
                "type": "${integer}"
              }
            ],
            "metadata": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "owner": [
              {
                "comment": "Field is deprecated, use owner_id instead",
                "null": true,
                "type": "${uuid}"
              }
            ],
            "owner_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "path_tokens": [
              {
                "as": [
                  {
                    "expr": "string_to_array(name, '/'::text)",
                    "type": "${STORED}"
                  }
                ],
                "null": true,
                "type": "${sql(\"text[]\")}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_metadata": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "version": [
              {
                "null": true,
                "type": "${text}"
              }
            ]
          },
          "foreign_key": {
            "objects_bucketId_fkey": [
              {
                "columns": [
                  "${column.bucket_id}"
                ],
                "on_delete": "${NO_ACTION}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.buckets.column.id}"
                ]
              }
            ]
          },
          "index": {
            "bucketid_objname": [
              {
                "columns": [
                  "${column.bucket_id}",
                  "${column.name}"
                ],
                "unique": true
              }
            ],
            "idx_name_bucket_level_unique": [
              {
                "columns": [
                  "${column.name}",
                  "${column.bucket_id}",
                  "${column.level}"
                ],
                "unique": true
              }
            ],
            "idx_objects_bucket_id_name": [
              {
                "columns": [
                  "${column.bucket_id}",
                  "${column.name}"
                ]
              }
            ],
            "idx_objects_lower_name": [
              {
                "on": [
                  {
                    "expr": "(path_tokens[level])"
                  },
                  {
                    "expr": "lower(name)",
                    "ops": "${text_pattern_ops}"
                  },
                  {
                    "column": "${column.bucket_id}"
                  },
                  {
                    "column": "${column.level}"
                  }
                ]
              }
            ],
            "name_prefix_search": [
              {
                "on": [
                  {
                    "column": "${column.name}",
                    "ops": "${text_pattern_ops}"
                  }
                ]
              }
            ],
            "objects_bucket_id_level_idx": [
              {
                "columns": [
                  "${column.bucket_id}",
                  "${column.level}",
                  "${column.name}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "one_time_tokens": [
        {
          "check": {
            "one_time_tokens_token_hash_check": [
              {
                "expr": "(char_length(token_hash) > 0)"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestamp}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "relates_to": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "token_hash": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "token_type": [
              {
                "null": false,
                "type": "${enum.one_time_token_type}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestamp}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "one_time_tokens_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "one_time_tokens_relates_to_hash_idx": [
              {
                "columns": [
                  "${column.relates_to}"
                ],
                "type": "${HASH}"
              }
            ],
            "one_time_tokens_token_hash_hash_idx": [
              {
                "columns": [
                  "${column.token_hash}"
                ],
                "type": "${HASH}"
              }
            ],
            "one_time_tokens_user_id_token_type_key": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.token_type}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "performance_metrics": [
        {
          "check": {
            "performance_metrics_unit_check": [
              {
                "expr": "(unit = ANY (ARRAY['ms'::text, 'bytes'::text, 'count'::text]))"
              }
            ]
          },
          "column": {
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "name": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "timestamp": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "unit": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "value": [
              {
                "null": false,
                "type": "${numeric}"
              }
            ]
          },
          "foreign_key": {
            "performance_metrics_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_performance_metrics_name": [
              {
                "columns": [
                  "${column.name}"
                ]
              }
            ],
            "idx_performance_metrics_timestamp": [
              {
                "columns": [
                  "${column.timestamp}"
                ]
              }
            ],
            "idx_performance_metrics_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "prefixes": [
        {
          "column": {
            "bucket_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "level": [
              {
                "as": [
                  {
                    "expr": "storage.get_level(name)",
                    "type": "${STORED}"
                  }
                ],
                "null": false,
                "type": "${integer}"
              }
            ],
            "name": [
              {
                "collate": "C",
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "depends_on": [
            "${function.get_level}"
          ],
          "foreign_key": {
            "prefixes_bucketId_fkey": [
              {
                "columns": [
                  "${column.bucket_id}"
                ],
                "on_delete": "${NO_ACTION}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.buckets.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_prefixes_lower_name": [
              {
                "on": [
                  {
                    "column": "${column.bucket_id}"
                  },
                  {
                    "column": "${column.level}"
                  },
                  {
                    "expr": "((string_to_array(name, '/'::text))[level])"
                  },
                  {
                    "expr": "lower(name)",
                    "ops": "${text_pattern_ops}"
                  }
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.bucket_id}",
                "${column.level}",
                "${column.name}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "profiles": [
        {
          "column": {
            "avatar_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "email": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "full_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "last_login": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "phone": [
              {
                "comment": "User phone number (from auth.users.phone)",
                "null": true,
                "type": "${text}"
              }
            ],
            "provider_sub": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "fk_user": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.public.users.column.id}"
                ]
              }
            ],
            "profiles_user_id_fkey_auth_users": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${SET_NULL}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_profiles_id": [
              {
                "columns": [
                  "${column.id}"
                ]
              }
            ],
            "idx_profiles_phone": [
              {
                "columns": [
                  "${column.phone}"
                ],
                "where": "(phone IS NOT NULL)"
              }
            ],
            "idx_profiles_provider_sub": [
              {
                "columns": [
                  "${column.provider_sub}"
                ]
              }
            ],
            "idx_profiles_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "profiles_email_key": [
              {
                "columns": [
                  "${column.email}"
                ]
              }
            ]
          }
        }
      ],
      "public": {
        "users": [
          {
            "column": {
              "avatar": [
                {
                  "null": true,
                  "type": "${text}"
                }
              ],
              "created_at": [
                {
                  "default": "${sql(\"now()\")}",
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "email": [
                {
                  "null": false,
                  "type": "${text}"
                }
              ],
              "google_id": [
                {
                  "null": true,
                  "type": "${text}"
                }
              ],
              "id": [
                {
                  "default": "${sql(\"gen_random_uuid()\")}",
                  "null": false,
                  "type": "${uuid}"
                }
              ],
              "last_login": [
                {
                  "default": "${sql(\"now()\")}",
                  "null": true,
                  "type": "${timestampz}"
                }
              ],
              "name": [
                {
                  "null": true,
                  "type": "${text}"
                }
              ],
              "role": [
                {
                  "default": "user",
                  "null": true,
                  "type": "${text}"
                }
              ],
              "status": [
                {
                  "default": "active",
                  "null": true,
                  "type": "${text}"
                }
              ],
              "updated_at": [
                {
                  "default": "${sql(\"now()\")}",
                  "null": true,
                  "type": "${timestampz}"
                }
              ]
            },
            "index": {
              "idx_public_users_id": [
                {
                  "columns": [
                    "${column.id}"
                  ]
                }
              ]
            },
            "primary_key": [
              {
                "columns": [
                  "${column.id}"
                ]
              }
            ],
            "row_security": [
              {
                "enabled": true
              }
            ],
            "schema": "${schema.public}",
            "unique": {
              "users_email_key": [
                {
                  "columns": [
                    "${column.email}"
                  ]
                }
              ],
              "users_google_id_key": [
                {
                  "columns": [
                    "${column.google_id}"
                  ]
                }
              ]
            }
          }
        ]
      },
      "question_templates": [
        {
          "column": {
            "category": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "question_pattern": [
              {
                "comment": "Pattern to match questions (e.g., \"what are your hours\")",
                "null": false,
                "type": "${text}"
              }
            ],
            "template_answer": [
              {
                "comment": "Template answer for matching questions",
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "usage_count": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "FAQ library for common question templates",
          "foreign_key": {
            "question_templates_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_question_templates_category": [
              {
                "columns": [
                  "${column.category}"
                ]
              }
            ],
            "idx_question_templates_usage": [
              {
                "on": [
                  {
                    "column": "${column.usage_count}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_question_templates_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "rate_limit_requests": [
        {
          "column": {
            "action": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "rate_limit_requests_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_rate_limit_created_at": [
              {
                "columns": [
                  "${column.created_at}"
                ]
              }
            ],
            "idx_rate_limit_user_action_time": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.action}",
                  "${column.created_at}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "realtime": {
        "schema_migrations": [
          {
            "column": {
              "inserted_at": [
                {
                  "null": true,
                  "type": "${timestamp(0)}"
                }
              ],
              "version": [
                {
                  "null": false,
                  "type": "${bigint}"
                }
              ]
            },
            "primary_key": [
              {
                "columns": [
                  "${column.version}"
                ]
              }
            ],
            "schema": "${schema.realtime}"
          }
        ]
      },
      "refresh_tokens": [
        {
          "column": {
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${bigserial}"
              }
            ],
            "instance_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "parent": [
              {
                "null": true,
                "type": "${character_varying(255)}"
              }
            ],
            "revoked": [
              {
                "null": true,
                "type": "${boolean}"
              }
            ],
            "session_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "token": [
              {
                "null": true,
                "type": "${character_varying(255)}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${character_varying(255)}"
              }
            ]
          },
          "comment": "Auth: Store of tokens used to refresh JWT tokens once they expire.",
          "foreign_key": {
            "refresh_tokens_session_id_fkey": [
              {
                "columns": [
                  "${column.session_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.sessions.column.id}"
                ]
              }
            ]
          },
          "index": {
            "refresh_tokens_instance_id_idx": [
              {
                "columns": [
                  "${column.instance_id}"
                ]
              }
            ],
            "refresh_tokens_instance_id_user_id_idx": [
              {
                "columns": [
                  "${column.instance_id}",
                  "${column.user_id}"
                ]
              }
            ],
            "refresh_tokens_parent_idx": [
              {
                "columns": [
                  "${column.parent}"
                ]
              }
            ],
            "refresh_tokens_session_id_revoked_idx": [
              {
                "columns": [
                  "${column.session_id}",
                  "${column.revoked}"
                ]
              }
            ],
            "refresh_tokens_updated_at_idx": [
              {
                "on": [
                  {
                    "column": "${column.updated_at}",
                    "desc": true
                  }
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}",
          "unique": {
            "refresh_tokens_token_unique": [
              {
                "columns": [
                  "${column.token}"
                ]
              }
            ]
          }
        }
      ],
      "review_activity_log": [
        {
          "column": {
            "action": [
              {
                "null": false,
                "type": "${character_varying(50)}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "details": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"extensions.uuid_generate_v4()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "review_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "review_activity_log_review_id_fkey": [
              {
                "columns": [
                  "${column.review_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_reviews.column.id}"
                ]
              }
            ],
            "review_activity_log_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_review_activity_log_action": [
              {
                "columns": [
                  "${column.action}"
                ]
              }
            ],
            "idx_review_activity_log_created_at": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_review_activity_log_review_id": [
              {
                "columns": [
                  "${column.review_id}"
                ]
              }
            ],
            "idx_review_activity_log_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "review_ai_analysis": [
        {
          "check": {
            "review_ai_analysis_sentiment_check": [
              {
                "expr": "((sentiment)::text = ANY ((ARRAY['positive'::character varying, 'neutral'::character varying, 'negative'::character varying])::text[]))"
              }
            ]
          },
          "column": {
            "ai_suggested_response": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "analyzed_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"extensions.uuid_generate_v4()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "keywords": [
              {
                "null": true,
                "type": "${sql(\"text[]\")}"
              }
            ],
            "review_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "sentiment": [
              {
                "null": true,
                "type": "${character_varying(20)}"
              }
            ],
            "sentiment_score": [
              {
                "null": true,
                "type": "${numeric(3,2)}"
              }
            ]
          },
          "comment": "AI analysis data for reviews including sentiment and keywords",
          "foreign_key": {
            "review_ai_analysis_review_id_fkey": [
              {
                "columns": [
                  "${column.review_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_reviews.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_review_ai_analysis_review_id": [
              {
                "columns": [
                  "${column.review_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "room_members": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "room_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "fk_room_members_user": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_room_members_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_room_members_user_room": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.room_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.user_id}",
                "${column.room_id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "s3_multipart_uploads": [
        {
          "column": {
            "bucket_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "in_progress_size": [
              {
                "default": 0,
                "null": false,
                "type": "${bigint}"
              }
            ],
            "key": [
              {
                "collate": "C",
                "null": false,
                "type": "${text}"
              }
            ],
            "owner_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "upload_signature": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "user_metadata": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "version": [
              {
                "null": false,
                "type": "${text}"
              }
            ]
          },
          "foreign_key": {
            "s3_multipart_uploads_bucket_id_fkey": [
              {
                "columns": [
                  "${column.bucket_id}"
                ],
                "on_delete": "${NO_ACTION}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.buckets.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_multipart_uploads_list": [
              {
                "columns": [
                  "${column.bucket_id}",
                  "${column.key}",
                  "${column.created_at}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "s3_multipart_uploads_parts": [
        {
          "column": {
            "bucket_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "etag": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "key": [
              {
                "collate": "C",
                "null": false,
                "type": "${text}"
              }
            ],
            "owner_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "part_number": [
              {
                "null": false,
                "type": "${integer}"
              }
            ],
            "size": [
              {
                "default": 0,
                "null": false,
                "type": "${bigint}"
              }
            ],
            "upload_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "version": [
              {
                "null": false,
                "type": "${text}"
              }
            ]
          },
          "foreign_key": {
            "s3_multipart_uploads_parts_bucket_id_fkey": [
              {
                "columns": [
                  "${column.bucket_id}"
                ],
                "on_delete": "${NO_ACTION}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.buckets.column.id}"
                ]
              }
            ],
            "s3_multipart_uploads_parts_upload_id_fkey": [
              {
                "columns": [
                  "${column.upload_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.s3_multipart_uploads.column.id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.storage}"
        }
      ],
      "saml_providers": [
        {
          "check": {
            "entity_id not empty": [
              {
                "expr": "(char_length(entity_id) > 0)"
              }
            ],
            "metadata_url not empty": [
              {
                "expr": "((metadata_url = NULL::text) OR (char_length(metadata_url) > 0))"
              }
            ],
            "metadata_xml not empty": [
              {
                "expr": "(char_length(metadata_xml) > 0)"
              }
            ]
          },
          "column": {
            "attribute_mapping": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "entity_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "metadata_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "metadata_xml": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "name_id_format": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "sso_provider_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "comment": "Auth: Manages SAML Identity Provider connections.",
          "foreign_key": {
            "saml_providers_sso_provider_id_fkey": [
              {
                "columns": [
                  "${column.sso_provider_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.sso_providers.column.id}"
                ]
              }
            ]
          },
          "index": {
            "saml_providers_sso_provider_id_idx": [
              {
                "columns": [
                  "${column.sso_provider_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}",
          "unique": {
            "saml_providers_entity_id_key": [
              {
                "columns": [
                  "${column.entity_id}"
                ]
              }
            ]
          }
        }
      ],
      "saml_relay_states": [
        {
          "check": {
            "request_id not empty": [
              {
                "expr": "(char_length(request_id) > 0)"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "flow_state_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "for_email": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "redirect_to": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "request_id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "sso_provider_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "comment": "Auth: Contains SAML Relay State information for each Service Provider initiated login.",
          "foreign_key": {
            "saml_relay_states_flow_state_id_fkey": [
              {
                "columns": [
                  "${column.flow_state_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.flow_state.column.id}"
                ]
              }
            ],
            "saml_relay_states_sso_provider_id_fkey": [
              {
                "columns": [
                  "${column.sso_provider_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.sso_providers.column.id}"
                ]
              }
            ]
          },
          "index": {
            "saml_relay_states_created_at_idx": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "saml_relay_states_for_email_idx": [
              {
                "columns": [
                  "${column.for_email}"
                ]
              }
            ],
            "saml_relay_states_sso_provider_id_idx": [
              {
                "columns": [
                  "${column.sso_provider_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "secret_keys": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "key": [
              {
                "null": false,
                "type": "${bytea}"
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "security_logs": [
        {
          "check": {
            "security_logs_severity_check": [
              {
                "expr": "(severity = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text]))"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "details": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "event": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "severity": [
              {
                "default": "medium",
                "null": false,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "security_logs_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_security_logs_created_at": [
              {
                "columns": [
                  "${column.created_at}"
                ]
              }
            ],
            "idx_security_logs_event": [
              {
                "columns": [
                  "${column.event}"
                ]
              }
            ],
            "idx_security_logs_severity": [
              {
                "columns": [
                  "${column.severity}"
                ]
              }
            ],
            "idx_security_logs_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "seed_files": [
        {
          "column": {
            "hash": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "path": [
              {
                "null": false,
                "type": "${text}"
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.path}"
              ]
            }
          ],
          "schema": "${schema.supabase_migrations}"
        }
      ],
      "sessions": [
        {
          "column": {
            "aal": [
              {
                "null": true,
                "type": "${enum.aal_level}"
              }
            ],
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "factor_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "ip": [
              {
                "null": true,
                "type": "${inet}"
              }
            ],
            "not_after": [
              {
                "comment": "Auth: Not after is a nullable column that contains a timestamp after which the session should be regarded as expired.",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "oauth_client_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "refresh_token_counter": [
              {
                "comment": "Holds the ID (counter) of the last issued refresh token.",
                "null": true,
                "type": "${bigint}"
              }
            ],
            "refresh_token_hmac_key": [
              {
                "comment": "Holds a HMAC-SHA256 key used to sign refresh tokens for this session.",
                "null": true,
                "type": "${text}"
              }
            ],
            "refreshed_at": [
              {
                "null": true,
                "type": "${timestamp}"
              }
            ],
            "tag": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_agent": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Auth: Stores session data associated to a user.",
          "foreign_key": {
            "sessions_oauth_client_id_fkey": [
              {
                "columns": [
                  "${column.oauth_client_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.oauth_clients.column.id}"
                ]
              }
            ],
            "sessions_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "sessions_not_after_idx": [
              {
                "on": [
                  {
                    "column": "${column.not_after}",
                    "desc": true
                  }
                ]
              }
            ],
            "sessions_oauth_client_id_idx": [
              {
                "columns": [
                  "${column.oauth_client_id}"
                ]
              }
            ],
            "sessions_user_id_idx": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "user_id_created_at_idx": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.created_at}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "sso_domains": [
        {
          "check": {
            "domain not empty": [
              {
                "expr": "(char_length(domain) > 0)"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "domain": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "sso_provider_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "comment": "Auth: Manages SSO email address domain mapping to an SSO Identity Provider.",
          "foreign_key": {
            "sso_domains_sso_provider_id_fkey": [
              {
                "columns": [
                  "${column.sso_provider_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.sso_providers.column.id}"
                ]
              }
            ]
          },
          "index": {
            "sso_domains_domain_idx": [
              {
                "on": [
                  {
                    "expr": "lower(domain)"
                  }
                ],
                "unique": true
              }
            ],
            "sso_domains_sso_provider_id_idx": [
              {
                "columns": [
                  "${column.sso_provider_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "sso_providers": [
        {
          "check": {
            "resource_id not empty": [
              {
                "expr": "((resource_id = NULL::text) OR (char_length(resource_id) > 0))"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "disabled": [
              {
                "null": true,
                "type": "${boolean}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "resource_id": [
              {
                "comment": "Auth: Uniquely identifies a SSO provider according to a user-chosen resource ID (case insensitive), useful in infrastructure as code.",
                "null": true,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ]
          },
          "comment": "Auth: Manages SSO identity provider information; see saml_providers for SAML.",
          "index": {
            "sso_providers_resource_id_idx": [
              {
                "on": [
                  {
                    "expr": "lower(resource_id)"
                  }
                ],
                "unique": true
              }
            ],
            "sso_providers_resource_id_pattern_idx": [
              {
                "on": [
                  {
                    "column": "${column.resource_id}",
                    "ops": "${text_pattern_ops}"
                  }
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.auth}"
        }
      ],
      "subscription": [
        {
          "column": {
            "claims": [
              {
                "null": false,
                "type": "${jsonb}"
              }
            ],
            "claims_role": [
              {
                "as": [
                  {
                    "expr": "realtime.to_regrole((claims ->> 'role'::text))",
                    "type": "${STORED}"
                  }
                ],
                "null": false,
                "type": "${regrole}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"timezone('utc'::text, now())\")}",
                "null": false,
                "type": "${timestamp}"
              }
            ],
            "entity": [
              {
                "null": false,
                "type": "${regclass}"
              }
            ],
            "filters": [
              {
                "default": "{}",
                "null": false,
                "type": "${sql(\"realtime.user_defined_filter[]\")}"
              }
            ],
            "id": [
              {
                "identity": [
                  {
                    "generated": "${ALWAYS}"
                  }
                ],
                "null": false,
                "type": "${bigint}"
              }
            ],
            "subscription_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "depends_on": [
            "${function.to_regrole}"
          ],
          "index": {
            "ix_realtime_subscription_entity": [
              {
                "columns": [
                  "${column.entity}"
                ]
              }
            ],
            "subscription_subscription_id_entity_filters_key": [
              {
                "columns": [
                  "${column.subscription_id}",
                  "${column.entity}",
                  "${column.filters}"
                ],
                "unique": true
              }
            ]
          },
          "primary_key": {
            "pk_subscription": [
              {
                "columns": [
                  "${column.id}"
                ]
              }
            ]
          },
          "schema": "${schema.realtime}"
        }
      ],
      "supabase_migrations": {
        "schema_migrations": [
          {
            "column": {
              "created_by": [
                {
                  "null": true,
                  "type": "${text}"
                }
              ],
              "idempotency_key": [
                {
                  "null": true,
                  "type": "${text}"
                }
              ],
              "name": [
                {
                  "null": true,
                  "type": "${text}"
                }
              ],
              "statements": [
                {
                  "null": true,
                  "type": "${sql(\"text[]\")}"
                }
              ],
              "version": [
                {
                  "null": false,
                  "type": "${text}"
                }
              ]
            },
            "primary_key": [
              {
                "columns": [
                  "${column.version}"
                ]
              }
            ],
            "schema": "${schema.supabase_migrations}",
            "unique": {
              "schema_migrations_idempotency_key_key": [
                {
                  "columns": [
                    "${column.idempotency_key}"
                  ]
                }
              ]
            }
          }
        ]
      },
      "sync_results": [
        {
          "column": {
            "account_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "error": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "null": false,
                "type": "${bigserial}"
              }
            ],
            "ok": [
              {
                "null": false,
                "type": "${boolean}"
              }
            ],
            "run_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "status": [
              {
                "null": false,
                "type": "${integer}"
              }
            ]
          },
          "foreign_key": {
            "sync_results_run_id_fkey": [
              {
                "columns": [
                  "${column.run_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.sync_runs.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_sync_results_account": [
              {
                "columns": [
                  "${column.account_id}"
                ]
              }
            ],
            "idx_sync_results_run": [
              {
                "columns": [
                  "${column.run_id}"
                ]
              }
            ],
            "idx_sync_results_run_id": [
              {
                "columns": [
                  "${column.run_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "sync_runs": [
        {
          "column": {
            "batch_size": [
              {
                "default": 0,
                "null": false,
                "type": "${integer}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "finished_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "meta": [
              {
                "default": "{}",
                "null": false,
                "type": "${jsonb}"
              }
            ],
            "next_cursor": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "started_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "status": [
              {
                "default": "running",
                "null": false,
                "type": "${text}"
              }
            ],
            "triggered_by": [
              {
                "null": false,
                "type": "${text}"
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "system_settings": [
        {
          "column": {
            "key": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "value": [
              {
                "null": true,
                "type": "${text}"
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.key}"
              ]
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "team_members": [
        {
          "check": {
            "team_members_role_check": [
              {
                "expr": "(role = ANY (ARRAY['admin'::text, 'manager'::text, 'editor'::text, 'viewer'::text]))"
              }
            ]
          },
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "invited_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "is_active": [
              {
                "default": true,
                "null": true,
                "type": "${boolean}"
              }
            ],
            "joined_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "locations_access": [
              {
                "default": "[]",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "owner_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "permissions": [
              {
                "default": "{}",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "role": [
              {
                "default": "viewer",
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "foreign_key": {
            "team_members_owner_id_fkey": [
              {
                "columns": [
                  "${column.owner_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ],
            "team_members_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.profiles.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_team_members_owner_id": [
              {
                "columns": [
                  "${column.owner_id}"
                ]
              }
            ],
            "idx_team_members_owner_user": [
              {
                "columns": [
                  "${column.owner_id}",
                  "${column.user_id}"
                ]
              }
            ],
            "idx_team_members_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "weekly_task_recommendations": [
        {
          "check": {
            "weekly_task_recommendations_effort_level_check": [
              {
                "expr": "(effort_level = ANY (ARRAY['quick'::text, 'moderate'::text, 'extensive'::text]))"
              }
            ],
            "weekly_task_recommendations_priority_check": [
              {
                "expr": "(priority = ANY (ARRAY['high'::text, 'medium'::text, 'low'::text]))"
              }
            ],
            "weekly_task_recommendations_status_check": [
              {
                "expr": "(status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'completed'::text, 'dismissed'::text]))"
              }
            ]
          },
          "column": {
            "category": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "description": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "effort_level": [
              {
                "default": "moderate",
                "null": true,
                "type": "${text}"
              }
            ],
            "estimated_minutes": [
              {
                "default": 0,
                "null": true,
                "type": "${integer}"
              }
            ],
            "expected_impact": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "insights": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "priority": [
              {
                "default": "medium",
                "null": true,
                "type": "${text}"
              }
            ],
            "reasoning": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "status": [
              {
                "default": "pending",
                "null": true,
                "type": "${text}"
              }
            ],
            "tasks": [
              {
                "default": "[]",
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "title": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ],
            "week_end_date": [
              {
                "null": false,
                "type": "${date}"
              }
            ],
            "week_start_date": [
              {
                "null": false,
                "type": "${date}"
              }
            ]
          },
          "foreign_key": {
            "fk_weekly_task_recommendations_user": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_weekly_task_recommendations_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_weekly_tasks_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_weekly_tasks_user_week_priority": [
              {
                "on": [
                  {
                    "column": "${column.user_id}"
                  },
                  {
                    "column": "${column.week_start_date}",
                    "desc": true
                  },
                  {
                    "column": "${column.priority}"
                  },
                  {
                    "column": "${column.estimated_minutes}"
                  }
                ]
              }
            ],
            "idx_weekly_tasks_user_week_status": [
              {
                "columns": [
                  "${column.user_id}",
                  "${column.week_start_date}",
                  "${column.status}"
                ]
              }
            ],
            "idx_weekly_tasks_week_start": [
              {
                "columns": [
                  "${column.week_start_date}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "weekly_tasks": [
        {
          "check": {
            "weekly_tasks_priority_check": [
              {
                "expr": "(priority = ANY (ARRAY['LOW'::text, 'MEDIUM'::text, 'HIGH'::text]))"
              }
            ],
            "weekly_tasks_task_type_check": [
              {
                "expr": "(task_type = ANY (ARRAY['review_reply'::text, 'question_answer'::text, 'post_create'::text, 'photo_upload'::text, 'custom'::text]))"
              }
            ]
          },
          "column": {
            "completed": [
              {
                "default": false,
                "null": false,
                "type": "${boolean}"
              }
            ],
            "completed_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "description": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "due_date": [
              {
                "null": true,
                "type": "${date}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "location_id": [
              {
                "comment": "Optional location association - null means all locations",
                "null": true,
                "type": "${uuid}"
              }
            ],
            "priority": [
              {
                "default": "MEDIUM",
                "null": false,
                "type": "${text}"
              }
            ],
            "task_type": [
              {
                "comment": "Type of task for categorization and automation",
                "default": "custom",
                "null": false,
                "type": "${text}"
              }
            ],
            "title": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": false,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Weekly tasks for GMB management dashboard",
          "foreign_key": {
            "weekly_tasks_location_id_fkey": [
              {
                "columns": [
                  "${column.location_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.gmb_locations.column.id}"
                ]
              }
            ],
            "weekly_tasks_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_weekly_tasks_completed": [
              {
                "columns": [
                  "${column.completed}"
                ]
              }
            ],
            "idx_weekly_tasks_created_at": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_weekly_tasks_due_date": [
              {
                "columns": [
                  "${column.due_date}"
                ]
              }
            ],
            "idx_weekly_tasks_location_id": [
              {
                "columns": [
                  "${column.location_id}"
                ]
              }
            ],
            "idx_weekly_tasks_priority": [
              {
                "columns": [
                  "${column.priority}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "youtube_drafts": [
        {
          "column": {
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "description": [
              {
                "comment": "Video description",
                "null": true,
                "type": "${text}"
              }
            ],
            "hashtags": [
              {
                "comment": "Comma-separated hashtags",
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "title": [
              {
                "comment": "Video title",
                "null": false,
                "type": "${text}"
              }
            ],
            "user_id": [
              {
                "null": false,
                "type": "${uuid}"
              }
            ]
          },
          "comment": "Stores YouTube composer drafts",
          "foreign_key": {
            "youtube_drafts_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_youtube_drafts_created_at": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_youtube_drafts_user": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_youtube_drafts_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}"
        }
      ],
      "youtube_videos": [
        {
          "check": {
            "youtube_videos_privacy_status_check": [
              {
                "expr": "(privacy_status = ANY (ARRAY['private'::text, 'unlisted'::text, 'public'::text]))"
              }
            ]
          },
          "column": {
            "category": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "description": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "id": [
              {
                "default": "${sql(\"gen_random_uuid()\")}",
                "null": false,
                "type": "${uuid}"
              }
            ],
            "language": [
              {
                "default": "en",
                "null": true,
                "type": "${text}"
              }
            ],
            "privacy_status": [
              {
                "comment": "Video privacy status: private, unlisted, or public",
                "default": "private",
                "null": true,
                "type": "${text}"
              }
            ],
            "published_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "tags": [
              {
                "comment": "Array of video tags",
                "default": "{}",
                "null": true,
                "type": "${sql(\"text[]\")}"
              }
            ],
            "thumbnail_url": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "title": [
              {
                "null": false,
                "type": "${text}"
              }
            ],
            "updated_at": [
              {
                "default": "${sql(\"now()\")}",
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "video_id": [
              {
                "comment": "YouTube video ID (unique identifier from YouTube)",
                "null": false,
                "type": "${text}"
              }
            ]
          },
          "comment": "Stores metadata for uploaded YouTube videos",
          "foreign_key": {
            "youtube_videos_user_id_fkey": [
              {
                "columns": [
                  "${column.user_id}"
                ],
                "on_delete": "${CASCADE}",
                "on_update": "${NO_ACTION}",
                "ref_columns": [
                  "${table.auth.users.column.id}"
                ]
              }
            ]
          },
          "index": {
            "idx_youtube_videos_created_at": [
              {
                "on": [
                  {
                    "column": "${column.created_at}",
                    "desc": true
                  }
                ]
              }
            ],
            "idx_youtube_videos_privacy_status": [
              {
                "columns": [
                  "${column.privacy_status}"
                ]
              }
            ],
            "idx_youtube_videos_user_id": [
              {
                "columns": [
                  "${column.user_id}"
                ]
              }
            ],
            "idx_youtube_videos_video_id": [
              {
                "columns": [
                  "${column.video_id}"
                ]
              }
            ]
          },
          "primary_key": [
            {
              "columns": [
                "${column.id}"
              ]
            }
          ],
          "row_security": [
            {
              "enabled": true
            }
          ],
          "schema": "${schema.public}",
          "unique": {
            "youtube_videos_video_id_key": [
              {
                "columns": [
                  "${column.video_id}"
                ]
              }
            ]
          }
        }
      ]
    },
    "trigger": {
      "auto_reply_queue_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.auto_reply_queue}"
        }
      ],
      "auto_reply_settings_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.auto_reply_settings}"
        }
      ],
      "enforce_bucket_name_length_trigger": [
        {
          "before": [
            {
              "insert": true,
              "update_of": [
                "${table.buckets.column.name}"
              ]
            }
          ],
          "execute": [
            {
              "function": "${function.enforce_bucket_name_length}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.buckets}"
        }
      ],
      "new_review_notification": [
        {
          "after": [
            {
              "insert": true
            }
          ],
          "execute": [
            {
              "function": "${function.notify_new_review}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_reviews}"
        }
      ],
      "objects_delete_delete_prefix": [
        {
          "after": [
            {
              "delete": true
            }
          ],
          "execute": [
            {
              "function": "${function.delete_prefix_hierarchy_trigger}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.objects}"
        }
      ],
      "objects_insert_create_prefix": [
        {
          "before": [
            {
              "insert": true
            }
          ],
          "execute": [
            {
              "function": "${function.objects_insert_prefix_trigger}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.objects}"
        }
      ],
      "objects_update_create_prefix": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.objects_update_prefix_trigger}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.objects}",
          "when": "((new.name <> old.name) OR (new.bucket_id <> old.bucket_id))"
        }
      ],
      "on_auth_user_created": [
        {
          "after": [
            {
              "insert": true
            }
          ],
          "execute": [
            {
              "function": "${function.handle_new_user}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.auth.users}"
        }
      ],
      "prefixes_create_hierarchy": [
        {
          "before": [
            {
              "insert": true
            }
          ],
          "execute": [
            {
              "function": "${function.prefixes_insert_trigger}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.prefixes}",
          "when": "(pg_trigger_depth() < 1)"
        }
      ],
      "prefixes_delete_hierarchy": [
        {
          "after": [
            {
              "delete": true
            }
          ],
          "execute": [
            {
              "function": "${function.delete_prefix_hierarchy_trigger}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.prefixes}"
        }
      ],
      "set_timestamp_on_profiles": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_current_timestamp_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.profiles}"
        }
      ],
      "set_updated_at_trigger": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.ai_autopilot_settings}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.ai_settings}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.autopilot_settings}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.citation_listings}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.citation_sources}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.competitor_tracking}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_citations}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_insights}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_locations}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_rankings}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_reviews}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.keyword_rankings}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.profiles}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.team_members}"
        },
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.public.users}"
        }
      ],
      "tr_check_filters": [
        {
          "before": [
            {
              "insert": true,
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.subscription_check_filters}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.subscription}"
        }
      ],
      "tr_weekly_task_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.set_weekly_task_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.weekly_task_recommendations}"
        }
      ],
      "trigger_update_ai_settings_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.ai_settings}"
        }
      ],
      "trigger_update_autopilot_logs_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.autopilot_logs}"
        }
      ],
      "trigger_update_autopilot_settings_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.autopilot_settings}"
        }
      ],
      "trigger_update_citation_listings_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.citation_listings}"
        }
      ],
      "trigger_update_citation_sources_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.citation_sources}"
        }
      ],
      "trigger_update_competitor_tracking_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.competitor_tracking}"
        }
      ],
      "trigger_update_gmb_reviews_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.update_gmb_reviews_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_reviews}"
        }
      ],
      "trigger_update_last_login": [
        {
          "after": [
            {
              "insert": true,
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.update_last_login}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_accounts}"
        }
      ],
      "trigger_update_location_review_stats_delete": [
        {
          "after": [
            {
              "delete": true
            }
          ],
          "execute": [
            {
              "function": "${function.update_location_review_stats}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_reviews}"
        }
      ],
      "trigger_update_location_review_stats_insert": [
        {
          "after": [
            {
              "insert": true
            }
          ],
          "execute": [
            {
              "function": "${function.update_location_review_stats}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_reviews}"
        }
      ],
      "trigger_update_location_review_stats_update": [
        {
          "after": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.update_location_review_stats}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_reviews}",
          "when": "(old.has_reply IS DISTINCT FROM new.has_reply)"
        }
      ],
      "trigger_update_normalized_location_id": [
        {
          "before": [
            {
              "insert": true,
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.update_normalized_location_id}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.gmb_locations}"
        }
      ],
      "trigger_update_question_templates_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.update_question_templates_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.question_templates}"
        }
      ],
      "trigger_update_weekly_tasks_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.update_weekly_tasks_updated_at}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.weekly_tasks}"
        }
      ],
      "update_objects_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.storage.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.objects}"
        }
      ],
      "update_users_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.moddatetime}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.public.users}"
        }
      ],
      "update_weekly_tasks_updated_at": [
        {
          "before": [
            {
              "update": true
            }
          ],
          "execute": [
            {
              "function": "${function.public.update_updated_at_column}"
            }
          ],
          "for": "${ROW}",
          "on": "${table.weekly_tasks}"
        }
      ]
    },
    "view": {
      "gmb_locations_with_rating": [
        {
          "as": "SELECT l.id,\n    l.gmb_account_id,\n    l.user_id,\n    l.location_id,\n    l.location_name,\n    l.address,\n    l.phone,\n    l.website,\n    l.category,\n    l.is_active,\n    l.metadata,\n    l.business_hours,\n    l.created_at,\n    l.updated_at,\n    l.rating AS stored_rating,\n    l.normalized_location_id,\n    COALESCE(avg(r.rating), 0::numeric)::numeric(3,2) AS calculated_rating,\n    count(r.id)::integer AS reviews_count,\n    max(r.created_at) AS last_review_date\n   FROM public.gmb_locations l\n     LEFT JOIN public.gmb_reviews r ON r.location_id = l.id\n  GROUP BY l.id, l.gmb_account_id, l.user_id, l.location_id, l.location_name, l.address, l.phone, l.website, l.category, l.is_active, l.metadata, l.business_hours, l.created_at, l.updated_at, l.rating, l.normalized_location_id;\n",
          "column": {
            "address": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "business_hours": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "calculated_rating": [
              {
                "null": true,
                "type": "${numeric(3,2)}"
              }
            ],
            "category": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "created_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "gmb_account_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "is_active": [
              {
                "null": true,
                "type": "${boolean}"
              }
            ],
            "last_review_date": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "location_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "location_name": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "metadata": [
              {
                "null": true,
                "type": "${jsonb}"
              }
            ],
            "normalized_location_id": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "phone": [
              {
                "null": true,
                "type": "${text}"
              }
            ],
            "reviews_count": [
              {
                "null": true,
                "type": "${integer}"
              }
            ],
            "stored_rating": [
              {
                "null": true,
                "type": "${numeric(2,1)}"
              }
            ],
            "updated_at": [
              {
                "null": true,
                "type": "${timestampz}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ],
            "website": [
              {
                "null": true,
                "type": "${text}"
              }
            ]
          },
          "depends_on": [
            "${table.gmb_locations}",
            "${table.gmb_reviews}"
          ],
          "schema": "${schema.public}",
          "security": [
            {
              "invoker": true
            }
          ]
        }
      ],
      "review_stats_view": [
        {
          "as": "SELECT l.user_id,\n    count(r.id) AS total_reviews,\n    count(r.id) FILTER (WHERE r.has_reply = false AND r.reply_text IS NULL) AS pending_reviews,\n    count(r.id) FILTER (WHERE r.has_reply = true OR r.reply_text IS NOT NULL) AS responded_reviews,\n        CASE\n            WHEN count(r.id) > 0 THEN round(count(r.id) FILTER (WHERE r.has_reply = true OR r.reply_text IS NOT NULL)::numeric / count(r.id)::numeric * 100::numeric, 1)\n            ELSE 0::numeric\n        END AS response_rate,\n    round(avg(r.rating), 1) AS avg_rating,\n    count(r.id) FILTER (WHERE r.rating >= 4) AS positive_count,\n    count(r.id) FILTER (WHERE r.rating = 3) AS neutral_count,\n    count(r.id) FILTER (WHERE r.rating <= 2) AS negative_count\n   FROM public.gmb_locations l\n     LEFT JOIN public.gmb_reviews r ON l.id = r.location_id\n  GROUP BY l.user_id;\n",
          "column": {
            "avg_rating": [
              {
                "null": true,
                "type": "${numeric}"
              }
            ],
            "negative_count": [
              {
                "null": true,
                "type": "${bigint}"
              }
            ],
            "neutral_count": [
              {
                "null": true,
                "type": "${bigint}"
              }
            ],
            "pending_reviews": [
              {
                "null": true,
                "type": "${bigint}"
              }
            ],
            "positive_count": [
              {
                "null": true,
                "type": "${bigint}"
              }
            ],
            "responded_reviews": [
              {
                "null": true,
                "type": "${bigint}"
              }
            ],
            "response_rate": [
              {
                "null": true,
                "type": "${numeric}"
              }
            ],
            "total_reviews": [
              {
                "null": true,
                "type": "${bigint}"
              }
            ],
            "user_id": [
              {
                "null": true,
                "type": "${uuid}"
              }
            ]
          },
          "depends_on": [
            "${table.gmb_locations}",
            "${table.gmb_reviews}"
          ],
          "schema": "${schema.public}"
        }
      ]
    }
  },
  null
]