# ๐ฑ ุฏููู ุงููุณุชุฎุฏู: ุฅุดุนุงุฑุงุช ูุดุงุทู ุงูุชุฌุงุฑู ูู ุงูููุช ุงููุนูู

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชูุนูู ูุธุงู ุงูุฅุดุนุงุฑุงุช ูู ุงูููุช ุงููุนูู ุจุงุณุชุฎุฏุงู **Google Cloud Pub/Sub** ูุชููู ุฅุดุนุงุฑุงุช ููุฑูุฉ ูู Google My Business ุนูุฏ ุญุฏูุซ ุฃู ุชุญุฏูุซ ููู.

---

## โจ ุงููููุฒุงุช

### โ **ุฅุดุนุงุฑุงุช ููุฑูุฉ**
- ุชููู ุชูุจููุงุช ููุฑูุฉ ุนูุฏ:
  - ุชููููุงุช ุฌุฏูุฏุฉ
  - ุฃุณุฆูุฉ ุฌุฏูุฏุฉ
  - ุชุญุฏูุซุงุช ูู Google
  - ูุณุงุฆุท ุงูุนููุงุก ุงูุฌุฏูุฏุฉ
  - ูุฃูุซุฑ...

### โ **ุชูููู ูุฑู**
- ุงุฎุชุฑ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงูุชู ุชุฑูุฏ ุชููููุง
- ุชูุนูู/ุชุนุทูู ุฃููุงุน ูุญุฏุฏุฉ ุญุณุจ ุงูุญุงุฌุฉ

### โ **ููุซูููุฉ ุนุงููุฉ**
- ุงุณุชุฎุฏุงู Google Pub/Sub ููุชุณููู ุงููุถููู
- ูุง ุญุงุฌุฉ ููุงุณุชุนูุงู ุงููุณุชูุฑ (Polling)
- ุงุณุชููุงู ุฃูู ููููุงุฑุฏ

---

## ๐ ููููุฉ ุงูุฅุนุฏุงุฏ

### **ุงูุฎุทูุฉ 1: ุฅูุดุงุก Pub/Sub Topic**

1. ุงุฐูุจ ุฅูู **Google Cloud Console**
2. ุงูุชุญ **Pub/Sub โ Topics**
3. ุงุถุบุท **Create Topic**
4. ุฃุฏุฎู:
   - **Topic ID**: `gmb-notifications`
   - ุงุชุฑู ุจุงูู ุงูุฅุนุฏุงุฏุงุช ููุง ูู
5. ุงุถุบุท **Create**

---

### **ุงูุฎุทูุฉ 2: ุฅูุดุงุก Push Subscription**

1. ูู ุตูุญุฉ Topicุ ุงุถุบุท **Create Subscription**
2. ุฃุฏุฎู:
   - **Subscription ID**: `gmb-notifications-webhook`
   - **Delivery type**: ุงุฎุชุฑ **Push**
   - **Endpoint URL**: 
     ```
     https://your-domain.com/api/webhooks/gmb-notifications
     ```
   - **Acknowledgement deadline**: `10 seconds`
3. ุงุถุบุท **Create**

---

### **ุงูุฎุทูุฉ 3: ุฅุนุทุงุก ุงูุตูุงุญูุงุช**

1. ุงุฑุฌุน ุฅูู **Topics** โ ุงุถุบุท ุนูู `gmb-notifications`
2. ุงุฐูุจ ุฅูู ุชุจููุจ **Permissions**
3. ุงุถุบุท **Add Principal**
4. ุฃุฏุฎู:
   - **New principals**: 
     ```
     mybusiness-api-pubsub@system.gserviceaccount.com
     ```
   - **Role**: `Pub/Sub Publisher`
5. ุงุถุบุท **Save**

---

### **ุงูุฎุทูุฉ 4: ุชูููู ูู ุงูุชุทุจูู**

1. ุงุฐูุจ ุฅูู **Settings โ Notifications**
2. ุงูุชูู ุฅูู ูุณู **"ุฅุดุนุงุฑุงุช ูุดุงุทู ุงูุชุฌุงุฑู ูู ุงูููุช ุงููุนูู"**
3. ุฃุฏุฎู ุงุณู ุงูููุถูุน ุงููุงูู:
   ```
   projects/your-project-id/topics/gmb-notifications
   ```
4. ุงุฎุชุฑ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงูุชู ุชุฑูุฏ ุชููููุง:
   - โ ุชููููุงุช ุฌุฏูุฏุฉ
   - โ ุฃุณุฆูุฉ ุฌุฏูุฏุฉ
   - โ ุชุญุฏูุซุงุช Google
   - โ ูุณุงุฆุท ุงูุนููุงุก
   - ูุฃูุซุฑ...
5. ุงุถุบุท **Save Notification Settings**

---

## ๐ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงููุชุงุญุฉ

| ุงูููุน | ุงููุตู |
|------|-------|
| **ุชููููุงุช ุฌุฏูุฏุฉ** | ุนูุฏูุง ูุชุฑู ุนููู ุชููููุงู ุฌุฏูุฏุงู |
| **ุชููููุงุช ูุญุฏุซุฉ** | ุนูุฏูุง ูููู ุนููู ุจุชุญุฏูุซ ุชููููู |
| **ุฃุณุฆูุฉ ุฌุฏูุฏุฉ** | ุนูุฏูุง ูุทุฑุญ ุนููู ุณุคุงูุงู |
| **ุฃุณุฆูุฉ ูุญุฏุซุฉ** | ุนูุฏูุง ูุชู ุชุญุฏูุซ ุณุคุงู |
| **ุฅุฌุงุจุงุช ุฌุฏูุฏุฉ** | ุนูุฏูุง ูุฌูุจ ุดุฎุต ูุง ุนูู ุณุคุงู |
| **ุฅุฌุงุจุงุช ูุญุฏุซุฉ** | ุนูุฏูุง ูุชู ุชุญุฏูุซ ุฅุฌุงุจุฉ |
| **ูุณุงุฆุท ุงูุนููุงุก** | ุนูุฏูุง ูุถูู ุนููู ุตูุฑุงู ุฃู ููุฏูููุงุช |
| **ุชุญุฏูุซุงุช Google** | ุนูุฏูุง ูููู Google ุจุชุญุฏูุซ ูุนูููุงุช ูุดุงุทู |
| **ูููุน ููุฑุฑ** | ุนูุฏูุง ููุชุดู Google ูููุนุงู ููุฑุฑุงู |
| **ุชุญุฏูุซ ุตูุช ุงูุชุงุฌุฑ** | ุนูุฏูุง ูุชู ุชุญุฏูุซ ูุนูููุงุช ุงูุชุงุฌุฑ |

---

## ๐ ุงูุชุญูู ูู ุงูุชูููู

### **1. ุชุญูู ูู Topic**
```bash
# ูู Google Cloud Console
Pub/Sub โ Topics โ gmb-notifications
```
- โ ูุฌุจ ุฃู ูููู Status: **Active**
- โ ูุฌุจ ุฃู ูููู ูุฏูู Subscription ูุงุญุฏ ุนูู ุงูุฃูู

### **2. ุชุญูู ูู Subscription**
```bash
# ูู Google Cloud Console
Pub/Sub โ Subscriptions โ gmb-notifications-webhook
```
- โ Delivery type: **Push**
- โ Endpoint URL: ุตุญูุญ
- โ State: **Active**

### **3. ุชุญูู ูู Permissions**
```bash
# ูู Google Cloud Console
Pub/Sub โ Topics โ gmb-notifications โ Permissions
```
- โ ูุฌุจ ุฃู ุชุฑู:
  - Principal: `mybusiness-api-pubsub@system.gserviceaccount.com`
  - Role: `Pub/Sub Publisher`

---

## ๐งช ุงุฎุชุจุงุฑ ุงููุธุงู

### **ุงูุทุฑููุฉ 1: ุงุฎุชุจุงุฑ ูุฏูู**

1. ุงุฐูุจ ุฅูู **Google Cloud Console**
2. **Pub/Sub โ Topics โ gmb-notifications**
3. ุงุถุบุท ุนูู ุชุจููุจ **Messages**
4. ุงุถุบุท **Publish Message**
5. ุฃุฏุฎู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ:
   ```json
   {
     "notificationType": "NEW_REVIEW",
     "locationName": "locations/test-location-id"
   }
   ```
6. ุงุถุบุท **Publish**
7. ุชุญูู ูู logs ุงูุชุทุจูู

### **ุงูุทุฑููุฉ 2: ุงุฎุชุจุงุฑ ุญูููู**

1. ุงุทูุจ ูู ุดุฎุต ูุง ุชุฑู ุชูููู ุนูู ูุดุงุทู ุงูุชุฌุงุฑู
2. ุงูุชุธุฑ ุจุถุน ุซูุงูู
3. ูุฌุจ ุฃู ุชุชููู ุฅุดุนุงุฑุงู ููุฑูุงู ูู ุงูุชุทุจูู

---

## โ ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ

### **ุณ: ูู ูู ุงูููุช ูุณุชุบุฑู ุชููู ุงูุฅุดุนุงุฑุ**
ุฌ: ุนุงุฏุฉู ุฃูู ูู 5 ุซูุงูู ูู ููุช ุญุฏูุซ ุงูุญุฏุซ.

### **ุณ: ูุงุฐุง ูู ูู ุฃุชููู ุฅุดุนุงุฑุงุชุ**
ุฌ: ุชุญูู ูู:
1. โ Topic name ุตุญูุญ ูู Settings
2. โ Subscription ูุดุท ูEndpoint URL ุตุญูุญ
3. โ Permissions ุชู ุฅุนุทุงุคูุง ุจุดูู ุตุญูุญ
4. โ ุงุฎุชุฑุช ุฃููุงุน ุงูุฅุดุนุงุฑุงุช ุงูููุงุณุจุฉ

### **ุณ: ูู ูููููู ุชุนุทูู ุจุนุถ ุฃููุงุน ุงูุฅุดุนุงุฑุงุชุ**
ุฌ: ูุนู! ูู Settings โ Notificationsุ ููููู ุชูุนูู/ุชุนุทูู ุฃู ููุน.

### **ุณ: ูู ููุงู ุชูููุฉ ูุงุณุชุฎุฏุงู Pub/Subุ**
ุฌ: Google Cloud Pub/Sub ูุฏูู ุทุจูุฉ ูุฌุงููุฉ ุณุฎูุฉ. ููุงุณุชุฎุฏุงู ุงูุนุงุฏูุ ุงูุชูููุฉ ุชููู ุถุฆููุฉ ุฌุฏุงู ุฃู ุตูุฑ.

### **ุณ: ูู ุงูุฅุดุนุงุฑุงุช ุขููุฉุ**
ุฌ: ูุนู! ูุชู ุงูุชุญูู ูู ุชูููุน ูู ุฑุณุงูุฉ Pub/Sub ููุชุฃูุฏ ูู ุฃููุง ูู Google.

---

## ๐๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### **ุงููุดููุฉ: ูุง ุชุตู ุฅุดุนุงุฑุงุช**

**ุงูุญููู:**

1. **ุชุญูู ูู Subscription Status:**
   ```
   Google Cloud Console โ Pub/Sub โ Subscriptions
   ```
   - ูุฌุจ ุฃู ูููู Status: **Active**
   - ุชุญูู ูู Endpoint URL

2. **ุชุญูู ูู Webhook Logs:**
   ```bash
   # ูู terminal ุงูุชุทุจูู
   grep "gmb-notifications" logs/*.log
   ```

3. **ุชุญูู ูู Permissions:**
   ```
   Topics โ gmb-notifications โ Permissions
   ```
   - ุชุฃูุฏ ูู ูุฌูุฏ `mybusiness-api-pubsub@system.gserviceaccount.com`

4. **ุงุฎุชุจุฑ Webhook ูุฏููุงู:**
   ```bash
   curl -X POST https://your-domain.com/api/webhooks/gmb-notifications \
     -H "Content-Type: application/json" \
     -d '{"message":{"data":"test"}}'
   ```

---

### **ุงููุดููุฉ: Webhook ูุนูุฏ 401 Unauthorized**

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู Pub/Sub signature verification ูุนูู ุจุดูู ุตุญูุญ
- ุชุญูู ูู ุฃู ุงูู webhook endpoint ูุง ูุชุทูุจ authentication

---

### **ุงููุดููุฉ: Webhook ูุนูุฏ 500 Internal Server Error**

**ุงูุญู:**
1. ุชุญูู ูู logs ุงูุชุทุจูู
2. ุชุฃูุฏ ูู ุฃู database migration ุชู ุชุดุบููู
3. ุชุญูู ูู ุฃู ุฌููุน environment variables ููุฌูุฏุฉ

---

## ๐ ุงููุฑุงูุจุฉ

### **ูู Google Cloud Console:**

```
Pub/Sub โ Subscriptions โ gmb-notifications-webhook โ Metrics
```

ููููู ูุฑุงูุจุฉ:
- โ **Message count**: ุนุฏุฏ ุงูุฑุณุงุฆู ุงููุณุชููุฉ
- โ **Delivery rate**: ูุนุฏู ุงูุชุณููู
- โ **Error rate**: ูุนุฏู ุงูุฃุฎุทุงุก
- โ **Latency**: ููุช ุงูุงุณุชุฌุงุจุฉ

---

## ๐ ุงููุชูุฌุฉ

ุจุนุฏ ุงูุฅุนุฏุงุฏ ุงูุตุญูุญุ ุณุชุชููู:
- โ ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนูุฏ ุฃู ุญุฏุซ ููู
- โ ุชุญุฏูุซุงุช ูู ุงูููุช ุงููุนูู ูู Dashboard
- โ ุงุณุชููุงู ุฃูู ููููุงุฑุฏ (ูุง polling)
- โ ููุซูููุฉ ุนุงููุฉ ูุฃุฏุงุก ููุชุงุฒ

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุฑุงุฌุน ูุฐุง ุงูุฏููู
2. ุชุญูู ูู logs ุงูุชุทุจูู
3. ุชุญูู ูู Google Cloud Console logs
4. ุงุชุตู ุจูุฑูู ุงูุฏุนู

---

**ุชู ุงูุชุญุฏูุซ:** 16 ููููุจุฑ 2025
**ุงูุฅุตุฏุงุฑ:** 1.0

