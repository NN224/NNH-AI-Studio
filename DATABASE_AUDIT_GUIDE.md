# ๐ ุฏููู ูุญุต ูุชูุธูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุชุงุฑูุฎ:** 15 ููููุจุฑ 2025

---

## ๐ ุงูุฎุทูุงุช

### **1๏ธโฃ ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช (SQL)**

ูู ุจุชุดุบูู ุงูุณูุฑูุจุช ูู Supabase SQL Editor:

```bash
# ุงูุชุญ ุงูููู
scripts/audit-database.sql
```

**ูุง ููุญุตู:**
```
โ ุฌููุน ุงูุฌุฏุงูู (35 ุฌุฏูู)
โ ุฌููุน ุงูุฃุนูุฏุฉ
โ ุฌููุน ุงูููุงุฑุณ (Indexes)
โ ุงูููุงุฑุณ ุงูููุฑุฑุฉ
โ ุงูู Views (5 views)
โ ุงูู Functions (10+ functions)
โ ุงูู Triggers
โ ุงูู Foreign Keys
โ ุงูู RLS Policies (50+ policies)
โ ุงูุฌุฏุงูู ุงููุงุฑุบุฉ
โ ุงูููุงุฑุณ ุบูุฑ ุงููุณุชุฎุฏูุฉ
โ ุงูุฌุฏุงูู ุจุฏูู Primary Key
โ ุฃุญุฌุงู ุงูุฌุฏุงูู
```

---

### **2๏ธโฃ ูุญุต ุงุณุชุฎุฏุงู ุงูุฌุฏุงูู ูู ุงูููุฏ**

ูู ุจุชุดุบูู ุงูุณูุฑูุจุช:

```bash
cd /Users/nabel/Documents/GitHub/NNH-AI-Studio
node scripts/analyze-database-usage.js
```

**ูุง ููุญุตู:**
```
โ ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ ูู ุงูููุฏ
โ ุงูุฌุฏุงูู ุบูุฑ ุงููุณุชุฎุฏูุฉ
โ ุงูู Views ุงููุณุชุฎุฏูุฉ
โ ุงูู Views ุบูุฑ ุงููุณุชุฎุฏูุฉ
โ ุงูู Functions ุงููุณุชุฎุฏูุฉ
โ ุงูู Functions ุบูุฑ ุงููุณุชุฎุฏูุฉ
โ ุนุฏุฏ ูุฑุงุช ุงูุงุณุชุฎุฏุงู
โ ุงููููุงุช ุงูุชู ุชุณุชุฎุฏู ูู ุฌุฏูู
```

**ุงููุชูุฌุฉ:**
- ููู `database-usage-report.json` ูุญุชูู ุนูู ุงูุชูุฑูุฑ ุงููุงูู

---

## ๐๏ธ ูุง ูููู ุญุฐูู

### **1. ุงูุฌุฏุงูู ุบูุฑ ุงููุณุชุฎุฏูุฉ**

ุฅุฐุง ุธูุฑ ุฌุฏูู ูู "ุบูุฑ ุงููุณุชุฎุฏูุฉ" ูู ุงูุชูุฑูุฑ:

```sql
-- ุชุญูู ุฃููุงู ูู ุงูุจูุงูุงุช
SELECT COUNT(*) FROM table_name;

-- ุฅุฐุง ูุงู ูุงุฑุบุงู ุฃู ุบูุฑ ูุณุชุฎุฏูุ ุงุญุฐูู
DROP TABLE IF EXISTS table_name CASCADE;
```

โ๏ธ **ุชุญุฐูุฑ:** `CASCADE` ูุญุฐู ูู ูุง ูุนุชูุฏ ุนูู ุงูุฌุฏูู

---

### **2. ุงูููุงุฑุณ ุงูููุฑุฑุฉ**

ุฅุฐุง ุธูุฑุช ููุงุฑุณ ููุฑุฑุฉ:

```sql
-- ุงุญุฐู ุงูููุฑุณ ุงูููุฑุฑ
DROP INDEX IF EXISTS index_name;
```

---

### **3. ุงูููุงุฑุณ ุบูุฑ ุงููุณุชุฎุฏูุฉ**

ุฅุฐุง ูุงู `idx_scan = 0` (ูู ููุณุชุฎุฏู ุฃุจุฏุงู):

```sql
-- ุงุญุฐู ุงูููุฑุณ ุบูุฑ ุงููุณุชุฎุฏู
DROP INDEX IF EXISTS index_name;
```

โ๏ธ **ููุงุญุธุฉ:** ูุง ุชุญุฐู Primary Key indexes

---

### **4. ุงูู Views ุบูุฑ ุงููุณุชุฎุฏูุฉ**

```sql
-- ุงุญุฐู View ุบูุฑ ูุณุชุฎุฏู
DROP VIEW IF EXISTS view_name CASCADE;
```

---

### **5. ุงูู Functions ุบูุฑ ุงููุณุชุฎุฏูุฉ**

```sql
-- ุงุญุฐู Function ุบูุฑ ูุณุชุฎุฏู
DROP FUNCTION IF EXISTS function_name() CASCADE;
```

---

### **6. ุงูู Triggers ุบูุฑ ุงูุถุฑูุฑูุฉ**

```sql
-- ุงุญุฐู Trigger
DROP TRIGGER IF EXISTS trigger_name ON table_name;
```

---

### **7. ุงูู Policies ุงูููุฑุฑุฉ**

```sql
-- ุงุญุฐู Policy ููุฑุฑ
DROP POLICY IF EXISTS policy_name ON table_name;
```

---

## ๐ ุงูุฃุดูุงุก ุงูุดุงุฆุนุฉ ููุญุฐู

### **ุฌุฏุงูู ูุฏููุฉ / ููุชุทููุฑ:**
```sql
-- ุฃูุซูุฉ (ุชุญูู ุฃููุงู!)
DROP TABLE IF EXISTS test_table CASCADE;
DROP TABLE IF EXISTS temp_data CASCADE;
DROP TABLE IF EXISTS old_migrations CASCADE;
```

### **Indexes ููุฑุฑุฉ:**
```sql
-- ูุซุงู: ุฅุฐุง ูุงู ููุงู ููุฑุณูู ุนูู ููุณ ุงูุนููุฏ
DROP INDEX IF EXISTS idx_users_email_old;
-- ุงุญุชูุธ ุจู idx_users_email ููุท
```

### **Views ูุฏููุฉ:**
```sql
-- ูุซุงู: views ูุฏููุฉ ุชู ุงุณุชุจุฏุงููุง
DROP VIEW IF EXISTS v_old_dashboard_stats CASCADE;
```

---

## โ ุฎุทูุงุช ุงูุชูุธูู ุงูุขููุฉ

### **1. Backup ุฃููุงู!**
```bash
# ูู Supabase Dashboard:
# Settings > Database > Backups > Create Backup
```

### **2. ูุญุต ุงูุจูุงูุงุช**
```sql
-- ูุจู ุญุฐู ุฃู ุฌุฏููุ ุชุญูู ูู ุงูุจูุงูุงุช
SELECT COUNT(*) FROM table_name;
SELECT * FROM table_name LIMIT 10;
```

### **3. ูุญุต ุงูุงุนุชูุงุฏูุงุช**
```sql
-- ุดูู ุดู ูุนุชูุฏ ุนูู ุงูุฌุฏูู
SELECT 
    tc.table_name,
    tc.constraint_name,
    tc.constraint_type
FROM information_schema.table_constraints tc
WHERE tc.table_name = 'your_table_name';
```

### **4. ุญุฐู ุชุฏุฑูุฌู**
```sql
-- ุงุจุฏุฃ ุจุงูู Policies
DROP POLICY IF EXISTS policy_name ON table_name;

-- ุซู ุงูู Triggers
DROP TRIGGER IF EXISTS trigger_name ON table_name;

-- ุซู ุงูู Indexes
DROP INDEX IF EXISTS index_name;

-- ุฃุฎูุฑุงู ุงูุฌุฏูู
DROP TABLE IF EXISTS table_name CASCADE;
```

---

## ๐ฏ ุงูุชูุตูุงุช

### **ุงุญุฐู:**
```
โ ุฌุฏุงูู ูุงุฑุบุฉ ูุบูุฑ ูุณุชุฎุฏูุฉ
โ ููุงุฑุณ ููุฑุฑุฉ
โ ููุงุฑุณ ุบูุฑ ูุณุชุฎุฏูุฉ (idx_scan = 0)
โ views ูุฏููุฉ ุบูุฑ ูุณุชุฎุฏูุฉ
โ functions ุบูุฑ ูุณุชุฎุฏูุฉ
โ triggers ุบูุฑ ุถุฑูุฑูุฉ
โ policies ููุฑุฑุฉ
```

### **ุงุญุชูุธ:**
```
โ ุฌุฏุงูู ุจูุง ุจูุงูุงุช
โ Primary Key indexes
โ Foreign Key indexes
โ Unique indexes
โ views ูุณุชุฎุฏูุฉ ูู ุงูููุฏ
โ functions ูุณุชุฎุฏูุฉ ูู triggers
โ policies ูุดุทุฉ
```

---

## ๐ Checklist

```
โก 1. ุนูู Backup
โก 2. ุชุดุบูู audit-database.sql
โก 3. ุชุดุบูู analyze-database-usage.js
โก 4. ูุฑุงุฌุนุฉ ุงูุชูุงุฑูุฑ
โก 5. ุชุญุฏูุฏ ูุง ุณููุญุฐู
โก 6. ูุญุต ุงูุงุนุชูุงุฏูุงุช
โก 7. ุญุฐู ุชุฏุฑูุฌู
โก 8. ุงุฎุชุจุงุฑ ุงูุชุทุจูู
โก 9. ุชุดุบูู VACUUM ANALYZE
```

---

## ๐ง ุจุนุฏ ุงูุชูุธูู

### **ุชุญุณูู ุงูุฃุฏุงุก:**
```sql
-- ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
VACUUM ANALYZE;

-- ุฅุนุงุฏุฉ ุจูุงุก ุงูููุงุฑุณ
REINDEX DATABASE postgres;
```

### **ูุญุต ุงูุญุฌู ุจุนุฏ ุงูุชูุธูู:**
```sql
SELECT 
    pg_size_pretty(pg_database_size('postgres')) as database_size;
```

---

## โ๏ธ ุชุญุฐูุฑุงุช ูููุฉ

```
โ๏ธ ูุง ุชุญุฐู ุฌุฏุงูู Supabase ุงูุฃุณุงุณูุฉ:
   - auth.users
   - auth.sessions
   - storage.buckets
   - storage.objects

โ๏ธ ูุง ุชุญุฐู Primary Keys

โ๏ธ ูุง ุชุญุฐู Foreign Keys ุงููุณุชุฎุฏูุฉ

โ๏ธ ุงุนูู Backup ูุจู ุฃู ุญุฐู

โ๏ธ ุงุฎุชุจุฑ ุงูุชุทุจูู ุจุนุฏ ูู ุชุบููุฑ
```

---

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ

```
ูุจู ุงูุชูุธูู:
๐๏ธ 35 ุฌุฏูู
๐ 100+ indexes
๐ 5 views
๐ง 10+ functions
๐ 50+ policies

ุจุนุฏ ุงูุชูุธูู:
๐๏ธ 25-30 ุฌุฏูู (ุญุฐู 5-10 ุบูุฑ ูุณุชุฎุฏูุฉ)
๐ 70-80 indexes (ุญุฐู 20-30 ููุฑุฑุฉ/ุบูุฑ ูุณุชุฎุฏูุฉ)
๐ 3-4 views (ุญุฐู 1-2 ูุฏููุฉ)
๐ง 8-10 functions (ุญุฐู 0-2 ุบูุฑ ูุณุชุฎุฏูุฉ)
๐ 40-45 policies (ุญุฐู 5-10 ููุฑุฑุฉ)

๐พ ุชูููุฑ: 20-30% ูู ุงูุญุฌู
โก ุชุญุณูู: 10-20% ูู ุงูุฃุฏุงุก
```

---

**ุฌุงูุฒ ููุชูุธูู! ๐งน**

